<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.2">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
<script src="https://cdn.jsdelivr.net/gh/josedvq/covfee@8050fa938ae270ae70244c33903ead9d905bca92/covfee/static/js/opencv.js"></script><title data-react-helmet="true">Developing custom tasks | covfee: continuous video feedback tool</title><meta data-react-helmet="true" property="og:url" content="https://your-docusaurus-test-site.com/covfee/docs/custom_task"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Developing custom tasks | covfee: continuous video feedback tool"><meta data-react-helmet="true" name="description" content="This guide explains how to install covfee for development. The most common reason to do so is to develop a custom task, but you may also wish to modify the Flask server."><meta data-react-helmet="true" property="og:description" content="This guide explains how to install covfee for development. The most common reason to do so is to develop a custom task, but you may also wish to modify the Flask server."><link data-react-helmet="true" rel="shortcut icon" href="/covfee/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://your-docusaurus-test-site.com/covfee/docs/custom_task"><link data-react-helmet="true" rel="alternate" href="https://your-docusaurus-test-site.com/covfee/docs/custom_task" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://your-docusaurus-test-site.com/covfee/docs/custom_task" hreflang="x-default"><link rel="stylesheet" href="/covfee/assets/css/styles.4c6e3f34.css">
<link rel="preload" href="/covfee/assets/js/runtime~main.1203aead.js" as="script">
<link rel="preload" href="/covfee/assets/js/main.95ecc809.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/covfee"><img src="/covfee/img/logo.svg" alt="covfee logo" class="themedImage_TMUO themedImage--light_4Vu1 navbar__logo"><img src="/covfee/img/logo.svg" alt="covfee logo" class="themedImage_TMUO themedImage--dark_uzRr navbar__logo"><b class="navbar__title">covfee</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/covfee/docs">Docs</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/covfee"><img src="/covfee/img/logo.svg" alt="covfee logo" class="themedImage_TMUO themedImage--light_4Vu1 navbar__logo"><img src="/covfee/img/logo.svg" alt="covfee logo" class="themedImage_TMUO themedImage--dark_uzRr navbar__logo"><b class="navbar__title">covfee</b></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/covfee/docs">Docs</a></li><li class="menu__list-item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="menu__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_lDyR"><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu menu--responsive thin-scrollbar menu_cyFh menuWithAnnouncementBar_+O1J" aria-label="Sidebar navigation"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg class="sidebarMenuIcon_iZzd" width="24" height="24" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/covfee/docs/overview">Overview</a></li><li class="menu__list-item"><a class="menu__link" href="/covfee/docs/installation">Installation</a></li><li class="menu__list-item"><a class="menu__link" href="/covfee/docs/getting_started">Getting Started</a></li><li class="menu__list-item"><a class="menu__link" href="/covfee/docs/hit_options">HIT options</a></li><li class="menu__list-item"><a class="menu__link" href="/covfee/docs">Deploying to a server</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="#!">Playground</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/covfee/docs/tasks/instructions">Instructions</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/covfee/docs/tasks/questionnaire">Questionnaires</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/covfee/docs/tasks/continuous_1d">Continuous 1D</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/covfee/docs/tasks/continuous_keypoint">Continuous Keypoint</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Advanced</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/covfee/docs/development">Development install</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/covfee/docs/custom_task">Developing custom tasks</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="markdown"><header><h1 class="h1Heading_dC7a">Developing custom tasks</h1></header><p>This guide explains how to install covfee for development. The most common reason to do so is to develop a custom task, but you may also wish to modify the Flask server.</p><p>We have tried to make the process of developing a custom annotation task or experiment in covfee as simple as possible. However, development of custom tasks requires at least a basic understanding of Javascript, and <a href="https://reactjs.org/" target="_blank" rel="noopener noreferrer">React</a>. Some useful resources to quickly get started:</p><ul><li><a href="https://reactjs.org/tutorial/tutorial.html" target="_blank" rel="noopener noreferrer">Official React tutorial</a></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="setup"></a>Setup<a class="hash-link" href="#setup" title="Direct link to heading">#</a></h2><p>The development environment makes use of a webpack development server for a more comfortable experience, including hot-reloading. This guide will get you to run covfee in development mode for one of the sample projects:</p><ol><li><p>Install version 12.x of <a href="https://nodejs.org/en/download/" target="_blank" rel="noopener noreferrer">node.js</a>. Make sure that the <code>npm</code> command is available in your terminal.</p></li><li><p>Clone this repository and install the python package with pip, in editable mode. This allows that the changes to the source code immediately affect all the local installations of the package.</p></li></ol><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">git clone git@github.com:josedvq/covfee.git</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cd covfee</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">python3 -m pip install -e .</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><ol start="3"><li>Create an app database. We will use one of the samples for now:</li></ol><p>cd samples/basic
covfee-maker .</p><ol start="4"><li>From the same folder, start webpack:</li></ol><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">covfee-webpack</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>In development mode, webpack serves the front-end code of covfee. That will include the Javascript code of your custom task. Webpack is configured for hot reloading meaning the results will refresh in your browser whenever you make changes to the code. Javascript errors may appear in this terminal or in the browser.</p><ol start="5"><li>In another terminal, in the same folder, start the flask server in dev mode:</li></ol><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">covfee-dev</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>You can now open the HIT link as explained in the main <a href="/covfee/README.md">README</a></p><p>And that&#x27;s it! The next section explains how to code a custom task in Javascript.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="custom-tasks"></a>Custom tasks<a class="hash-link" href="#custom-tasks" title="Direct link to heading">#</a></h2><p>Custom tasks or HIT types can be added by implementing a React component meeting a few conditions. To be valid, task components must meet these conditions:</p><ol><li><p>Be a valid React component, by inheriting from <code>React.Component</code>.</p></li><li><p>Covfee takes care of data submission and storage, but your task needs to output the result of the task, ie. the user-provided feedback. This can be, for example, the answer to a form, or the location of the mouse over time. Normally it is enough for you to store the state of the task in the <code>state</code> or a class attribute and pass it to the <code>onSubmit</code> props method one the task is finished. It is therefore left to you to determine when the task is finished and the data valid. Once <code>onSubmit</code> is called, covfee takes control and advances to the next task in the timeline, or lets the user switch to a different one in the annotation environment.</p></li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="a-first-task"></a>A first task<a class="hash-link" href="#a-first-task" title="Direct link to heading">#</a></h3><p>This will walk you through the process of creating a simple covfee task.</p><p>We will start by importing the <code>Form</code> component, which, quite simply, creates simple forms from a specification. We will also make use of the video.js player to play the videos, and we need to import React and antd for the layout. All these imports look like:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">import * as React from &#x27;react&#x27;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">import {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Row,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Col,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Button</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">} from &#x27;antd&#x27;;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">import VideojsPlayer from &#x27;../players/videojs&#x27;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">import {Form} from &#x27;Input/form&#x27;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Next, we will create our task component:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">class FirstTask extends React.Component {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    public state = {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        values: [[]]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    handleChange = (values: object) =&gt; {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        const has_null = values[0].some((val) =&gt; {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            return val === null</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        })</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        this.setState({</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            values: values,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        })</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    handleSubmit = () =&gt; {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        this.props.onSubmit(this.state.values)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    render() {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        const mediaOptions = {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            autoplay: false,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            controls: true,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            fluid: true,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            aspectRatio: &#x27;16:9&#x27;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            sources: [{</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                src: this.props.media.url,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                type: &#x27;video/mp4&#x27;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            }]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        return &lt;&gt;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            &lt;Row&gt;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                &lt;Col span={16}&gt;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    &lt;VideojsPlayer {...mediaOptions} onEnded={this.handleVideoEnded}&gt;&lt;/VideojsPlayer&gt;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                &lt;/Col&gt;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                &lt;Col span={8}&gt;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    &lt;Form {...this.props.form} </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        values={this.state.form.values} </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        onChange={this.handleChange}&gt;&lt;/Form&gt;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    &lt;Button onClick={this.handleSubmit}&gt;Submit&lt;/Button&gt;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                &lt;/Col&gt;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            &lt;/Row&gt;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &lt;/&gt;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Task components are located in the <code>covfee/app/src/tasks</code> folder. This is the place to start if you wish to implement your own task.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="deploying-covfee"></a>Deploying covfee<a class="hash-link" href="#deploying-covfee" title="Direct link to heading">#</a></h2><p>Generate the covfee bundles and schemata:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">covfee-dev build</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">covfee-dev schemata</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></div><footer class="row docusaurus-mt-lg"><div class="col"><a href="https://github.com/facebook/docusaurus/edit/master/website/docs/custom_task.mdx" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_wj+Z"></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/covfee/docs/development"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« Development install</div></a></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#setup" class="table-of-contents__link">Setup</a></li><li><a href="#custom-tasks" class="table-of-contents__link">Custom tasks</a><ul><li><a href="#a-first-task" class="table-of-contents__link">A first task</a></li></ul></li><li><a href="#deploying-covfee" class="table-of-contents__link">Deploying covfee</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/covfee/docs">Getting Started</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow</a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord</a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2021 Jose Vargas. Docs built with Docusaurus.</div></div></div></footer></div>
<script src="/covfee/assets/js/runtime~main.1203aead.js"></script>
<script src="/covfee/assets/js/main.95ecc809.js"></script>
</body>
</html>