(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[705],{73343:(e,t,s)=>{"use strict";s.d(t,{Z:()=>xt});var a=s(87462),i=s(67294),n=s(28228),r=s(16550),o=s(9642),p=s(14402),l=s(54907),m=s(99189),d=s(32607),c=s(71230),h=s(15746),u=s(97910),y=s(16448),f=s(71577),k=(s(42920),s(55837)),g=s.n(k),b=s(92084),v=s.n(b),N=s(12461);const w="development",T="";function x(e,t){"production"==w?N.ZP.error(e+" Please try again later or contact the organizer(s)."):t&&(v().error(t),N.ZP.error(e+t.stack,0))}function S(e){return e.replace(/\$\$www\$\$/g,T)}function E(e,t){"string"==typeof e&&(e=S(e));const s=(a="csrf_access_token",(i=document.cookie.match("(^|;)\\s*"+a+"\\s*=\\s*([^;]+)"))?i.pop():null);var a,i;const n={...t};return null!=s&&(n.headers={...n.headers,"X-CSRF-TOKEN":s}),fetch(e,n)}"development"==w?v().setLevel("debug"):v().setLevel("error");const C=async e=>{if(!e.ok){const t=await e.json();if(t.hasOwnProperty("msg"))throw Error(t.msg);throw Error(e.statusText)}return await e.json()};var I=s(14670),M=s(66345),P=s.n(M);const R="";class q extends i.Component{constructor(){return super(...arguments),this.state={markdown:"",error:""},this}componentDidMount(){if("raw"==this.props.content.type)this.setState({markdown:this.props.content.content});else{var e={method:"GET",headers:new Headers};E(this.props.content.url,e).then((e=>e.text())).then((e=>{this.setState({markdown:e.replace(/\$\$www\$\$/g,R)})})).catch((e=>{this.setState({error:`Error reading file ${this.props.content.url}`})}))}}renderError(){return i.createElement(i.Fragment,null,i.createElement(I.Z,{message:"Instructions task",description:`Error fetching file ${this.props.content.url}. Make sure the URL points to a valid file.`,type:"error"}))}render(){return this.state.error?this.renderError():i.createElement(i.Fragment,null,i.createElement(c.Z,{gutter:0},i.createElement(h.Z,{span:24},i.createElement(P(),{children:this.state.markdown,allowDangerousHtml:!0}))))}}class F extends i.Component{}F.taskType="component";class L extends F{}L.taskType="continuous";var O=s(32808),_=s(68863),A=s(77052),D=s(29924),$=s(10556),j=s(40280),Z=s(22918),V=s(94594),z=s(93940);const B={Checkbox:O.Z,"Checkbox.Group":O.Z.Group,Input:_.Z,"Input.TextArea":_.Z.TextArea,InputNumber:A.Z,"Radio.Group":D.ZP.Group,Rate:$.Z,Select:j.Z,Slider:Z.Z,Switch:V.Z};class U extends i.Component{constructor(e){super(e),H.call(this),this.props.values?this.initialValues=this.props.values:e.fields&&e.fields.forEach(((e,t)=>{void 0!==e.input.defaultValue?e.input.defaultValue:void 0!==e.input.defaultChecked&&e.input.defaultChecked;this.initialValues[e.name]=void 0})),this.props.setValues(this.initialValues)}componentDidMount(){}render(){return i.createElement(z.Z,{ref:this.formRef,layout:this.props.layout,style:{margin:"1em"},initialValues:this.initialValues,onValuesChange:(e,t)=>{this.props.setValues(e)},onFinish:this.handleFinish},this.props.fields&&this.props.fields.map(((e,t)=>this.evalCondition(e.condition)?i.createElement(z.Z.Item,{key:t,name:e.name,label:e.label,required:e.required,rules:e.required&&[{required:!0,message:"This field is required."}],valuePropName:["Switch","Checkbox"].includes(e.input.inputType)?"checked":"value"},(()=>{if(!(e.input.inputType in B))return i.createElement("p",null,"Unimplemented input element!");const t=this.patchProps({...e.input});return delete t.inputType,delete t.defaultValue,delete t.defaultChecked,this.renderInputElement(e.input.inputType,t,this.props.disabled)})()):null)),this.props.renderSubmitButton&&i.createElement(z.Z.Item,null,this.props.renderSubmitButton({disabled:this.props.disabled})))}}U.defaultProps={layout:"vertical",disabled:!1,withSubmitButton:!1};var H=function(){this.formRef=i.createRef(),this.initialValues={},this.handleFinish=e=>{this.props.onSubmit(e)},this.renderInputElement=(e,t,s)=>{const a=B[e],n={};"Slider"==e&&(n.marginLeft="25",n.marginRight="25");return i.createElement(a,{...t,disabled:s,style:n},null)},this.evalCondition=e=>!this.props.values||!e||(e in this.props.values?this.props.values[e]:(v().warn(`Unable to resolve condition ${e}`),!0)),this.patchProps=e=>{const t={};if("Slider"==e.inputType&&e.marks)for(const[s,a]of Object.entries(e.marks))t[s]=i.createElement("div",{style:{display:"table-caption",wordSpacing:"unset",fontSize:"0.8em"}},a);return{...e,marks:t}}};const K=class extends F{constructor(e){super(e),this.state={form:{values:null}},this.handleSubmit=e=>{this.props.onSubmit(this.state.form.values,null,!0)},this.handleFormChange=e=>{this.setState({form:{...this.state.form,values:{...this.state.form.values,...e}}})},e.response&&e.response.data&&(this.state.form.values=e.response.data)}render(){return i.createElement(c.Z,{style:{margin:"2em 0"}},i.createElement(h.Z,{sm:{span:22,offset:1},md:{span:20,offset:2},lg:{span:16,offset:4},xl:{span:14,offset:5}},i.createElement(q,{content:this.props.spec.content}),i.createElement(U,(0,a.Z)({},this.props.spec.form,{disabled:this.props.disabled,values:this.state.form.values,setValues:this.handleFormChange,withSubmitButton:!0,renderSubmitButton:this.props.renderSubmitButton,onSubmit:this.handleSubmit}))))}};var W,G;function Q(){return Q=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(e[a]=s[a])}return e},Q.apply(this,arguments)}const J=e=>{let{title:t,titleId:s,...a}=e;return i.createElement("svg",Q({id:"Layer_1","data-name":"Layer 1",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 293 333","aria-labelledby":s},a),t?i.createElement("title",{id:s},t):null,W||(W=i.createElement("defs",null,i.createElement("style",null,".cls-4{stroke:#000;stroke-miterlimit:10;stroke-width:2px}.cls-4,.cls-7{fill:#b3b3b3}.cls-8{fill:#0071bc}"))),i.createElement("path",{style:{fill:"#29abe2"},d:"M114 332.98V64.59h179v161.5"}),i.createElement("path",{style:{fill:"#333"},d:"m114.16 332.98 35.45-268.39H78.7l35.46 268.39z"}),i.createElement("path",{style:{fill:"#005994"},d:"m149.61 64.59-35.45 268.39L228.05 64.59h-78.44z"}),i.createElement("path",{style:{fill:"#005791"},d:"M78.73 64.61 114.19 333 .29 64.61"}),G||(G=i.createElement("path",{className:"cls-8",d:"M228 221.25 114.19 333 228.05 64.59 228 221.25zM0 211.53l114.23 121.09L.36 64.2 0 211.53z"})),i.createElement("path",{style:{fill:"#999"},d:"M0 0h228v64.59H0z"}))};class Y extends i.Component{render(){return React.createElement("div",{className:"spinner"},React.createElement(Spin,null))}}class X extends i.Component{render(){return i.createElement("div",{style:{display:"flex",alignItems:"center",height:"46px"}},i.createElement(J,{width:"30",height:"30"}))}}var ee=s(13856),te=s(5484),se=s(22879),ae=s(60042),ie=s.n(ae);const{Option:ne}=j.Z,{Text:re}=m.Z;class oe extends i.Component{constructor(){return super(...arguments),this.state={task:void 0,loading:!1,pressedDelete:!1,formKey:0},this.resetForm=()=>{this.setState({task:this.props.new?void 0:this.props.task,loading:!1,pressedDelete:!1,formKey:this.state.formKey+1})},this.handleSubmit=()=>{this.props.onSubmit(this.state.task).then((()=>{this.props.onClose()}))},this.handleChange=e=>{this.setState({task:{...this.state.task,...e}})},this.handleDelete=()=>{this.props.onDelete().then((()=>{this.props.onClose()}))},this.handleDeleteClick=e=>{this.setState({pressedDelete:!0})},this}componentDidMount(){this.resetForm()}componentDidUpdate(e){this.props.visible!=e.visible&&this.props.visible&&this.resetForm()}render(){let e=i.createElement(i.Fragment,null);return this.props.new||(e=this.state.pressedDelete?i.createElement(i.Fragment,null,i.createElement(re,{type:"danger"},"All annotations submitted for this task may be lost. Are you sure you want to delete?"),i.createElement("br",null),i.createElement(f.Z,{danger:!0,type:"primary",onClick:this.handleDelete},"Delete"),i.createElement(f.Z,{type:"default",onClick:()=>{this.setState({pressedDelete:!1})}},"Cancel")):i.createElement(f.Z,{danger:!0,type:"primary",onClick:this.handleDeleteClick},"Delete")),i.createElement(y.Z,{visible:this.props.visible,title:"Create new task",onOk:this.handleSubmit,onCancel:this.props.onClose,footer:[i.createElement(f.Z,{key:"back",onClick:this.props.onClose},"Cancel"),i.createElement(f.Z,{key:"submit",type:"primary",loading:this.state.loading,onClick:this.handleSubmit},"Submit")]},i.createElement(pe,{key:this.state.formKey,presets:this.props.presets,task:this.state.task,onChange:this.handleChange}),e)}}class pe extends i.Component{constructor(e){super(e),this.state={error:null,preset:""},this.handlePresetChange=e=>{this.setState({preset:e}),this.props.onChange(this.props.presets[e])},this.handleNameChange=e=>{this.props.onChange({name:e.target.value})},void 0!==e.task||e.presets||(this.state.error="Task or presets must be given."),void 0===e.task&&(e.onChange(Object.values(this.props.presets)[0]),this.state.preset=Object.keys(this.props.presets)[0])}componentDidMount(){}render(){return void 0===this.props.task?null:this.state.error?i.createElement(I.Z,{message:this.state.error,type:"error"}):i.createElement(i.Fragment,null,this.props.presets&&i.createElement(z.Z.Item,{label:"Preset"},i.createElement(j.Z,{value:this.state.preset,style:{width:120},onChange:this.handlePresetChange},Object.entries(this.props.presets).map((e=>{let[t,s]=e;return i.createElement(ne,{key:t,value:t},t)})))),i.createElement(z.Z.Item,{label:"Type"},i.createElement(j.Z,{value:this.props.task.type,style:{width:120},disabled:!0},i.createElement(ne,{key:0,value:this.props.task.type},this.props.task.type))),i.createElement(z.Z.Item,{label:"Name"},i.createElement(_.Z,{value:this.props.task.name,onChange:this.handleNameChange})))}}class le extends i.Component{constructor(e){super(e),this.state={editTaskModal:{taskId:[0,0],visible:!1,new:!1}},this.taskElementRefs=[],this.handleClickEdit=e=>{this.props.editMode.enabled&&this.setState({editTaskModal:{...this.state.editTaskModal,taskId:e,visible:!0,new:!1}})},this.handleClickAdd=e=>{this.props.editMode.enabled&&this.setState({editTaskModal:{...this.state.editTaskModal,taskId:[e,null],visible:!0,new:!0}})},this.handleEditTaskCancel=()=>{this.setState({editTaskModal:{...this.state.editTaskModal,visible:!1}})}}componentDidUpdate(e){const t=this.props.currTask;e.currTask!=t&&this.taskElementRefs[t[0]]&&this.taskElementRefs[t[0]].scrollIntoView()}render(){return this.taskElementRefs=[],i.createElement(ce,null,this.props.editMode.enabled&&(()=>{let e;if(this.state.editTaskModal.new)e=null;else{const t=this.state.editTaskModal.taskId;e=t[1]?this.props.tasks[t[0]].children[t[1]].spec:this.props.tasks[t[0]].spec}return i.createElement(oe,{visible:this.state.editTaskModal.visible,new:this.state.editTaskModal.new,presets:this.props.editMode.presets,task:e,onSubmit:e=>this.state.editTaskModal.new?this.props.editMode.onTaskCreate(this.state.editTaskModal.taskId[0],e):this.props.editMode.onTaskEdit(e.id,e),onClose:this.handleEditTaskCancel,onDelete:()=>this.props.editMode.onTaskDelete(this.state.editTaskModal.taskIndex)})})(),i.createElement(he,null,this.props.children),this.props.editMode.enabled&&this.props.editMode.allowNew&&i.createElement(f.Z,{type:"primary",className:"sidebar-new",block:!0,onClick:()=>{this.handleClickAdd(null)},icon:i.createElement(ee.Z,null)},"New Task"),i.createElement(ue,null,i.createElement("ol",{className:"task-group"},this.props.tasks.map(((e,t)=>i.createElement(me,{key:e.id,ref:e=>{this.taskElementRefs[t]=e},name:e.spec.name,children:e.children?e.children.map(((e,s)=>({name:e.spec.name,status:t===this.props.currTask[0]&&s===this.props.currTask[1]?"active":0==e.num_submissions?"default":e.valid?"valid":"invalid",editable:!0}))):[],status:t==this.props.currTask[0]&&null==this.props.currTask[1]?"active":0==e.num_submissions?"default":e.valid?"valid":"invalid",editable:e.editable,onClickActivate:e=>{this.props.onChangeActiveTask([t,e])},onClickEdit:e=>{this.handleClickEdit([t,e])}}))))))}}class me extends i.Component{constructor(){return super(...arguments),this.liRef=i.createRef(),this.toggleExpand=()=>{},this.scrollIntoView=()=>{this.liRef.current&&this.liRef.current.scrollIntoView({behavior:"smooth",block:"center"})},this}render(){return i.createElement("li",{className:ie()("task-li"),ref:this.liRef},i.createElement(de,{name:this.props.name,className:{"btn-parent":!0},status:this.props.status,active:this.props.active,editable:!1,expandable:this.props.children&&this.props.children.length>0,onClickActivate:()=>{this.props.onClickActivate(null)},onClickExpand:this.toggleExpand}),this.props.editable&&i.createElement("div",{className:ie()(["sidebar-group-editbtn","background"]),onClick:()=>{this.props.onClickEdit(null)}},i.createElement("span",null,"edit task")),i.createElement("ol",{className:"sidebar-children"},this.props.children.map(((e,t)=>i.createElement("li",{key:t},i.createElement(de,{name:e.name,className:{"btn-child":!0},status:this.props.status,active:e.active,editable:!1,expandable:!1,onClickActivate:()=>{this.props.onClickActivate(t)},onClickExpand:this.toggleExpand}))))))}}class de extends i.Component{render(){return i.createElement("div",{className:ie()("btn",`btn-${this.props.status}`,{...this.props.className}),onClick:this.props.onClickActivate},i.createElement("div",{className:"btn-icon"},this.props.editable&&i.createElement(te.Z,null),this.props.expandable&&i.createElement(se.Z,null)),i.createElement("div",{className:"btn-name"},this.props.name))}}de.defaultProps={expandable:!1};const ce=n.ZP.nav`
    display: flex;
    flex-flow: column;
    width: 100%;
    height: inherit;
    background-color: #a6a6a6;

  
    &-new {
      margin: 2px;
    }
  
    &-group {
      &-editbtn {
        font-size: 0.8em;
        line-height: 14px;
        color: #5c5252;
        text-align: right;
        text-transform: uppercase;
  
        &:hover {
          cursor: pointer;
        }
      }
  
      &-editbtn.background {
        position: relative;
        z-index: 1;
  
        &:before {
          border-top: 2px solid #dfdfdf;
          content: "";
          margin: 0 auto;
          /* this centers the line to the full width specified */
          position: absolute;
          /* positioning must be absolute here, and relative positioning must be applied to the parent */
          top: 50%;
          left: 0;
          right: 0;
          bottom: 0;
          width: 95%;
          z-index: -1;
        }
  
        span {
          /* to hide the lines from behind the text, you have to set the background color the same as the container */
          background: #f0f2f5;
          padding: 0 5px;
        }
      }
  
    }
  
    &.bottom {
      margin-top: auto;
    }
  
    &.children {
      list-style-type: none;
      margin: 0;
      padding-left: 25px;
    }    
  }`,he=n.ZP.nav`
    background-color: #464646;
    padding: 5;

    > button {
        border-radius: 0;
    }
  `,ue=n.ZP.div`
    flex: 2;
    padding: 2 0 2 2;
    overflow-y: scroll;
    scrollbar-width: 12px;
    scrollbar-color: rgb(244, 63, 94) rgb(99, 102, 241);
    
    &::-webkit-scrollbar {
        width: 12px;
    }
    &::-webkit-scrollbar-track {
        background: #a6a6a6;
        border-radius: 6px;
    }
    &::-webkit-scrollbar-thumb {
        background-color: #d5d5d5;
        border-radius: 6px;
        border: 2px solid #a6a6a6;
    }

    > .task-group {
        height: inherit;
        list-style-type: none;
        margin: 0;
        padding: 0;
  
        > li > .btn {
          border: 1px solid #d9d9d9;
          border-radius: 2px;
          margin: 2px;
          color: #363636;
          clear: both;
      
          > .btn-name {
            width: calc(100% - 36px);
            overflow-x: hidden;
            display: block;
            padding: 5px;
      
            &:hover {
              cursor: pointer;
            }
          }
      
          > .btn-icon {
            display: block;
            float: right;
            width: 20px;
            height: 20px;
            margin: 8px;
            color:#d5d5d5;
          }
      
          &.btn-default {
            background-color: #fafafa;
          }
      
          &.btn-active {
            color: #fafafa;
            background-color: #2c70de;
          }
  
          &.btn-valid {
            background-color: #b2cf23;
          }
  
          &.btn-invalid {
            background-color: #cf6565;
          }
        }
      }
  `;var ye=s(98174);const fe=i.createContext({}),{Title:ke,Text:ge}=m.Z;class be extends i.Component{constructor(e){var t;super(e),t=this,this.listeners={},this.keysToListeners={},this.listenerStatus={},this.keydown=e=>{const t=e.target.tagName.toLowerCase();if(["input","textarea","select","button"].includes(t))return;if(!(e.key in this.keysToListeners))return;const s=this.keysToListeners[e.key];s in this.listeners||x("Registed key has no event"),this.listenerStatus[s]=!0,e.preventDefault(),"keydown"in this.listeners[s].events&&this.listeners[s].events.keydown.forEach((t=>{t(e)}))},this.keyup=e=>{const t=e.target.tagName.toLowerCase();if(["input","textarea","select","button"].includes(t))return;if(!(e.key in this.keysToListeners))return;const s=this.keysToListeners[e.key];s in this.listeners||x("Registed key has no event"),this.listenerStatus[s]=!1,"keyup"in this.listeners[s].events&&this.listeners[s].events.keyup.forEach((t=>{t(e)}))},this.addListener=(e,t)=>{this.listeners[e]={defaultKey:null,description:t,events:{}};const s=this;return{addEvent:function(t,a){return t in s.listeners[e].events||(s.listeners[e].events[t]=[]),s.listeners[e].events[t].push(a),this}}},this.removeListener=e=>{if(v().info(`removing listener ${e}`),!(e in this.listeners))return v().warn(`listener ${e} not found.`);const t=this.listeners[e].defaultKey;t in this.keysToListeners&&delete this.keysToListeners[t],delete this.listeners[e]},this.applyMap=function(e,s){void 0===s&&(s={});for(let[a,i]of Object.entries(e))a in s&&(i=s[a]),a in t.listeners&&(t.listeners[a].defaultKey=i,t.keysToListeners[i]=a)},this.getStatus=e=>this.listenerStatus[e],this.getClient=()=>({addListener:this.addListener,removeListener:this.removeListener,applyMap:this.applyMap,getStatus:this.getStatus,renderInfo:this.renderInfo}),this.getDummyClient=()=>({addListener:()=>({addEvent:function(){return this}}),removeListener:()=>{},applyMap:()=>{},getStatus:()=>!1,renderInfo:()=>null}),this.renderInfo=()=>i.createElement(ye.ZP,null,Object.entries(this.listeners).map(((e,t)=>{let[s,a]=e;return i.createElement(ye.ZP.Item,{key:t},i.createElement(ge,{keyboard:!0},i.createElement("span",{style:{color:"black"}},"[",a.defaultKey,"]")),a.description)})))}componentDidMount(){addEventListener("keydown",this.keydown,!1),addEventListener("keyup",this.keyup,!1)}componentWillUnmount(){removeEventListener("keydown",this.keydown),removeEventListener("keyup",this.keyup)}render(){return i.createElement(fe.Provider,{value:{getContext:this.getClient,getDummyContext:this.getDummyClient,renderInfo:this.renderInfo}},this.props.children)}}const ve=be;var Ne=s(73935),we=s(11382),Te=s(10808);class xe extends i.Component{constructor(){return super(...arguments),this.container=i.createRef(),this.videoBorder=i.createRef(),this.handleMouseMove=e=>{const t=[e.offsetX/this.resolution[0],e.offsetY/this.resolution[1]];this.props.onData(t,e)},this.handleMouseOver=e=>{this.props.onMouseActiveChange(!0)},this.handleMouseOut=e=>{this.props.onMouseActiveChange(!1)},this}componentDidMount(){if(this.props.disable)return;this.container.current.addEventListener("mouseover",this.handleMouseOver),this.container.current.addEventListener("mouseout",this.handleMouseOut),new ResizeObserver((e=>{this.resolution=[e[0].contentRect.width,e[0].contentRect.height]})).observe(this.container.current),this.props.paused||this.start()}componentDidUpdate(e){this.props.paused!==e.paused&&(this.props.paused?this.stop():this.start())}componentWillUnmount(){this.props.paused&&this.stop(),this.container.current.removeEventListener("mouseover",this.handleMouseOver),this.container.current.removeEventListener("mouseout",this.handleMouseOut)}start(){this.props.disable||this.container.current.addEventListener("mousemove",this.handleMouseMove)}stop(){this.container.current.removeEventListener("mousemove",this.handleMouseMove)}getContainer(){return this.container.current}render(){return i.createElement("div",{className:ie()({"mouse-tracker":!0,"mouse-tracker-active":this.props.mouseActive&&!this.props.paused,"mouse-tracker-occluded":this.props.mouseActive&&!this.props.paused&&this.props.occluded}),ref:this.videoBorder},i.createElement("div",{className:"video-container",ref:this.container},this.props.children))}}const Se=xe;class Ee extends i.Component{constructor(){return super(...arguments),this.container=null,this.rect=null,this.pointerRef=null,this.posPx=[0,0],this.setData=e=>{this.pointerRef&&(this.posPx=[Math.round(e[0]*this.rect.width),Math.round(e[1]*this.rect.height)],this.pointerRef.style.top=this.posPx[1]+"px",this.pointerRef.style.left=this.posPx[0]+"px")},this}componentDidMount(){new ResizeObserver((e=>{this.rect=e[0].contentRect})).observe(this.container)}render(){return i.createElement("div",{className:"mouse-visualizer",ref:e=>{this.container=e}},this.props.children,!this.props.disable&&i.createElement("div",{className:"mouse-visualizer-pointer",ref:e=>{this.pointerRef=e},style:{top:this.posPx[1]+"px",left:this.posPx[0]+"px"}}))}}Ee.defaultProps={disable:!1};const Ce=Ee,{Title:Ie,Text:Me}=m.Z;class Pe extends L{constructor(e){super(e),this.state={occluded:!1,mouse_valid:!1,opticalFlowEnabled:!0,playbackRateIdx:7},this.tracker=i.createRef(),this.mouse_normalized=[0,0],this.playbackRates=[.1,1/8,1/6,.2,1/4,1/3,.5,1,2,3,4],this.speedup=()=>{this.setState({playbackRateIdx:Math.min(this.state.playbackRateIdx+1,this.playbackRates.length-1)})},this.speeddown=()=>{this.setState({playbackRateIdx:Math.max(this.state.playbackRateIdx-1,0)})},this.back2s=()=>{const e=Math.max(0,this.props.player.currentTime()-2);this.props.player.currentTime(e)},this.back10s=()=>{const e=Math.max(0,this.props.player.currentTime()-10);this.props.player.currentTime(e)},this.toggleOcclusion=()=>{this.setState({occluded:!this.state.occluded})},this.handleMouseData=e=>{this.mouse_normalized=e},this.getMousePosition=()=>this.mouse_normalized,this.handleMouseActiveChange=e=>{this.setState({mouse_valid:e})},this.setOpticalFlowEnabled=e=>{this.setState({opticalFlowEnabled:e},(()=>{}))},this.toggleOpticalFlow=()=>{this.setOpticalFlowEnabled(!this.state.opticalFlowEnabled)},this.handleFrame=e=>{this.props.response?this.replayUntil(e):this.props.buffer.data(e,[...this.mouse_normalized,this.state.mouse_valid?1:0,this.state.occluded?1:0])},this.handleVideoEnded=()=>{this.props.onEnd(null)},this.replayUntil=e=>{let t,s;[t,s]=this.props.buffer.read(e),t&&this.updateMouseVisualization([t[1],t[2]])},this.replayAction=e=>{if("number"==typeof e[3])return this.mouse_normalized=[e[3],e[4]],void this.setState({mouse_valid:!!e[5],occluded:!!e[6]});switch(e[1]){case"speedup":this.speedup();break;case"speeddown":this.speeddown();break;case"back2s":this.back2s();break;case"back10s":this.back10s()}},this.wrapPlayerElement=e=>i.createElement(Se,{disable:null!==this.props.response,paused:!1,occluded:this.state.occluded,mouseActive:this.state.mouse_valid,onData:this.handleMouseData,onMouseActiveChange:this.handleMouseActiveChange},i.createElement(Ce,{disable:null===this.props.response,ref:e=>{e&&(this.updateMouseVisualization=e.setData)}},e)),this.instructions=()=>this.props.buttons.renderInfo();let t=null;"undefined"!=typeof localStorage&&(t=localStorage.getItem("opticalFlowEnabled")),null!==t&&(this.state.opticalFlowEnabled="1"==t),null!==e.response&&(this.state.opticalFlowEnabled=!1),v().info(`constructing task ${this.props.myKey}`)}componentDidMount(){v().info(`mounting task ${this.props.myKey}`),this.props.buttons.addListener("speedup","ArrowRight","Increase playback speed.").addEvent("keydown",(e=>{this.speedup()})),this.props.buttons.addListener("speeddown","ArrowLeft","Decrease playback speed.").addEvent("keydown",(e=>{this.speeddown()})),this.props.buttons.addListener("play"," ","Toggle play/pause the video.").addEvent("keydown",(e=>{this.props.player.togglePlayPause()})),this.props.buttons.addListener("back2s","x","Go back 2s.").addEvent("keydown",(e=>{this.back2s()})),this.props.buttons.addListener("back10s","c","Go back 10s.").addEvent("keydown",(e=>{this.back10s()})),this.props.buttons.addListener("occlusion","z","Toggle occlusion flag.").addEvent("keydown",(e=>{this.toggleOcclusion()})),this.props.buttons.addListener("opticalflow","v","Toggle optical flow-based speed adjustment.").addEvent("keydown",(e=>{this.toggleOpticalFlow()})),this.props.player.addListener("frame",this.handleFrame),this.props.player.addListener("end",this.handleVideoEnded)}componentWillUnmount(){v().info(`unmounting task ${this.props.myKey}`),this.props.buttons.removeListener("speedup"),this.props.buttons.removeListener("speeddown"),this.props.buttons.removeListener("play"),this.props.buttons.removeListener("back2s"),this.props.buttons.removeListener("back10s"),this.props.buttons.removeListener("occlusion"),this.props.buttons.removeListener("opticalflow"),this.props.player.removeListeners("frame"),this.props.player.removeListeners("end")}render(){return i.createElement(i.Fragment,null,this.props.renderPlayer({type:"OpencvFlowPlayer",media:this.props.spec.media,opticalFlowEnabled:this.state.opticalFlowEnabled,setOpticalFlowEnabled:this.setOpticalFlowEnabled,playbackRateMultiplier:this.playbackRates[this.state.playbackRateIdx],getMousePosition:this.getMousePosition,wrapPlayerElement:this.wrapPlayerElement}))}}Pe.taskInfo={bufferDataLen:2};class Re extends i.Component{constructor(e){super(e),this.intensity=0,this.speed=0,this.observer=null,this.containerHeight=0,this.mousemove=e=>{const t=(this.container.getBoundingClientRect().bottom-e.clientY)/this.containerHeight;this.intensity=Math.max(0,Math.min(1,t))},this.startBinaryKeyboard=()=>{this.props.buttons.addListener("up","Activate"),this.props.buttons.applyMap({up:"q"},this.controls)},this.startMousemove=()=>{document.addEventListener("mousemove",this.mousemove,!1)},this.startContinuousKeyboard=()=>{this.props.buttons.addListener("up","Increase").addEvent("keydown",(()=>{this.intensity=Math.min(1,this.intensity+.05)})),this.props.buttons.addListener("down","Decrease").addEvent("keydown",(()=>{this.intensity=Math.max(0,this.intensity-.05)})),this.props.buttons.applyMap({up:"ArrowUp",down:"ArrowDown"},this.controls)},this.startGravityKeyboard=()=>{this.props.buttons.addListener("up","Increase").addEvent("keydown",(()=>{this.intensity=1,this.speed=0})),this.props.buttons.applyMap({up:"a"},this.controls)},this.startInput=()=>({binary:this.startBinaryKeyboard,"continuous-mousemove":this.startMousemove,"continuous-keyboard":this.startContinuousKeyboard,"gravity-keyboard":this.startGravityKeyboard}[this.props.input.mode]()),this.stopInput=()=>{document.removeEventListener("mousemove",this.mousemove,!1)},this.read=()=>this.intensity}componentDidMount(){this.observer=new ResizeObserver((e=>{this.containerHeight=e[0].contentRect.height-20})),this.observer.observe(this.container),this.startInput()}componentWillUnmount(){this.stopInput(),this.observer.disconnect(),cancelAnimationFrame(this.animationId)}componentDidUpdate(e){this.props.paused?cancelAnimationFrame(this.animationId):this.animateFn()}get controls(){return"continuous-mousemove"==this.props.input.mode?null:this.props.input.controls?this.props.input.controls:{}}get animateFn(){return{binary:()=>{this.animationId=requestAnimationFrame(this.animateFn),this.props.replay?this.intensity=this.props.getIntensity():(this.intensity=this.props.buttons.getStatus("up")?1:0,this.props.setIntensity(this.intensity)),this.container.style.backgroundColor=this.intensity?"green":"black"},"continuous-mousemove":()=>{this.animationId=requestAnimationFrame(this.animateFn),this.props.replay?this.intensity=this.props.getIntensity():(this.intensity=this.props.buttons.getStatus("up")?1:0,this.props.setIntensity(this.intensity)),this.props.setIntensity(this.intensity);const e=Math.round(this.intensity*this.containerHeight);this.indicator.style.bottom=e.toString()+"px"},"continuous-keyboard":()=>{this.animationId=requestAnimationFrame(this.animateFn),this.props.replay?this.intensity=this.props.getIntensity():(this.intensity=this.props.buttons.getStatus("up")?1:0,this.props.setIntensity(this.intensity)),this.props.setIntensity(this.intensity);const e=Math.round(this.intensity*this.containerHeight);this.indicator.style.bottom=e.toString()+"px"},"gravity-keyboard":()=>{this.animationId=requestAnimationFrame(this.animateFn),this.props.replay?this.intensity=this.props.getIntensity():(this.intensity=this.props.buttons.getStatus("up")?1:0,this.props.setIntensity(this.intensity));this.intensity=Math.max(0,Math.min(1,this.intensity+1*this.speed)),this.speed=this.speed-1*this.props.input.acceleration_constant,this.props.setIntensity(this.intensity);const e=Math.round(this.intensity*this.containerHeight);this.indicator.style.bottom=e.toString()+"px"}}[this.props.input.mode]}render(){return i.createElement(qe,{ref:e=>{this.container=e}},!["binary"].includes(this.props.input.mode)&&i.createElement(Fe,{ref:e=>{this.indicator=e},style:{bottom:0}}))}}Re.defaultProps={};const qe=n.ZP.div`
    position: relative;
    width: 100%;
    height: 100%;
    background-color: black;
    border: 5px solid #202020;
`,Fe=n.ZP.div`
    position: absolute;
    width: 100%;
    height: 20px;
    background-color: green;
`;function Le(e,t,s){s/=100;let a=(t/=100)*Math.min(s,1-s),i=function(t,i){return void 0===i&&(i=(t+e/30)%12),s-a*Math.max(Math.min(i-3,9-i,1),-1)};return[255*i(0),255*i(8),255*i(4)]}class Oe extends i.Component{constructor(e){super(e),this.intensity=0,this.intensityMin=0,this.intensityMax=0,this.speed=0,this.trace=[],this.nextGraphNode=0,this.lastModifier=0,this.maxTrace=5,this.minTrace=-5,this.annotationMod=1,this.mod=0,this.requestUpdate=e=>{isNaN(e)||(this.intensity=Math.max(this.bounds[0],Math.min(this.bounds[1],e)),this.intensityMax=Math.max(this.intensityMax,this.intensity),this.intensityMin=Math.min(this.intensityMin,this.intensity))},this.startInput=()=>{this.props.buttons.addListener("up","Increase").addEvent("keydown",(()=>{this.requestUpdate(this.intensity+this.step)})),this.props.buttons.addListener("down","Decrease").addEvent("keydown",(()=>{this.requestUpdate(this.intensity-this.step)})),this.props.buttons.applyMap({up:"ArrowUp",down:"ArrowDown"},this.controls)},this.stopInput=()=>{this.props.buttons.removeListener("up"),this.props.buttons.removeListener("down")},this.read=()=>this.intensity,this.normPosY=(e,t,s)=>{var a=Math.abs(this.norm(e,t,s)*(this.canvas.height-40)-(this.canvas.height-40))+20;return a!=a?this.canvas.height/2:a},this.animateRankTrace=e=>{if(this.animationId=requestAnimationFrame(this.animateRankTrace),this.props.replay){const[e,t]=this.props.buffer.readHead();e&&this.requestUpdate(e[2])}else this.props.setIntensity(this.intensity);const t=this.context,s=this.canvas;this.trace;t.clearRect(0,0,s.width,s.height),t.fillStyle="#2d2d2d",t.fillRect(0,0,s.width,s.height);const a=this.props.buffer.head;if(0===a)return;const i=this.props.buffer.makeIterator(0,0,a),n=[];let r=i.next();for(;!r.done;){const[e,t]=r.value;0!==e&&n.push({x:e*((this.canvas.width-50)/a)+20,y:this.normPosY(t,this.intensityMax,this.intensityMin)}),r=i.next()}if(0!==n.length){t.lineCap="round",t.strokeStyle="#86a3c6",t.lineWidth=4,t.beginPath(),t.moveTo(n[0].x,n[0].y);for(var o=1;o<n.length-2;o++){var p=(n[o].x+n[o+1].x)/2,l=(n[o].y+n[o+1].y)/2;t.quadraticCurveTo(n[o].x,n[o].y,p,l)}o>2&&(t.quadraticCurveTo(n[o].x,n[o].y,n[o+1].x,n[o+1].y),t.stroke(),t.beginPath(),t.arc(n[o+1].x,n[o+1].y,10,0,2*Math.PI,!1),t.stroke())}},this.animateRankTraceNew=e=>{if(this.animationId=requestAnimationFrame(this.animateRankTraceNew),this.props.replay){const[e,t]=this.props.buffer.readHead();e&&this.requestUpdate(e[2])}else this.props.setIntensity(this.intensity);const t=this.context,s=this.canvas;this.trace;if((new Date).getTime()>this.nextGraphNode){this.nextGraphNode=(new Date).getTime()+this.props.graphUpdatePeriod,t.clearRect(0,0,s.width,s.height),t.fillStyle="#4d4d4d",t.fillRect(0,0,s.width,s.height);const e=this.props.buffer.head;if(0===e)return;const a=this.props.buffer.makeIterator(0,0,e),i=[];let n=a.next();for(;!n.done;){const[t,r]=n.value;if(0!==t){const a=t*((this.canvas.width-50)/e)+20;let n;this.intensity>this.maxTrace?(n=s.height/2-(r-(this.intensity-5))*((s.height-40)/10),this.lastModifier=this.intensity-5,this.maxTrace=this.intensity,this.minTrace=this.intensity-10):this.intensity<this.minTrace?(n=s.height/2-(r-(this.intensity+5))*((s.height-40)/10),this.lastModifier=this.intensity+5,this.minTrace=this.intensity,this.maxTrace=this.intensity+10):n=s.height/2-(r-this.lastModifier)*((s.height-40)/10),i.push({x:a,y:n})}n=a.next()}t.lineCap="round",t.strokeStyle="#86a3c6",t.lineWidth=4,function(e,t,s,a){void 0===s&&(s=.3),void 0===a&&(a=.6),e.beginPath(),e.moveTo(t[0].x,t[0].y);for(var i,n,r=0,o=0,p=0,l=t[0],m=1;m<t.length;m++){var d=t[m];const c=t[m+1];let h,u;c?(i=l,r=((n=c).y-i.y)/(n.x-i.x),h=(c.x-d.x)*-s,u=h*r*a):(h=0,u=0),e.bezierCurveTo(l.x-o,l.y-p,d.x+h,d.y+u,d.x,d.y),o=h,p=u,l=d}e.stroke()}(t,i,1,0),t.beginPath(),t.arc(i[i.length-1].x,i[i.length-1].y,10,0,2*Math.PI,!1),t.stroke()}},this.animateGtrace=()=>{if(this.animationId=requestAnimationFrame(this.animateGtrace),this.props.replay){const[e,t]=this.props.buffer.readHead();e&&this.requestUpdate(e[2])}else this.props.setIntensity(this.intensity);const e=this.context,t=this.canvas;this.trace;e.clearRect(0,0,t.width,t.height),e.fillStyle="#4d4d4d",e.fillRect(0,0,t.width,t.height),this.props.buttons.getStatus("up")||this.props.buttons.getStatus("down")?(this.annotationMod=this.annotationMod+(Math.pow(2,this.mod)-1),this.mod+=.01):(this.annotationMod=1,this.mod=0);const s=this.props.buffer.head;var a=this.props.buffer.headMediatime;const i=this.props.buffer.makeReverseIterator(s-1,s-Math.round(5*this.props.buffer.fps),0,this.props.buffer.fps);let n=i.next();for(;!n.done;){const[s,d]=n.value;let c=(d+100)/2,h=Math.abs(d)/100*85,u=55+Math.abs(d)/10,y=s*this.props.buffer.fps,f=d/100*(t.width/2-40);var r=Le(c,h,u),o=0;a-y<100?o=(a-y)/100:(p=.9-(a-y-3e3)/3e3,l=0,m=1,o=Math.max(l,Math.min(p,m))),e.strokeStyle="rgba("+r[0]+","+r[1]+","+r[2]+","+o+")",e.lineWidth=4,e.beginPath(),e.arc(t.width/2+f,t.height/2,30*o,0,2*Math.PI,!1),e.stroke(),n=i.next()}var p,l,m;const d=(this.intensity+100)/2,c=Math.abs(this.intensity)/100*85,h=55+Math.abs(this.intensity)/10;e.strokeStyle="hsl("+d+","+c+"%,"+h+"%)",e.lineWidth=10,e.beginPath();const u=this.intensity/100*(t.width/2-40);e.arc(t.width/2+u,t.height/2,20,0,2*Math.PI,!1),e.stroke(),e.beginPath(),e.lineWidth=2,e.fillStyle="hsl(10,55%,53%)",e.fillRect(142,0,2,t.height),e.fillStyle="hsl(30,55%,53%)",e.fillRect(278,0,2,t.height),e.fillStyle="hsl(80,55%,53%)",e.fillRect(t.width-142,0,2,t.height),e.fillStyle="hsl(60,55%,53%)",e.fillRect(t.width-278,0,2,t.height),e.fillStyle=e.strokeStyle="hsl(50,0%,50%)",e.fillRect(t.width/2-1,0,2,t.height/2-34),e.fillRect(t.width/2-1,t.height/2+34,2,t.height/2-34),e.arc(t.width/2,t.height/2,34,0,2*Math.PI,!1),e.stroke(),e.beginPath(),e.strokeStyle="hsl(0,85%,53%)",e.arc(40,t.height/2,34,Math.PI/2,Math.PI+1*Math.PI/2,!1),e.stroke(),e.beginPath(),e.strokeStyle="hsl(100,85%,53%)",e.arc(t.width-40,t.height/2,34,Math.PI/2,Math.PI+1*Math.PI/2,!0),e.stroke()}}componentDidMount(){this.startInput()}componentWillUnmount(){this.stopInput(),cancelAnimationFrame(this.animationId)}componentDidUpdate(e){this.props.paused?cancelAnimationFrame(this.animationId):this.animationId=requestAnimationFrame(this.animateFn)}get animateFn(){return{ranktrace:this.animateRankTrace,"ranktrace-new":this.animateRankTraceNew,gtrace:this.animateGtrace}[this.props.input.mode]}get bounds(){return this.props.input.bounds?this.props.input.bounds:["ranktrace","ranktrace-new"].includes(this.props.input.mode)?[-1/0,1/0]:"gtrace"==this.props.input.mode?[-100,100]:[0,1]}get step(){return"gtrace"==this.props.input.mode?this.annotationMod:1}get controls(){return{up:"s",down:"a",...this.props.input.controls?this.props.input.controls:{}}}norm(e,t,s){return(e-s)/(t-s)}render(){return i.createElement(_e,null,i.createElement(Ae,{ref:e=>{this.canvas=e,e&&(this.context=e.getContext("2d"))},width:810,height:150}))}}Oe.defaultProps={graphUpdatePeriod:100};const _e=n.ZP.div`
    position: relative;
    width: 100%;
    height: 100%;
    background-color: #2d2d2d;
    border: 5px solid #202020;
`,Ae=n.ZP.canvas`
    display: block;
    position: relative;
    top: 50%;
    transform: translateY(-50%);
    margin: 0 auto;
    max-width: 100%;
    max-height: 100%;
`,{Title:De}=m.Z;class $e extends L{constructor(e){super(e),this.state={},this.reverseCountTimerId=null,this.frameUpdateTimerId=null,this.index=0,this.handleFrame=e=>{this.props.response?this.replayUntil(e):this.props.buffer.data(e,[this.intensity])},this.handleVideoSwitch=(e,t)=>{this.props.response||this.props.buffer.log(this.props.player.currentTime(),["vidswitch",e,t])},this.back2s=()=>{const e=Math.max(0,this.props.player.currentTime()-2);this.props.player.currentTime(e)},this.back10s=()=>{const e=Math.max(0,this.props.player.currentTime()-10);this.props.player.currentTime(e)},this.replayUntil=e=>{let t,s;this.props.buffer.seek(e),[t,s]=this.props.buffer.readHead(),t&&this.setIntensity(t[2]),s&&s.forEach((e=>{this.replayAction(e[2])}))},this.replayAction=e=>{e[0]},this.handleVideoEnded=()=>{this.props.onEnd(null)},this.setIntensity=e=>{this.intensity=e},this.wrapPlayer=e=>e,this.instructions=()=>this.props.buttons.renderInfo()}get controls(){return this.props.spec.controls?this.props.spec.controls:{}}componentDidMount(){this.props.buttons.addListener("play-pause","Play/pause the video and data capture.").addEvent("keydown",(e=>{this.props.response||(this.props.player.paused?this.props.buffer.log(this.props.player.currentTime(),["play"]):this.props.buffer.log(this.props.player.currentTime(),["pause"])),this.props.player.togglePlayPause()})),this.props.buttons.applyMap({"play-pause":" "},this.controls),this.props.player.addListener("frame",this.handleFrame),this.props.player.addListener("end",this.handleVideoEnded),this.props.player.addListener("vidswitch",this.handleVideoSwitch)}componentWillUnmount(){this.props.buttons.removeListener("play-pause"),this.props.buttons.removeListener("back2s"),this.props.buttons.removeListener("back10s"),this.props.player.removeListeners("frame"),this.props.player.removeListeners("end"),this.props.player.removeListeners("vidswitch"),this.frameUpdateTimerId&&clearInterval(this.frameUpdateTimerId)}renderTrace(){return i.createElement(i.Fragment,null,i.createElement("div",{style:{height:"calc(100% - 200px)"}},this.props.renderPlayer({type:"HTML5Player",media:this.props.spec.media,countdown:this.props.spec.showCountdown})),i.createElement("div",{style:{height:"200px"}},i.createElement(Oe,{paused:this.props.player.paused,buttons:this.props.buttons,buffer:this.props.buffer,setIntensity:this.setIntensity,getIntensity:()=>this.intensity,input:this.props.spec.intensityInput,replay:!!this.props.response})))}renderLever(){return i.createElement(i.Fragment,null,i.createElement("div",{style:{float:"left",width:"80%",height:"100%"}},this.props.renderPlayer({type:"HTML5Player",media:this.props.spec.media,countdown:this.props.spec.showCountdown})),i.createElement("div",{style:{width:"20%",height:"100%",marginLeft:"80%"}},i.createElement(Re,{paused:this.props.player.paused,buttons:this.props.buttons,buffer:this.props.buffer,setIntensity:this.setIntensity,getIntensity:()=>this.intensity,input:this.props.spec.intensityInput,replay:!!this.props.response})))}render(){return["ranktrace","ranktrace-new","gtrace"].includes(this.props.spec.intensityInput.mode)?this.renderTrace():["continuous-mousemove","continuous-keyboard","gravity-keyboard","binary"].includes(this.props.spec.intensityInput.mode)?this.renderLever():null}}$e.taskInfo={bufferDataLen:1};var je=s(60577);class Ze extends i.PureComponent{constructor(){return super(...arguments),this.videoNode=i.createRef(),this}componentDidMount(){let e={autoplay:this.props.autoplay,controls:this.props.controls,fluid:this.props.fluid,aspectRatio:this.props.aspectRatio,sources:[{src:S(this.props.url),type:"video/mp4"}]};this.player=(0,je.Z)(this.videoNode.current,e),this.props.onPlay&&this.player.on("play",(e=>{this.props.onPlay(e)})),this.props.onPause&&this.player.on("pause",(e=>{this.props.onPause(e)})),this.props.onEnded&&this.player.on("ended",(e=>{this.props.onEnded(e)}))}play(){this.player.play()}playbackRate(e){this.player.playbackRate(e)}toggle_play_pause(){this.player.paused()?this.player.play():this.player.pause()}currentTime(e){return this.player.currentTime(e)}componentWillUnmount(){this.player&&this.player.dispose()}render(){return i.createElement("div",{"data-vjs-player":!0},i.createElement("video",{ref:this.videoNode,className:"video-js"}))}}Ze.defaultProps={paused:!0,autoplay:!1,controls:!0,fluid:!0,aspectRatio:"16:9"};const Ve=Ze;class ze extends i.Component{}class Be extends ze{constructor(){return super(...arguments),this.state={paused:!0},this.container=i.createRef(),this._setPaused=e=>{},this.isControlled=!1,this.loadedWavesurfer=!1,this.play=()=>{this._setPaused(!1)},this.playPause=()=>{this._setPaused(!this.paused)},this.currentTime=e=>{if(!e)return this.player.getCurrentTime();this.player.setCurrentTime(e)},this}get paused(){return this.isControlled?this.props.paused:this.state.paused}checkIfControlled(){void 0===this.props.paused?(this.isControlled=!1,this._setPaused=e=>{this.setState({paused:e})}):(this.isControlled=!0,this._setPaused=this.props.setPaused)}componentDidMount(){s.e(308).then(s.t.bind(s,47308,23)).then((e=>{const t=e.default;this.player=t.create({container:this.container.current,waveColor:"violet",progressColor:"purple",interact:!1,...this.props.waveSurferOptions}),this.player.load(this.props.media.url),this.player.on("ended",(()=>{this.props.onEnd})),this.loadedWavesurfer=!0})),this.checkIfControlled()}componentDidUpdate(e){this.loadedWavesurfer&&(this.paused!==this.prevPaused&&(this.paused?this.player.pause():this.player.play()),this.prevPaused=this.paused,this.checkIfControlled())}render(){const e=i.createElement(f.Z,{onClick:this.playPause,type:"primary"},this.paused?"Play":"Pause");return i.createElement("div",{style:{margin:"2em"}},i.createElement("div",{ref:this.container}),e)}}Be.defaultProps={playPauseButton:!0};const Ue=Be;const He={ContinuousKeypointTask:Pe,Continuous1DTask:$e,QuestionnaireTask:class extends F{constructor(e){super(e),this.state={media:{paused:!0},form:{values:null,disabled:this.props.disabled}},this.handleChange=e=>{this.setState({form:{...this.state.form,values:{...this.state.form.values,...e}}})},this.handleMediaEnded=()=>{this.setState({form:{...this.state.form,disabled:!1}})},this.handleSubmit=()=>{this.props.onSubmit(this.state.form.values,null,!0)},e.response&&e.response.data&&(this.state.form.values=e.response.data),null!=e.spec.disabledUntilEnd&&(this.state.form.disabled=e.spec.disabledUntilEnd)}render(){return i.createElement(i.Fragment,null,i.createElement(c.Z,{gutter:16},this.props.spec.media&&i.createElement(h.Z,{span:16},(()=>{switch(this.props.spec.media.type){case"video":return i.createElement(Ve,(0,a.Z)({},this.props.spec.media,{onEnded:this.handleMediaEnded}));case"audio":return i.createElement(Ue,{media:this.props.spec.media,onEnded:this.handleMediaEnded});default:return i.createElement("p",null,"Unrecognized media type.")}})()),i.createElement(h.Z,{span:this.props.spec.media?8:24},i.createElement(U,(0,a.Z)({},this.props.spec.form,{disabled:this.props.disabled,values:this.state.form.values,setValues:this.handleChange,withSubmitButton:!0,renderSubmitButton:this.props.renderSubmitButton,onSubmit:this.handleSubmit})))))}},InstructionsTask:K};var Ke=s(65826),We=s(18192);class Ge extends i.Component{constructor(){return super(...arguments),this.state={currentTime:null},this}componentDidMount(){this.setState({currentTime:this.props.currentTime()}),this.timeoutId=setInterval((()=>{this.setState({currentTime:this.props.currentTime()})}),1e3)}componentWillUnmount(){clearInterval(this.timeoutId)}render(){return i.createElement("div",{className:"annot-bar"},i.createElement("div",{className:"annot-bar-section"},i.createElement(Ke.Z,null)," ",this.state.currentTime&&this.state.currentTime.toFixed(0)," / ",this.props.duration&&this.props.duration.toFixed(0)),this.props.setSpeed&&i.createElement("div",{className:"annot-bar-section"},i.createElement(We.Z,null)," ",this.props.speed.toPrecision(2),i.createElement(Z.Z,{style:{display:"inline-block",margin:"0 0 0 8px",width:"200px"},min:.1,max:4,step:.1,defaultValue:30,value:this.props.speed,onChange:this.props.setSpeed})),this.props.children)}}Ge.defaultProps={speedEnabled:!0};class Qe extends i.Component{render(){return i.createElement("div",{className:"demo"},i.createElement("div",{className:"demo__colored-blocks"},i.createElement("div",{className:"demo__colored-blocks-rotater"},i.createElement("div",{className:"demo__colored-block"}),i.createElement("div",{className:"demo__colored-block"}),i.createElement("div",{className:"demo__colored-block"})),i.createElement("div",{className:"demo__colored-blocks-inner"}),i.createElement("div",{className:"demo__text"},"Ready")),i.createElement("div",{className:"demo__inner"},i.createElement("svg",{className:"demo__numbers",viewBox:"0 0 100 100"},i.createElement("defs",null,i.createElement("path",{className:"demo__num-path-1",d:"M40,28 55,22 55,78"}),i.createElement("path",{className:"demo__num-join-1-2",d:"M55,78 55,83 a17,17 0 1,0 34,0 a20,10 0 0,0 -20,-10"}),i.createElement("path",{className:"demo__num-path-2",d:"M69,73 l-35,0 l30,-30 a16,16 0 0,0 -22.6,-22.6 l-7,7"}),i.createElement("path",{className:"demo__num-join-2-3",d:"M28,69 Q25,44 34.4,27.4"}),i.createElement("path",{className:"demo__num-path-3",d:"M30,20 60,20 40,50 a18,15 0 1,1 -12,19"})),i.createElement("path",{className:"demo__numbers-path",d:"M-10,20 60,20 40,50 a18,15 0 1,1 -12,19  Q25,44 34.4,27.4 l7,-7 a16,16 0 0,1 22.6,22.6 l-30,30 l35,0 L69,73  a20,10 0 0,1 20,10 a17,17 0 0,1 -34,0 L55,83  l0,-61 L40,28"}))))}}class Je extends ze{constructor(e){if(super(e),this.state={duration:null,countdownActive:!1},this.canvasTag=i.createRef(),this.videoTags=Array(),this.active_idx=0,this.time=0,this.videoFrameCallbackId=null,this.countdownTimeoutId=null,this.handleEnd=()=>{this.props.onEnd(),this.pause()},this.setActiveVideo=(e,t)=>{this.videoTags[this.active_idx].current.removeEventListener("ended",this.handleEnd),this.videoTags[e].current.addEventListener("ended",this.handleEnd),this.isMultiview&&(this.videoTags[e].current.currentTime=this.videoTags[this.active_idx].current.currentTime,t||this.props.onEvent("vidswitch",this.active_idx,e),this.active_idx=e,this.copyVideoToCanvas())},this.copyVideoToCanvas=()=>{const e=this.canvasTag.current.width,t=this.canvasTag.current.height;this.canvasCtx.drawImage(this.videoTags[this.active_idx].current,0,0,e,t)},this.onFrame=e=>{e!==this.time&&(this.time=e,this.props.onFrame(this.time)),"video-multiview"==this.props.media.type&&this.copyVideoToCanvas()},this.onVideoFrameCallback=(e,t)=>{const s=t.mediaTime;this.onFrame(s),this.videoFrameCallbackId=this.videoTags[this.active_idx].current.requestVideoFrameCallback(this.onVideoFrameCallback)},this.onRequestAnimationFrame=()=>{const e=this.videoTags[this.active_idx].current.currentTime;this.onFrame(e),this.videoFrameCallbackId=requestAnimationFrame(this.onRequestAnimationFrame)},this.startPlayCountdown=()=>{this.setState({countdownActive:!0}),this.countdownTimeoutId=setTimeout((()=>{this.setState({countdownActive:!1},(()=>{this.play()}))}),1500)},this.currentTime=(e,t)=>{if(!this.videoTags[this.active_idx].current)return null;if(void 0===e)return this.videoTags[this.active_idx].current.currentTime;{this.videoTags[this.active_idx].current.currentTime=e,this.props.setPaused(!0);const s=()=>{this.copyVideoToCanvas(),this.videoTags[this.active_idx].current.removeEventListener("timeupdate",s)};this.videoTags[this.active_idx].current.addEventListener("timeupdate",s),t&&t()}},this.renderBar=()=>i.createElement(Ge,{duration:this.state.duration,currentTime:()=>this.currentTime(),paused:this.props.paused,setPaused:this.props.setPaused,speed:this.props.speed,setSpeed:this.props.setSpeed,muted:this.props.muted,setMuted:this.props.setMuted}),this.renderMultiview=()=>{if("video-multiview"===this.props.media.type)return i.createElement("div",{className:"html5player"},this.renderBar(),i.createElement("canvas",{ref:this.canvasTag,className:"video-canvas",width:800,height:450}),i.createElement("div",{className:"video-multiview-selector"},this.props.media.url.map(((e,t)=>{const s=t===this.active_idx;return i.createElement("video",{key:t,style:{width:100/this.props.media.url.length+"%"},onClick:()=>{this.props.paused&&this.setActiveVideo(t)},ref:this.videoTags[t],src:S(e),crossOrigin:"Anonymous",preload:"auto",muted:this.props.media.muted||!s})}))))},this.renderSingleview=()=>{if("video"===this.props.media.type)return i.createElement("div",{className:"html5player",style:{height:"100%",position:"relative",backgroundColor:"black"}},this.renderBar(),i.createElement("video",{style:{display:"block",height:"100%",maxWidth:"100%",margin:"0 auto"},ref:this.videoTags[0],src:S(this.props.media.url),crossOrigin:"Anonymous",preload:"auto",muted:this.props.media.muted}),this.state.countdownActive&&i.createElement(Qe,null))},this.isMultiview="video-multiview"==this.props.media.type,this.isMultiview){this.videoTags=[];for(let e=0;e<this.props.media.url.length;e++)this.videoTags.push(i.createRef())}else this.videoTags=[i.createRef()]}componentDidMount(){this.isMultiview&&(this.canvasCtx=this.canvasTag.current.getContext("2d"));const e=this.videoTags[this.active_idx].current;e.addEventListener("loadeddata",(t=>{v().debug("loadeddata"),this.setState({duration:e.duration}),this.props.onLoad(e.duration),this.setActiveVideo(0)})),this.props.media.speed&&(e.playbackRate=this.props.media.speed)}componentDidUpdate(e){if(this.props.paused!==e.paused&&(this.props.paused?this.pause():this.props.countdown?this.startPlayCountdown():this.play()),this.props.speed!==e.speed){this.videoTags[this.active_idx].current.playbackRate=this.props.speed}this.props.activeMedia!==e.activeMedia&&this.setActiveVideo(this.props.activeMedia)}componentWillUnmount(){this.videoFrameCallbackId&&(this.props.useRequestAnimationFrame?cancelAnimationFrame(this.videoFrameCallbackId):this.videoTags[this.active_idx].current.cancelVideoFrameCallback(this.videoFrameCallbackId))}play(){this.props.useRequestAnimationFrame?this.videoFrameCallbackId=requestAnimationFrame(this.onRequestAnimationFrame):this.videoFrameCallbackId=this.videoTags[this.active_idx].current.requestVideoFrameCallback(this.onVideoFrameCallback),this.videoTags.forEach((e=>{e.current.play()}))}pause(){this.state.countdownActive&&(this.setState({countdownActive:!1}),clearTimeout(this.countdownTimeoutId)),this.props.useRequestAnimationFrame?cancelAnimationFrame(this.videoFrameCallbackId):this.videoTags[this.active_idx].current.cancelVideoFrameCallback(this.videoFrameCallbackId),this.videoFrameCallbackId=null,this.videoTags.forEach((e=>{e.current.pause()}))}render(){return"video-multiview"==this.props.media.type?this.renderMultiview():this.renderSingleview()}}Je.defaultProps={countdown:!1};var Ye=s(58693),Xe=s(94296);class et extends ze{constructor(e){super(e),this.req_id=!1,this.ratio=.5,this.ratesIndex=0,this.state={countdownActive:!1,duration:0,opticalFlowEnabled:!1},this.countdownTimeoutId=null,this.opencv_init=()=>{const e=()=>{this.frame_flow=new cv.Mat(this.props.media.resolution[1],2*this.props.media.resolution[0],cv.CV_8UC4),this.myMean=new cv.Mat(1,4,cv.CV_64F),this.myStddev=new cv.Mat(1,4,cv.CV_64F),this.cap=new cv.VideoCapture(this.videoTag),this.props.paused||this.play()};null==cv.Mat?cv.onRuntimeInitialized=e:e()},this.copyVideoToCanvas=()=>{const e=this.canvasTag.width,t=this.canvasTag.height;this.canvasCtx.drawImage(this.videoTag,0,0,this.props.media.resolution[0],this.props.media.resolution[1],0,0,e,t)},this.getRatesMovingAverage=()=>this.rates.reduce(((e,t)=>e+t),0)/this.rates.length||0,this.frameCallback=()=>{let e;if(this.state.opticalFlowEnabled){const t=this.props.getMousePosition(),s=[t[0]*this.props.media.resolution[0],t[1]*this.props.media.resolution[1]];this.cap.read(this.frame_flow);const a=Math.max(0,s[0]-this.props.L),i=Math.min(s[0]+this.props.L,this.props.media.resolution[0]),n=Math.max(0,s[1]-this.props.L),r=Math.min(s[1]+this.props.L,this.props.media.resolution[1]),o=new cv.Rect(this.props.media.resolution[0]+a,n,i-a,r-n),p=this.frame_flow.roi(o);cv.meanStdDev(p,this.myMean,this.myStddev);if(e=1/Math.max(1,this.myMean.doubleAt(0,0))*this.props.playbackRateMultiplier,e=Math.min(4,Math.max(.1,e)),0!=this.props.T){const t=this.getRatesMovingAverage();e>t&&(e=Math.min(e,1.2*t))}}else e=1*this.props.playbackRateMultiplier;this.videoTag.playbackRate=e,this.rates[this.ratesIndex++%this.props.T]=e,this.props.onFrame(this.videoTag.currentTime),this.req_id=this.videoTag.requestVideoFrameCallback(this.frameCallback),this.copyVideoToCanvas()},this.startPlayCountdown=()=>{this.setState({countdownActive:!0}),this.countdownTimeoutId=setTimeout((()=>{this.setState({countdownActive:!1},(()=>{this.play()}))}),1500)},this.currentTime=(e,t)=>this.videoTag?void 0===e?this.videoTag.currentTime:(this.videoTag.currentTime=e,this.props.setPaused(!0),this.copyVideoToCanvas(),t?t():void 0):null,this.handleToggleOpticalFlow=()=>{this.props.setOpticalFlowEnabled(!this.props.opticalFlowEnabled)},this.renderBar=()=>{let e="";return e=Number.isInteger(this.props.playbackRateMultiplier)?this.props.playbackRateMultiplier.toString():this.props.playbackRateMultiplier.toPrecision(2),i.createElement(Ge,{duration:this.state.duration,currentTime:this.currentTime,paused:this.props.paused,setPaused:this.props.setPaused,speed:this.props.speed,setSpeed:this.props.setSpeed,muted:this.props.muted,setMuted:this.props.setMuted},i.createElement("div",{className:"annot-bar-right"},i.createElement(We.Z,null),i.createElement(f.Z,{size:"small",type:"primary",danger:!0},e)," ",i.createElement(Ye.Z,null),i.createElement(f.Z,{size:"small",danger:this.props.opticalFlowEnabled,type:this.props.opticalFlowEnabled?"primary":"default"},i.createElement(Xe.Z,null)," ",i.createElement(O.Z,{checked:this.props.opticalFlowEnabled,onChange:this.handleToggleOpticalFlow}))))},this.state.opticalFlowEnabled=!!e.media.hasFlow&&e.opticalFlowEnabled,this.rates=Array(e.T).fill(1)}componentDidMount(){const e=this;this.videoTag.addEventListener("loadedmetadata",(function(t){e.state.opticalFlowEnabled&&e.opencv_init()}),!1),this.canvasCtx=this.canvasTag.getContext("2d"),fetch(S(this.props.media.url)).then((e=>e.blob())).then((e=>{this.videoTag.src=window.URL.createObjectURL(e)})).catch((e=>{this.props.onError("There has been an error while loading the videos.",e)})),this.videoTag.addEventListener("loadeddata",(e=>{this.copyVideoToCanvas(),this.setState({duration:this.videoTag.duration}),this.props.onLoad(this.videoTag.duration,this.props.media.fps)})),this.videoTag.addEventListener("ended",(e=>{this.props.onEnd(),this.pause()}))}componentDidUpdate(e){this.props.paused!==e.paused&&(this.props.paused?this.pause():this.props.countdown?this.startPlayCountdown():this.play()),this.props.opticalFlowEnabled!==e.opticalFlowEnabled&&this.setState({opticalFlowEnabled:!!this.props.media.hasFlow&&this.props.opticalFlowEnabled},(()=>{this.state.opticalFlowEnabled&&this.opencv_init()}))}play(){this.videoTag.play(),this.req_id=this.videoTag.requestVideoFrameCallback(this.frameCallback)}pause(){this.videoTag.pause(),this.req_id=!1}restart(){this.currentTime(0)}render(){return i.createElement(i.Fragment,null,this.renderBar(),this.props.wrapPlayerElement(i.createElement("div",{style:{position:"relative"}},i.createElement("canvas",{ref:e=>{this.canvasTag=e},style:{width:"100%"},width:800,height:450}),this.state.countdownActive&&i.createElement(Qe,null))),i.createElement("video",{ref:e=>{this.videoTag=e},width:1920,height:540,crossOrigin:"Anonymous",style:{display:"none"},preload:"auto",disablePictureInPicture:!0,muted:!0}))}}et.defaultProps={L:10,T:0,countdown:!0,opticalFlowEnabled:!0,playbackRateMultiplier:1};const tt={HTML5Player:Je,OpencvFlowPlayer:et},{Title:st,Text:at}=m.Z;class it extends i.Component{render(){return this.props.visible?i.createElement(nt,null,i.createElement("nav",null,this.props.title&&i.createElement(st,{style:{color:"white"}},this.props.title),this.props.subtext&&i.createElement(at,{style:{color:"white"}},"this.props.subtext"),i.createElement("div",{className:"task-overlay-primary"},this.props.mainOptions.map(((e,t)=>{if(e)return i.createElement("span",{key:t,className:"main-option"},e)}))),i.createElement("div",{className:"task-overlay-secondary"},this.props.secondaryOptions&&this.props.secondaryOptions.map(((e,t)=>{if(e)return i.createElement("span",{key:t,className:"secondary-option"},e)}))))):null}}const nt=n.ZP.div`
    position: absolute;
    padding: 1em 0;
    width: 50%;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background-color: rgba(0, 0, 0, .7);
    border-width: 3px;
    border-style: solid;
    border-color: #363636;
    z-index: 2;
  
    span.main-option {
      display: inline-block;
      margin: 0 5px;
    }
  
    > nav {
      width: 100%;
      text-align: center;
    }
  }
  `;var rt=s(80844);async function ot(e,t){return Promise.resolve()}const pt=s(30816).lW;var lt=s(73416)._;class mt{pack(e,t,s,a,i,n,r,o,p){const l=(new TextEncoder).encode(JSON.stringify(r)),m=pt.from(a,i,n),d=pt.from(e,t,s),c=pt.from(l),h=new Uint32Array(4);h[0]=m.byteLength+d.byteLength,h[1]=c.byteLength,h[2]=o,h[3]=p;const u=pt.from(h.buffer),y=pt.concat([u,m,d,c]);return y.buffer.slice(y.byteOffset,y.byteOffset+y.byteLength)}unpackChunkList(e){const t=(new lt).endianess("little").uint32("dataLength").uint32("logsLength").uint32("chunkLength").uint32("recordLength").buffer("data",{length:"dataLength",clone:!0}).string("logs",{length:"logsLength",clone:!0}),s=(new lt).endianess("little").uint32("numChunks").array("chunks",{type:t,length:"numChunks"}),a=pt.from(e),i=s.parse(a);return i.chunks.forEach((e=>{e.logs=JSON.parse(e.logs)})),i}}class dt{constructor(e,t,s,a,i,n,r,o,p){void 0===e&&(e=""),void 0===t&&(t=!1),void 0===s&&(s=1),void 0===a&&(a=!0),void 0===i&&(i=!0),void 0===n&&(n=()=>{}),void 0===r&&(r=60),void 0===o&&(o=1),void 0===p&&(p=5),ct.call(this),this.url=e,this.head=0,this.disabled=t,this.recordDataSize=s,this.recordSize=1+(a?1:0)+this.recordDataSize,this.persistInterval=r,this.lastHitThreshold=o,this.lengthErrorThreshold=p,this.onError=n,this.writeTimestamp=a,this.fill=i,t&&(this.fetch_fn=ot),this.interval=setInterval(this._enqueueDirtyChunks,1e3*r),v().debug(`buffer constructed with recordDataSize=${this.recordDataSize}, lastHitThreshold=${this.lastHitThreshold}, lengthErrorThreshold=${this.lengthErrorThreshold}`)}get headMediatime(){return this.head*this.fps}}var ct=function(){var e,t=this;this.chunks=Array(),this.outBuffer=Array(),this.lengthErrorThreshold=10,this.receivedData=!1,this.cntr=1,this.isDataPromisePending=!1,this.awaitClearPending=!1,this.awaitClearPromise=null,this.fetch_fn=(e=3e3,async function(t,s){const a=new AbortController,i=setTimeout((()=>a.abort()),e),n=await fetch(t,{...s,signal:a.signal});return clearTimeout(i),n}),this.make=function(e,s,a){void 0===s&&(s=60),void 0===a&&(a=200),t.length=e,t.chunkLength=a,t.fps=s,t.head=0,t.numChunks=Math.ceil(e/a),t.chunkDataByteLength=8*t.chunkLength*t.recordSize,t.chunkIdxsByteLength=4*t.chunkLength,t.dataArrayBuff=new ArrayBuffer(t.numChunks*t.chunkDataByteLength),t.dataArray=new Float64Array(t.dataArrayBuff,0,Math.floor(t.dataArrayBuff.byteLength/8)),t.idxsArrayBuff=new ArrayBuffer(t.numChunks*t.chunkIdxsByteLength),t.idxsArray=new Uint32Array(t.idxsArrayBuff,0,Math.floor(t.idxsArrayBuff.byteLength)/4),t._createChunks(),v().debug(`buffer.make called with length=${t.length}(${t.numChunks} x ${t.chunkLength}), fps=${s} recordSize=${t.recordSize}(1+${t.writeTimestamp?"1":"0"}+${t.recordDataSize})`)},this.destroy=()=>{clearInterval(this.interval)},this.reset=()=>{this.receivedData=!1},this._createChunks=()=>{v().debug("_createChunks"),this.chunks=Array();for(let e=0;e<this.numChunks;e++){const t={chunk_index:e,idxs:new Uint32Array(this.idxsArrayBuff,e*this.chunkIdxsByteLength,Math.floor(this.chunkIdxsByteLength/4)),data:new Float64Array(this.dataArrayBuff,e*this.chunkDataByteLength,Math.floor(this.chunkDataByteLength/8)),logs:Array(),dirty:!1,inQueue:!1,lastHit:Date.now()};this.chunks.push(t)}},this._loadChunk=function(e,s,a){void 0===a&&(a=null),t.chunks[e].idxs.set(new Uint32Array(s,0,Math.floor(t.chunkIdxsByteLength/4))),t.chunks[e].data.set(new Float64Array(s,t.chunkIdxsByteLength,Math.floor(t.chunkDataByteLength/8)))},this.loadChunks=e=>{if(0===e.byteLength)throw new Error("Provided ArrayBuffer is empty");const t=(new mt).unpackChunkList(e).chunks;for(let s=0;s<t.length;s++)this._loadChunk(s,t[s].data.buffer,t[s].logs);this.reset()},this._load=async()=>{const e=this.url+"/chunks";if(this.loadDataPromise&&this.isDataPromisePending)return this.loadDataPromise;const t=new Headers;t.append("pragma","no-cache"),t.append("cache-control","no-cache");const s={method:"GET",headers:t};return this.isDataPromisePending=!0,this.loadDataPromise=E(e,s).then((async e=>{const t=await e.arrayBuffer();this.loadChunks(t)})).catch((e=>{})).finally((()=>{this.isDataPromisePending=!1})),this.loadDataPromise},this._getChunkNum=e=>Math.floor(e/this.chunkLength),this._write=(e,t)=>{const s=Math.round(e*this.fps);let a,i;if(this.fill){if(a=this.head,i=s,a>i)return v().warn(`Attempt to write non-sequentially with fill=true, head=${this.head}, frameNum=${s}`)}else a=s,i=s;for(let n=a;n<=i;n++){const e=n*this.recordSize;let s=0;for(;s<this.recordSize;s++)this.dataArray[e+s]=t[s];this.idxsArray[n]=this.cntr++;const a=this._getChunkNum(n);this.chunks[a].dirty=!0,this.chunks[a].lastHit=Date.now()}this.head=s+1},this.makeIterator=function(e,s,a,i){void 0===i&&(i=1);let n=s;return{next:()=>{let s;return n<a?(s={value:[n,t.dataArray[n*t.recordSize+1+(t.writeTimestamp?1:0)+e]],done:!1},n+=i,s):{value:[],done:!0}}}},this.makeReverseIterator=function(e,s,a,i){void 0===i&&(i=1);let n=e;return s=Math.max(0,s),{next:()=>{let e;return n>s?(e={value:[n,t.dataArray[n*t.recordSize+1+(t.writeTimestamp?1:0)+a]],done:!1},n-=i,e):{value:[],done:!0}}}},this.isOutBufferFull=()=>this.outBuffer.length>this.lengthErrorThreshold,this.seek=e=>{const t=Math.round(e*this.fps);this.head=t},this.data=(e,t)=>{if(this.disabled)return;if(this.receivedData=!0,t.length!==this.recordDataSize)throw new Error("invalid record size provided to data().");let s;s=this.writeTimestamp?[e,Date.now(),...t]:[e,...t],this._write(e,s)},this.readFrame=e=>{if(void 0===this.idxsArray[e])return[null,null];let t=[];if(0===this.idxsArray[e])t=null;else{t=[];const s=e*this.recordSize;for(let e=0;e<this.recordSize;e++)t.push(this.dataArray[s+e])}return[t,[]]},this.read=e=>{const t=Math.round(e*this.fps);return this.readFrame(t)},this.readHead=()=>this.readFrame(this.head),this.log=(e,t)=>{if(this.disabled)return;this.receivedData=!0;const s=Math.round(e*this.fps),a=this._getChunkNum(s);v().info(`logging ${JSON.stringify(t)} for frameNum = ${s}, chunkNum = ${a}`);const i=[this.cntr++,e,t];this.chunks[a].logs.push(i),this.chunks[a].dirty=!0,this.chunks[a].lastHit=Date.now()},this._enqueueDirtyChunks=()=>{v().debug(`_enqueueDirtyChunks, buffer length=${this.outBuffer.length}`),this.isOutBufferFull()&&this.onError(`Output buffer full (length=${this.outBuffer.length}). Data may be lost.`),this.chunks.forEach(((e,t)=>{e.dirty&&!e.inQueue&&e.lastHit<Date.now()-1e3*this.lastHitThreshold&&(v().debug(`enqueing chunk ${e.chunk_index}`),this.outBuffer.push(e),e.inQueue=!0)})),this.awaitClear()},this.flush=async function(e){return void 0===e&&(e=8e3),t.receivedData?(t.chunks.forEach((e=>{e.dirty&&!e.inQueue&&(t.outBuffer.push(e),e.inQueue=!0)})),t.awaitClear(e)):Promise.resolve()},this.submitChunk=async()=>{v().debug("submitChunk");const e=this.outBuffer[0],t={method:"POST",body:(new mt).pack(this.dataArrayBuff,e.chunk_index*this.chunkDataByteLength,this.chunkDataByteLength,this.idxsArrayBuff,e.chunk_index*this.chunkIdxsByteLength,this.chunkIdxsByteLength,e.logs,this.chunkLength,this.recordSize)},s=this.url+"/chunk?"+new URLSearchParams({index:e.chunk_index.toString(),length:this.chunkLength.toString()});return v().debug(`submitting chunk ${e.chunk_index}`),this.fetch_fn(s,t).then((async e=>{const t=await e.json();if(!e.ok){const s=t&&t.message||e.status;return Promise.reject(s)}this.outBuffer.shift()}))},this.awaitClear=async function(e){return void 0===e&&(e=0),t.awaitClearPending||(t.awaitClearPending=!0,t.awaitClearPromise=Promise.race([(async()=>{for(;t.outBuffer.length>0;)await t.submitChunk()})(),new Promise(((t,s)=>{setTimeout((()=>{s(new Error("The server is taking too long to respond."))}),e)}))]),t.awaitClearPromise.finally((()=>{t.awaitClearPending=!1}))),t.awaitClearPromise}};const ht=Object.freeze({parent:null,disabled:!1,previewMode:!1,interfaceMode:"annotation",renderTaskSubmitButton:null,renderTaskNextButton:null,fetchTaskResponse:()=>Promise.resolve(null),submitTaskResponse:()=>Promise.resolve(null),onSubmit:()=>{},onClickNext:()=>{}});class ut extends i.Component{constructor(e){super(e),yt.call(this);const{taskConstructor:t,taskReducer:s}=(e=>{if(e in He){const t=He[e];return"object"==typeof t&&"taskConstructor"in t&&"taskReducer"in t?t:{taskConstructor:t,taskReducer:null}}return null})(this.props.task.spec.type);this.taskConstructor=t,this.taskReducer=s,this.state.taskInfo=this.getTaskRenderAs(),this.state.instructions.visible="popped"==this.props.task.spec.instructionsType,this.isContinuous&&(this.buffer=new dt(null,this.props.previewMode,this.taskConstructor.taskInfo.bufferDataLen,!0,!0,this.handleBufferError))}get isContinuous(){return"continuous-task"==this.state.taskInfo.type}componentWillUnmount(){this.loadPromise.promise.catch((()=>{})),this.loadPromise.cancel()}render(){return v().debug(`task_loader render() with status=${this.state.status} renderAs.type = "${this.state.taskInfo.type}", replayMode=${this.state.replayMode}`),"loading"==this.state.status?i.createElement(we.Z,null):i.createElement(i.Fragment,null,this.renderErrorModal(),this.renderOverlay(),i.createElement("div",{ref:e=>{this.taskInstructionsElem=e}}),i.createElement("div",{style:{width:"100%",height:"100%",position:"relative"}},(()=>{let e,t={spec:this.props.task.spec,response:this.isContinuous&&!this.state.replayMode?null:this.response,buffer:this.buffer,buttons:this.context.getContext(),getSharedState:this.getSharedState};if("taskSpecific"in this.props.task&&(t={...t,...this.props.task.taskSpecific}),"default"==this.state.taskInfo.type){e={...t,disabled:this.props.disabled,onSubmit:e=>this.handleTaskSubmit(e,"task"),renderSubmitButton:this.props.renderTaskSubmitButton}}else{e={...t,player:this.getPlayerContext(),renderPlayer:this.renderPlayer,onEnd:this.handleTaskEnd}}return i.createElement(this.taskConstructor,{key:this.state.taskKey,myKey:this.state.taskKey,ref:e=>{this.createTaskRef(e)},...e},null)})()))}}ut.defaultProps=ht;var yt=function(){var e=this;this.endTaskResult=null,this.listeners={},this.state={status:"loading",taskInfo:null,replayMode:!1,taskKey:0,player:{duration:null,loaded:!1,paused:!0,muted:!1},errorModal:{visible:!1},overlay:{visible:!1},instructions:{visible:!1}},this.getTaskRenderAs=()=>{let e="default";return"continuous"==this.taskConstructor.taskType&&(e="continuous-task"),{type:e,timed:!1}},this.isMaxSubmissionsReached=()=>this.props.task.maxSubmissions&&this.props.task.num_submissions>=this.props.task.maxSubmissions,this.componentDidMount=()=>{v().debug(`task_loader componentDidMount() with status=${this.state.status} renderAs.type = "${this.state.taskInfo.type}", replayMode=${this.state.replayMode}`),this.loadPromise=(e=>{let t=!1;return{promise:new Promise(((s,a)=>{e.then((e=>t?a({isCanceled:!0}):s(e)),(e=>a(t?{isCanceled:!0}:e)))})),cancel(){t=!0}}})(Promise.all([this.props.fetchTaskResponse(this.props.task).then((e=>{this.response=e,this.buffer&&(this.buffer.url=e.url)})),this.props.parent&&this.props.fetchTaskResponse(this.props.parent).then((e=>{this.parentResponse=e}))])),this.loadPromise.promise.then((e=>{this.reloadTask(!1,!0)}))},this.reloadTask=function(t,s){void 0===t&&(t=!1),void 0===s&&(s=!1),e.isContinuous?(e._playerLoaded=new Promise(((t,s)=>{e._playerLoadedResolve=t,e._playerLoadedReject=s})),e.setState({status:"player-loading",taskKey:e.state.taskKey+1}),e._playerLoaded.then((a=>{(s&&e.response&&e.response.submitted?Promise.resolve():e.makeContinuousBuffers(a,t)).then((()=>{e.setState({replayMode:t,status:s&&e.response&&e.response.submitted?"loaded":"ready",player:{...e.state.player,paused:!0,duration:a}})}))}))):e.setState({replayMode:t,status:"ready",taskKey:e.state.taskKey+1})},this.makeContinuousBuffers=function(t,s){void 0===s&&(s=!1);const a=e.props.task.spec.media.fps||60,i=Math.ceil(t*a);return e.buffer.make(i,a),s?e.loadBuffers():Promise.resolve()},this.loadBuffers=()=>Promise.all([this.buffer?this.buffer._load():Promise.resolve(),this.parentBuffer?this.parentBuffer._load():Promise.resolve()]),this.loadTaskForReplay=()=>{this.reloadTask(!0)},this.clearAndReloadTask=()=>E(this.props.task.url+"/make_response?"+new URLSearchParams({}),{method:"POST"}).then(C).then((e=>{this.response=e,this.buffer&&(this.buffer.url=e.url),this.reloadTask(!1)})).catch((e=>{x("Error making task response.",e)})),this.handleTaskSubmit=(e,t)=>{(this.buffer?this.buffer.flush():Promise.resolve()).then((()=>this.props.submitTaskResponse(this.response,e))).then((e=>{this.response=e.response,this.setState({status:"submitted"}),this.props.onSubmit(t)})).catch((e=>{x("Error submitting the task.",e),this.setState({status:"ended"})}))},this.handleTaskEnd=function(t,s){if(void 0===s&&(s=!1),e.props.task.autoSubmit&&!e.state.replayMode)return e.handleTaskSubmit(t,"modal");e.endTaskResult=t,e.setState({status:"ended"})},this.handleBufferError=e=>{this.setState({errorModal:{...this.state.errorModal,visible:!0,message:e}})},this.handleErrorOk=()=>{this.setState({errorModal:{visible:!0,message:"Attempting to submit. The window will be closed if successful.",loading:!0}})},this.handleErrorCancel=()=>{this.setState({errorModal:{...this.state.errorModal,visible:!1}})},this.renderErrorModal=()=>i.createElement(y.Z,{title:"Error",visible:this.state.errorModal.visible,confirmLoading:this.state.errorModal.loading,onOk:this.handleErrorOk,onCancel:this.handleErrorCancel,cancelButtonProps:{disabled:!0},okButtonProps:{}},i.createElement("p",null,this.state.errorModal.message)),this.getOverlayInitTimedTask=()=>({title:"This is a timed task!",subtext:'Make sure to set up and be ready before you hit "Start". Once you do you will not be able to stop the countdown.',mainOptions:[i.createElement(f.Z,{type:"primary",onClick:()=>{}},"Start")]}),this.getOverlayAfterReplayOrStop=()=>({title:"Replay finished",mainOptions:[i.createElement(f.Z,{danger:!0,type:"primary",onClick:this.clearAndReloadTask,disabled:this.isMaxSubmissionsReached()},"Restart Task"),i.createElement(f.Z,{type:"primary",onClick:this.loadTaskForReplay,loading:this.state.overlay.submitting},"Watch again"),this.props.renderTaskNextButton()]}),this.getOverlayNonSubmittedTask=()=>({title:"Done!",mainOptions:[i.createElement(f.Z,{danger:!0,type:"primary",onClick:this.clearAndReloadTask,disabled:this.isMaxSubmissionsReached()},"Discard & Restart"),i.createElement(f.Z,{type:"primary",onClick:()=>{this.handleTaskSubmit(this.endTaskResult,"modal")},loading:this.state.overlay.submitting},"Submit")],secondaryOptions:[this.props.task.num_submissions>0&&i.createElement(f.Z,{danger:!0,type:"text",onClick:this.loadTaskForReplay},"Discard and replay last submission")]}),this.getOverlaySubmittedTask=()=>({title:"Your task is submitted!",mainOptions:[i.createElement(f.Z,{danger:!0,type:"primary",onClick:this.clearAndReloadTask,disabled:this.isMaxSubmissionsReached()},"Submit again"),i.createElement(f.Z,{type:"default",onClick:this.loadTaskForReplay,loading:this.state.overlay.submitting},"Replay submission"),this.props.renderTaskNextButton()]}),this.renderOverlay=()=>{switch(this.state.status){case"loaded":if(this.props.task.num_submissions>0&&"continuous-task"==this.state.taskInfo.type)return i.createElement(it,(0,a.Z)({visible:!0},this.getOverlaySubmittedTask()));if(this.props.task.timer)return i.createElement(it,(0,a.Z)({visible:!0},this.getOverlayInitTimedTask()));break;case"ended":return this.state.replayMode?i.createElement(it,(0,a.Z)({visible:!0},this.getOverlayAfterReplayOrStop())):i.createElement(it,(0,a.Z)({visible:!0},this.getOverlayNonSubmittedTask()));case"submitted":if("continuous-task"==this.state.taskInfo.type)return i.createElement(it,(0,a.Z)({visible:!0},this.getOverlaySubmittedTask()));break;default:return null}},this.createTaskRef=e=>{this.taskInstructionsElem&&(this.taskElement=e,e&&e.instructions?Ne.render(this.renderTaskInfo(e.instructions()),this.taskInstructionsElem):this.props.task.spec.instructions&&Ne.render(this.renderTaskInfo(null),this.taskInstructionsElem))},this.createPlayerRef=e=>{this.player=e},this.hideInstructions=()=>{this.setState({instructions:{...this.state.instructions,visible:!1}})},this.handleInstructionsVisibleChange=e=>{this.setState({instructions:{...this.state.instructions,visible:e}})},this.renderTaskInfo=function(t){return void 0===t&&(t=null),i.createElement(Te.Z,{title:"Instructions",placement:"bottom",visible:e.state.instructions.visible,onVisibleChange:e.handleInstructionsVisibleChange,content:i.createElement(ft,null,e.props.task.spec.instructions,t,i.createElement("div",{style:{textAlign:"right"}},i.createElement(f.Z,{type:"primary",onClick:e.hideInstructions},"OK"))),trigger:"click"},i.createElement("div",{className:"task-instructions-button"},i.createElement(rt.Z,null)," Instructions"))},this.setPaused=e=>{this.setState({player:{...this.state.player,paused:e}})},this.setMuted=e=>{this.setState({player:{...this.state.player,muted:e}})},this.addListener=(e,t)=>{e in this.listeners||(this.listeners[e]=[]),this.listeners[e].push(t)},this.removeListeners=e=>{e in this.listeners&&delete this.listeners[e]},this.dispatchPlayerEvent=function(t){for(var s=arguments.length,a=new Array(s>1?s-1:0),i=1;i<s;i++)a[i-1]=arguments[i];t in e.listeners&&e.listeners[t].forEach((e=>{e(...a)}))},this.handlePlayerLoad=(e,t)=>{v().debug(`handlePlayerLoad called, duration=${e}`),this._playerLoadedResolve(e),this.dispatchPlayerEvent("load",e,t)},this.handlePlayerFrame=e=>{this.dispatchPlayerEvent("frame",e)},this.handlePlayerEnd=()=>{this.setState({player:{...this.state.player,paused:!0}}),this.dispatchPlayerEvent("end")},this.getPlayerContext=()=>({paused:this.state.player.paused,muted:this.state.player.muted,togglePlayPause:()=>{this.setPaused(!this.state.player.paused)},play:()=>{this.setPaused(!0)},pause:()=>{this.setPaused(!1)},mute:()=>{this.setMuted(!0)},unmute:()=>{this.setMuted(!1)},currentTime:e=>this.player.currentTime(e),addListener:this.addListener,removeListeners:this.removeListeners}),this.renderPlayer=function(t){void 0===t&&(t={});const s=(e=>{if(e in tt)return tt[e];return null})(t.type),a={...t,ref:e.createPlayerRef,paused:e.state.player.paused,setPaused:e.setPaused,muted:e.state.player.muted,setMuted:e.setMuted,onLoad:e.handlePlayerLoad,onFrame:e.handlePlayerFrame,onEnd:e.handlePlayerEnd,onEvent:e.dispatchPlayerEvent};return i.createElement(s,a,null)}};ut.contextType=fe;const ft=n.ZP.div`
    width: calc(30vw);
    max-height: calc(50vh);
`,{Panel:kt}=l.Z,{Text:gt}=m.Z,bt="http://127.0.0.1:5000/api";class vt extends i.Component{constructor(e){super(e),Nt.call(this),this.url=bt+"/instances/"+this.props.id;const t=this.makeTaskIds();let s=0;e.match&&void 0!==e.match.params.taskId&&(s=Math.min(t.length-1,parseInt(e.match.params.taskId))),this.state={...this.state,currTask:[s,null],taskIds:t,prerequisitesCompleted:this.prerequisitesCompleted()},this.updateUrl(s)}componentDidMount(){}componentDidUpdate(e){this.props.tasks!=e.tasks&&this.setState({taskIds:this.makeTaskIds()})}render(){const e=this.getTask(this.state.currTask),t=null!=this.state.currTask[1]?this.getTask([this.state.currTask[0],null]):null,s=this.getHitExtra();return i.createElement(ve,null,i.createElement(d.Z,{onClick:this.handleMenuClick,mode:"horizontal",theme:"dark",style:{position:"sticky",top:0,width:"100%",zIndex:1e3}},i.createElement(d.Z.Item,{key:"logo",disabled:!0},i.createElement(X,null)),i.createElement(d.Z.Item,{key:"task",disabled:!0},i.createElement(gt,{strong:!0,style:{color:"white"}},e.spec.name)),s&&i.createElement(d.Z.Item,{key:"extra",icon:i.createElement(o.Z,null)},"Extra")),i.createElement(wt,{height:this.props.height},this.renderMenu()),i.createElement(Tt,{height:this.props.height},s&&i.createElement(g(),{open:this.state.extraOpen},i.createElement(c.Z,null,i.createElement(h.Z,{span:24},s))),i.createElement(c.Z,{style:{height:"100%"}},this.props.interface.showProgress&&i.createElement("div",{style:{margin:"5px 15px"}},(()=>{const e=Object.values(this.props.tasks).filter((e=>e.valid)).length,t=Object.values(this.props.tasks).length;return i.createElement(u.Z,{percent:100*e/t,format:s=>e+"/"+t,trailColor:"#c0c0c0"})})()),i.createElement(ut,{key:this.state.currKey,task:e,parent:t,interfaceMode:this.props.interface.type,disabled:!!e.maxSubmissions&&e.num_submissions>=e.maxSubmissions||e.prerequisite&&e.valid,previewMode:this.props.previewMode,renderTaskSubmitButton:this.renderTaskSubmitButton,renderTaskNextButton:this.renderTaskNextButton,fetchTaskResponse:this.props.fetchTaskResponse,submitTaskResponse:this.props.submitTaskResponse,onClickNext:this.gotoNextTask,onSubmit:this.handleTaskSubmitted}))))}}vt.defaultProps={interface:{type:"annotation",userTasks:{},showProgress:!1}};var Nt=function(){this.state={taskIds:[],currTask:[null,null],currKey:0,loadingTask:!0,extraOpen:!1,prerequisitesCompleted:!1},this.instructionsFn=null,this.replayIndex=0,this.makeTaskIds=()=>this.props.tasks.map(((e,t)=>[t,e.children.map(((e,t)=>t))])),this.getTask=e=>{const t=this.state.taskIds[e[0]][0];if(null==e[1])return this.props.tasks[t];{const s=this.state.taskIds[e[0]][1][e[1]];return this.props.tasks[t].children[s]}},this.getPrevTask=e=>{const t=e[0],s=null==e[1]?0:e[1]+1;let a,i;if(0===s){if(0===t)return[null,null];a=t-1,i=this.state.taskIds[a][1].length}else a=t,i=s-1;return i=i?i-1:null,[a,i]},this.getNextTask=e=>{const t=this.getTask(e),s=e[0];let a,i;return i=((null==e[1]?0:e[1]+1)+1)%(t.children.length+1),a=s+Number(0===i),i=i?i-1:null,a===this.state.taskIds.length&&(a=null),[a,i]},this.handleChangeActiveTask=e=>{this.replayIndex=0,this.instructionsFn=null,this.setState({currTask:e,currKey:this.state.currKey+1}),this.updateUrl(e[0])},this.gotoNextTask=()=>{this.state.currTask[0]!==this.state.taskIds.length-1||null!==this.state.currTask[1]&&this.state.currTask[1]!==this.state.taskIds[this.state.currTask[0]][1].length-1?this.handleChangeActiveTask(this.getNextTask(this.state.currTask)):this.handleHitSubmit()},this.prerequisitesCompleted=()=>{let e=!0;return this.props.tasks.forEach((t=>{t.prerequisite&&!t.valid&&(e=!1),t.children.forEach((s=>{t.prerequisite&&!t.valid&&(e=!1)}))})),e},this.handleTaskSubmitted=e=>{const t="timeline"==this.props.interface.type&&"task"==e,s=this.prerequisitesCompleted();if(!this.state.prerequisitesCompleted&&s)return this.props.reloadHit((()=>{t&&this.gotoNextTask()}));t&&this.gotoNextTask()},this.updateUrl=e=>{this.props.routingEnabled&&window.history.pushState(null,null,"#"+(0,r.Gn)(this.props.match.path,{hitId:this.props.match.params.hitId,taskId:e}))},this.handleMenuClick=e=>{"extra"==e.key&&this.setState({extraOpen:!this.state.extraOpen})},this.showCompletionInfo=()=>{const e=this.props.completionInfo;return y.Z.success({title:"HIT submitted!",content:i.createElement(i.Fragment,null,i.createElement("p",null,"Thank you! Your work has been submitted."),e.redirectUrl?i.createElement(i.Fragment,null,i.createElement("p",null,"If you came from ",e.redirectName?e.redirectName:"another site"," you may click here to be redirected:"),i.createElement(f.Z,{type:"primary",icon:i.createElement(p.Z,null),href:e.redirectUrl},"Back to ",e.redirectName?e.redirectName:"site")):i.createElement(i.Fragment,null,i.createElement("p",null,"Your completion code is:"),i.createElement("pre",null,e.completionCode)))})},this.handleHitSubmit=()=>{this.props.onSubmit().then((()=>{this.showCompletionInfo()})).catch((e=>{e.message.includes("required tasks")?x(e.message+" Please make sure all tasks are marked green before submitting.",e):x("Error submitting HIT. Please try again or contact the organizers.",e)}))},this.canSubmitHit=()=>{let e=!0;return this.props.tasks.forEach((t=>{t.required&&!t.valid&&(e=!1)})),e},this.renderMenu=()=>{const e=this.state.taskIds.map((e=>{const t=this.props.tasks[e[0]];return t.children=e[1].map((e=>t.children[e])),t}));return i.createElement(i.Fragment,null,i.createElement(le,{tasks:e,currTask:this.state.currTask,onChangeActiveTask:this.handleChangeActiveTask,editMode:{enabled:!0,allowNew:"userTasks"in this.props.interface&&Object.entries(this.props.interface.userTasks).length>0,presets:this.props.interface.userTasks,onTaskEdit:this.props.editTask,onTaskCreate:this.props.createTask,onTaskDelete:this.props.deleteTask}},!this.props.submitted&&this.props.interface.showSubmitButton&&i.createElement(f.Z,{type:"primary",style:{width:"100%",backgroundColor:"#5b8c00",borderColor:"#5b8c00"},onClick:this.handleHitSubmit,disabled:!this.canSubmitHit()},"Submit HIT"),this.props.submitted&&i.createElement(f.Z,{type:"primary",style:{width:"100%",backgroundColor:"#5b8c00",borderColor:"#5b8c00"},onClick:this.showCompletionInfo},"Show completion code")))},this.getHitExtra=()=>!!this.props.extra&&i.createElement(q,{content:this.props.extra}),this.renderTaskSubmitButton=e=>i.createElement(f.Z,(0,a.Z)({type:"primary",htmlType:"submit"},e),"annotation"==this.props.interface.type?"Submit":"Next"),this.renderTaskNextButton=e=>i.createElement(f.Z,(0,a.Z)({type:"primary",onClick:this.gotoNextTask},e),"Next")};const wt=n.ZP.div`
    position: sticky;
    display: inline-block;
    vertical-align: top;
    top:46px;
    height: ${e=>Math.floor(e.height)-46+"px;"}
	width: 25%;
	overflow: auto;
`,Tt=n.ZP.div`
    position: absolute;
    display: inline-block;
    vertical-align: top;
    height: ${e=>Math.floor(e.height)-46+"px;"}
    width: calc(100% - 25%);
    overflow: auto;
`,xt=(0,r.EN)(vt)},51573:(e,t,s)=>{const a=s(30469);var i=s(98784);e.exports.c=class{constructor(e){var t=this;this._dereference=function(e,s){return void 0===s&&(s=null),null==s&&(s=e.$id),i.forOwn(e,((e,a,n)=>{if(i.isObject(e))if(e.$ref){let r;r=i.startsWith(e.$ref,"#")?s+e.$ref.substr(1):e.$ref;const o=t.ajv.getSchema(r);n[a]=t._dereference(o.schema,s)}else t._dereference(e,s)})),e},this.get_friendly_error_message=e=>"keyword"in e?"additionalProperties"==e.keyword?e.message+`. Property '${e.params.additionalProperty}' is unrecognized.`:"discriminator"==e.keyword&&"mapping"==e.params.error?`Invalid value '${e.params.tagValue}' for property '${e.params.tag}'. Please make sure you are using a supported value.`:e.message:e.message,this.get_python_datapath=e=>e.substring(1).split("/").map((e=>isNaN(e)?`["${e}"]`:"["+e+"]")).join(""),this.schemata=e,this.ajv=new a({discriminator:!0,verbose:!0,logger:!1,allErrors:!1}),this.ajv.addSchema(this.schemata)}get_schema(e){return this.ajv.getSchema(`#/definitions/${e}`).schema}get_deref_schema(e,t){const s=this.get_schema(e);return t&&t(s),this._dereference(s,"#")}validate_schema(e,t){const s=this.ajv.getSchema(`#/definitions/${e}`);if(void 0===s)throw Error(`Unable to find schema ${e}`);const a=s(t);return{valid:a,errors:a?[]:s.errors.map((e=>(console.log(e),{...e,friendlyMessage:this.get_friendly_error_message(e),friendlyPath:this.get_python_datapath(e.instancePath)})))}}}},60573:(e,t,s)=>{"use strict";s.d(t,{Z:()=>pe});var a=s(67294),i=s(71577),n=s(10808),r=s(10149),o=s(1912),p=s(39097),l=s(77123),m=s(57132),d=s(74855);s(94184);class c extends a.Component{render(){return React.createElement(React.Fragment,null,React.createElement("div",null,React.createElement("pre",{className:classNames("docs-code-block")},JSON.stringify(this.props.code,null,2))))}}class h extends a.Component{render(){return a.createElement(a.Fragment,null,a.createElement("div",{style:{border:"1px solid #c8c8c8",overflow:"hidden"}},a.createElement("div",{style:{backgroundColor:"#d8d8d8",padding:"3px 5px",textAlign:"center",color:"#555555"}},"LIVE PREVIEW: data is not being collected"),this.props.children))}}var u=s(87462);class y extends a.Component{constructor(e){super(e),this.state={}}render(){let e=JSON.parse(JSON.stringify(this.props.hit));return e.tasks=e.tasks.map(((e,t)=>(e.id=t,e.children||(e.children=[]),e))),a.createElement(a.Fragment,null,(()=>{const t=s(73727).gx,i=s(73343).Z;return a.createElement(t,null,a.createElement("div",{style:{position:"relative",width:"100%",height:this.props.height+"px",border:"1px solid #969696"}},a.createElement(i,(0,u.Z)({},e,{height:this.props.height,routingEnabled:!1,url:null,previewMode:!0,fetchTaskResponse:()=>Promise.resolve({}),onSubmit:()=>{}}))))})())}}y.defaultProps={height:500};var f=s(51573),k=s(91262),g=s(66509),b=s(19521),v=s(27296),N=s(48115),w=s(80882),T=s(48689),x=s(24969),S=s(45605),E=s(32808);const{asNumber:C,guessType:I,schemaRequiresTrueValue:M}=g.P6,P=new Set(["number","integer"]);function R(e,t){const{type:s,items:a}=e;if(""!==t){if("array"===s&&a&&P.has(a.type))return t.map(C);if("boolean"===s)return"true"===t;if("number"===s)return C(t);if(e.enum){if(e.enum.every((e=>"number"===I(e))))return C(t);if(e.enum.every((e=>"boolean"===I(e))))return"true"===t}return t}}function q(e,t){return t?[].slice.call(e.target.options).filter((e=>e.selected)).map((e=>e.value)):e.target.value}const{getUiOptions:F,isObject:L,isSelect:O,isMultiSelect:_,isFilesArray:A,mergeObjects:D,toIdSchema:$,getSchemaType:j,canExpand:Z,getWidget:V,guessType:z,retrieveSchema:B,getDefaultFormState:U,schemaRequiresTrueValue:H,deepEquals:K}=g.P6;function W(e){return a.createElement(i.Z,{type:"primary",shape:"circle",disabled:e.disabled,onClick:e.onClick,icon:a.createElement(x.Z,null)})}function G(e){const{label:t,required:s,id:i}=e;return t?a.createElement("label",{className:"control-label",htmlFor:i},t,s&&a.createElement("span",{className:"required"},"*")):null}const Q={array:"ArrayField",boolean:"BooleanField",integer:"NumberField",number:"NumberField",object:"ObjectField",string:"StringField",null:"NullField"};function J(e){const{id:t,help:s}=e;return s?"string"==typeof s?a.createElement("p",{id:t,className:"help-block"},s):a.createElement("div",{id:t,className:"help-block"},s):null}function Y(e){const{errors:t=[]}=e;return 0===t.length?null:a.createElement("div",null,a.createElement("ul",{className:"error-detail bs-callout bs-callout-info"},t.filter((e=>!!e)).map(((e,t)=>a.createElement("li",{className:"text-danger",key:t},e)))))}function X(e){let{uiSchema:t,formData:s,errorSchema:i,idPrefix:n,name:r,onChange:o,onKeyChange:p,onDropPropertyClick:l,required:m,displayLabel:d,registry:c=getDefaultRegistry(),wasPropertyKeyModified:h=!1}=e;const{rootSchema:y,fields:f,formContext:k}=c,g=t["ui:FieldTemplate"]||c.FieldTemplate||DefaultTemplate;let b=e.idSchema;const v=B(e.schema,y,s);b=D($(v,null,y,s,n),b);const N=function(e,t,s,i){const n=t["ui:field"];if("function"==typeof n)return n;if("string"==typeof n&&n in i)return i[n];const r=Q[j(e)];return r||!e.anyOf&&!e.oneOf?r in i?i[r]:()=>{const{UnsupportedField:t}=i;return a.createElement(t,{schema:e,idSchema:s,reason:`Unknown field type ${e.type}`})}:()=>null}(v,t,b,f),{DescriptionField:w}=f,T=Boolean(e.disabled||t["ui:disabled"]),x=Boolean(e.readonly||t["ui:readonly"]||e.schema.readOnly||v.readOnly),S=Boolean(e.autofocus||t["ui:autofocus"]);if(0===Object.keys(v).length)return null;void 0===d&&(d=function(e,t,s){const a=F(t);let{label:i=!0}=a;const n=j(e);return"array"===n&&(i=_(e,s)||A(e,t,s)),"object"===n&&(i=!0),t["ui:field"]&&(i=!1),i}(v,t,y));const{__errors:E,...C}=i,I=a.createElement(N,(0,u.Z)({},e,{idSchema:b,schema:v,uiSchema:{...t,classNames:void 0},disabled:T,readonly:x,autofocus:S,errorSchema:C,formContext:k,rawErrors:E})),M=b.$id;let P;P=h?r:t["ui:title"]||e.schema.title||v.title||r;const R=t["ui:description"]||e.schema.description||v.description,q=E,L=t["ui:help"],Z="hidden"===t["ui:widget"],V=["form-group","field",`field-${v.type}`,q&&q.length>0?"field-error has-error has-danger":"",t.classNames].join(" ").trim(),z={description:a.createElement(w,{id:M+"__description",description:R,formContext:k}),rawDescription:R,help:a.createElement(J,{id:M+"__help",help:L}),rawHelp:"string"==typeof L?L:void 0,errors:a.createElement(Y,{errors:q}),rawErrors:q,id:M,label:P,hidden:Z,onChange:o,onKeyChange:p,onDropPropertyClick:l,required:m,disabled:T,readonly:x,displayLabel:d,classNames:V,formContext:k,formData:s,fields:f,schema:v,uiSchema:t,registry:c},U=c.fields.AnyOfField,H=c.fields.OneOfField;return a.createElement(g,z,a.createElement(a.Fragment,null,I,v.anyOf&&!O(v)&&a.createElement(U,{disabled:T,errorSchema:i,formData:s,idPrefix:n,idSchema:b,onBlur:e.onBlur,onChange:e.onChange,onFocus:e.onFocus,options:v.anyOf.map((e=>B(e,y,s))),baseType:v.type,registry:c,schema:v,uiSchema:t}),v.oneOf&&!O(v)&&a.createElement(H,{disabled:T,errorSchema:i,formData:s,idPrefix:n,idSchema:b,onBlur:e.onBlur,onChange:e.onChange,onFocus:e.onFocus,options:v.oneOf.map((e=>B(e,y,s))),baseType:v.type,registry:c,schema:v,uiSchema:t})))}class ee extends a.Component{shouldComponentUpdate(e,t){return!K(this.props,e)}render(){return X(this.props)}}ee.defaultProps={uiSchema:{},errorSchema:{},idSchema:{},disabled:!1,readonly:!1,autofocus:!1};class te extends a.Component{constructor(e){super(e),se.call(this);const{formData:t,options:s}=this.props;this.state={selectedOption:this.getMatchingOption(t,s)}}componentDidUpdate(e,t){if(!K(this.props.formData,e.formData)&&this.props.idSchema.$id===e.idSchema.$id){const e=this.getMatchingOption(this.props.formData,this.props.options);if(!t||e===this.state.selectedOption)return;this.setState({selectedOption:e})}}getMatchingOption(e,t){const{rootSchema:s}=this.props.registry;let a=function(e,t,s){for(let a=0;a<t.length;a++){const s=t[a];if(s.properties)for(const[t,i]of Object.entries(s.properties))if(t in e&&"enum"in i&&1===i.enum.length&&i.enum[0]===e[t])return a}return 0}(e,t);return 0!==a?a:this&&this.state?this.state.selectedOption:0}render(){const{baseType:e,disabled:t,errorSchema:s,formData:i,idPrefix:n,idSchema:r,onBlur:o,onChange:p,onFocus:l,options:m,registry:d,uiSchema:c,schema:h}=this.props,y=d.fields.SchemaField,{widgets:f}=d,{selectedOption:k}=this.state,{widget:g="select",...b}=F(c),v=V({type:"number"},g,f),N=m[k]||null;let w;N&&(w=N.type?N:Object.assign({},N,{type:e}));const T=m.map(((e,t)=>({label:e.title||`Option ${t+1}`,value:t})));return a.createElement(a.Fragment,null,a.createElement(v,(0,u.Z)({id:`${r.$id}${h.oneOf?"__oneof_select":"__anyof_select"}`,schema:{type:"number",default:0},onChange:this.onOptionChange,onBlur:o,onFocus:l,value:k,options:{enumOptions:T}},b)),null!==N&&a.createElement(y,{schema:w,uiSchema:c,displayLabel:!1,errorSchema:s,idSchema:r,idPrefix:n,formData:i,onChange:p,onBlur:o,onFocus:l,registry:d,disabled:t}))}}var se=function(){this.onOptionChange=e=>{const t=parseInt(e,10),{formData:s,onChange:a,options:i,registry:n}=this.props,{rootSchema:r}=n,o=B(i[t],r,s);let p;if("object"===z(s)&&("object"===o.type||o.properties)){p=Object.assign({},s);const e=i.slice();e.splice(t,1);for(const t of e)if(t.properties)for(const e in t.properties)p.hasOwnProperty(e)&&delete p[e]}a(U(i[t],p,r)),this.setState({selectedOption:parseInt(e,10)})}};const ae={widgets:{test:()=>a.createElement("div",null,"test")},FieldTemplate:function(e){const{id:t,label:s,children:i,errors:n,help:r,description:o,rawDescription:p,hidden:l,required:m,displayLabel:d}=e;return l?a.createElement("div",{className:"hidden"},i):a.createElement("div",null,d&&(p?a.createElement(v.Z,{placement:"leftTop",title:p},a.createElement(S.Z,null)," ",a.createElement(G,{label:s,required:m,id:t}),": "):a.createElement(a.Fragment,null,a.createElement(G,{label:s,required:m,id:t}),": ")),i,n,r)},ObjectFieldTemplate:function(e){const{TitleField:t,DescriptionField:s}=e;return a.createElement(a.Fragment,null,"{ ",e.description&&a.createElement(ne,null," \u2215\u2215 ",e.description),a.createElement(ie,null,e.properties.map((e=>e.content))),Z(e.schema,e.uiSchema,e.formData)&&a.createElement(W,{className:"object-property-expand",onClick:e.onAddClick(e.schema),disabled:e.disabled||e.readonly}),"}")},ArrayFieldTemplate:function(e){return a.createElement(a.Fragment,null,"[",a.createElement(ie,null,a.createElement("div",{className:"row array-item-list",key:`array-item-list-${e.idSchema.$id}`},e.items&&e.items.map((e=>function(e){return a.createElement("div",{key:e.key,className:e.className,style:{width:"100%"}},e.hasToolbar&&a.createElement("div",{className:"col-xs-3 array-item-toolbox",style:{float:"right"}},a.createElement("div",{className:"btn-group",style:{display:"flex",justifyContent:"space-around"}},(e.hasMoveUp||e.hasMoveDown)&&a.createElement(i.Z,{icon:a.createElement(N.Z,null),"aria-label":"Move up",tabIndex:"-1",disabled:e.disabled||e.readonly||!e.hasMoveUp,onClick:e.onReorderClick(e.index,e.index-1)}),(e.hasMoveUp||e.hasMoveDown)&&a.createElement(i.Z,{icon:a.createElement(w.Z,null),"aria-label":"Move down",tabIndex:"-1",disabled:e.disabled||e.readonly||!e.hasMoveDown,onClick:e.onReorderClick(e.index,e.index+1)}),e.hasRemove&&a.createElement(i.Z,{type:"danger",icon:a.createElement(T.Z,null),"aria-label":"Remove",tabIndex:"-1",disabled:e.disabled||e.readonly,onClick:e.onDropIndexClick(e.index)}))),a.createElement("div",{style:{width:"100%"}},e.children))}(e)))),e.canAdd&&a.createElement(W,{className:"array-item-add",onClick:e.onAddClick,disabled:e.disabled||e.readonly})),"]")},widgets:{CheckboxWidget:function(e){const{schema:t,id:s,value:i,disabled:n,readonly:r,label:o,autofocus:p,onBlur:l,onFocus:m,onChange:d,DescriptionField:c}=e,h=M(t);return a.createElement(E.Z,{id:s,checked:void 0!==i&&i,required:h,disabled:n||r,autoFocus:p,onChange:e=>d(e.target.checked),onBlur:l&&(e=>l(s,e.target.checked)),onFocus:m&&(e=>m(s,e.target.checked))})},SelectWidget:function(e){const{schema:t,id:s,options:i,value:n,required:r,disabled:o,readonly:p,multiple:l,autofocus:m,onChange:d,onBlur:c,onFocus:h,placeholder:u}=e,{enumOptions:y,enumDisabled:f}=i,k=l?[]:"";return 1===y.length?a.createElement(a.Fragment,null,y[0].label):a.createElement("select",{id:s,multiple:l,className:"form-control",value:void 0===n?k:n,required:r,disabled:o||p,autoFocus:m,onBlur:c&&(e=>{const a=q(e,l);c(s,R(t,a))}),onFocus:h&&(e=>{const a=q(e,l);h(s,R(t,a))}),onChange:e=>{const s=q(e,l);d(R(t,s))}},!l&&void 0===t.default&&a.createElement("option",{value:""},u),y.map(((e,t)=>{let{value:s,label:i}=e;const n=f&&-1!=f.indexOf(s);return a.createElement("option",{key:t,value:s,disabled:n},i)})))}},fields:{SchemaField:ee,AnyOfField:te,OneOfField:te}},ie=b.ZP.div`
    padding-left: 2em;
`,ne=b.ZP.span`
  padding-left: 20px;
  color: #888888;
`;s(42920);const re={$schema:"http://json-schema.org/draft-07/schema#",definitions:{AnnotationInterface:{properties:{showProgress:{description:"Display a bar indicating progress as fraction of completed tasks",title:"showProgress",type:"boolean"},showSubmitButton:{description:"Show the button to submit the HIT",title:"showSubmitButton",type:"boolean"},type:{default:"annotation",description:"type of interface.",enum:["annotation"],title:"type",type:"string"},userTasks:{additionalProperties:{anyOf:[{$ref:"#/definitions/Continuous1DTaskSpec"},{$ref:"#/definitions/ContinuousKeypointTaskSpec"},{$ref:"#/definitions/QuestionnaireTaskSpec"},{$ref:"#/definitions/InstructionsTaskSpec"},{$ref:"#/definitions/VideocallTaskSpec"}],description:"One of the supported task specs"},description:"Allow the user to create tasks from the given map of id => task_spec",title:"userTasks",type:"object"}},required:["type"],title:"AnnotationInterface",type:"object",additionalProperties:!1},BasicAudio:{description:"Identifies a single audio file",properties:{type:{default:"audio",enum:["audio"],title:"type",type:"string"},url:{description:"URL to hosted video file",title:"url",type:"string"}},required:["type","url"],title:"BasicAudio",type:"object",additionalProperties:!1},BasicVideo:{description:"Identifies a single video file",properties:{canMute:{description:"User is able to mute the video",title:"canMute",type:"boolean"},fps:{description:"Frames per second of the video file.\nSome tasks use it to collect data once per frame.",title:"fps",type:"number"},muted:{description:"Video should be played without audio",title:"muted",type:"boolean"},speed:{description:"Speed of the video in multiples of real time (1x)\n0 will allow the user to change speed (starting at 1x)",title:"speed",type:"number"},type:{default:"video",enum:["video"],title:"type",type:"string"},url:{description:"URL to hosted video file",title:"url",type:"string"}},required:["type","url"],title:"BasicVideo",type:"object",additionalProperties:!1},BinaryInputSpec:{properties:{controls:{description:"Button controls",properties:{up:{default:"a",description:"Activate",title:"up",type:"string"}},title:"controls",type:"object"},mode:{default:"binary",enum:["binary"],title:"mode",type:"string"}},required:["mode"],title:"BinaryInputSpec",type:"object",additionalProperties:!1},CheckboxGroupOption:{properties:{label:{title:"label",type:"string"},value:{title:"value",type:["string","number"]}},required:["label","value"],title:"CheckboxGroupOption",type:"object"},CheckboxGroupSpec:{description:"Props for the antd checkbox group",properties:{defaultValue:{items:{type:"string"},title:"defaultValue",type:"array"},inputType:{default:"Checkbox.Group",enum:["Checkbox.Group"],title:"inputType",type:"string"},options:{items:{$ref:"#/definitions/CheckboxGroupOption"},title:"options",type:"array"}},required:["inputType","options"],title:"CheckboxGroupSpec",type:"object",additionalProperties:!1},Continuous1DTaskSpec:{additionalProperties:!1,properties:{autoSubmit:{default:!1,description:"Tasks will be submitted automatically when the media or timer ends.",title:"autoSubmit",type:"boolean"},children:{description:"children tasks",items:{oneOf:[{$ref:'#/definitions/Omit<Continuous1DTaskSpec,"media"|"children">'},{$ref:'#/definitions/Omit<ContinuousKeypointTaskSpec,"media"|"children">'},{$ref:'#/definitions/Omit<QuestionnaireTaskSpec,"media"|"children">'},{$ref:'#/definitions/Omit<InstructionsTaskSpec,"media"|"children">'},{$ref:'#/definitions/Omit<VideocallTaskSpec,"media"|"children">'}],discriminator:{propertyName:"type"},required:["type"]},title:"children",type:"array"},controls:{description:"sets the input button controls for the task",properties:{back10s:{title:"back10s",type:"string"},back2s:{title:"back2s",type:"string"},"play-pause":{title:"play-pause",type:"string"}},title:"controls",type:"object"},id:{description:"ID of the task. Used (if provided) only to name the download (results) files",title:"id",type:"string"},instructions:{description:"Instructions to be displayed before the form",title:"instructions",type:"string"},instructionsType:{default:"'default'",description:"How the instructions will be displayed",enum:["default","popped"],title:"instructionsType",type:"string"},intensityInput:{description:"sets the type of intensity input",title:"intensityInput",oneOf:[{$ref:"#/definitions/BinaryInputSpec"},{$ref:"#/definitions/ContinuousMousemoveInputSpec"},{$ref:"#/definitions/GravityKeyboardInputSpec"},{$ref:"#/definitions/ContinuousKeyboardInputSpec"},{$ref:"#/definitions/RankTraceInputSpec"},{$ref:"#/definitions/RankTraceNewInputSpec"},{$ref:"#/definitions/GtraceInputSpec"}],discriminator:{propertyName:"mode"},required:["mode"]},maxSubmissions:{default:0,description:"Maximum number of submissions a user can make for the task.",title:"maxSubmissions",type:"number"},media:{description:"Media file to be displayed.",title:"media",oneOf:[{$ref:"#/definitions/BasicVideo"},{$ref:"#/definitions/MultiviewVideo"}],discriminator:{propertyName:"type"},required:["type"]},name:{description:'Name of the task. It is displayed in covfee (eg. "Video 3")',title:"name",type:"string"},prerequisite:{default:"False",description:"Task is marked as a prerrequisite\nPrerrequisite tasks must be completed before the rests of the tasks in the HIT are revealed.",title:"prerequisite",type:"boolean"},required:{default:"True",description:"If true, this task must have a valid submission before the HIT can be submitted",title:"required",type:"boolean"},shared:{description:"If true, the task is shared among all instances of the HIT\nUseful for group tasks requiring a single shared submission (symmetric)",title:"shared",type:"boolean"},showCountdown:{description:"Enable player's countdown animation",title:"showCountdown",type:"boolean"},timer:{description:"Timing config",properties:{maxTime:{default:0,description:"Max time (in seconds) the user may take to complete the task",title:"maxTime",type:"number"}},required:["maxTime"],title:"timer",type:"object"},type:{default:"Continuous1DTask",enum:["Continuous1DTask"],title:"type",type:"string"},useRequestAnimationFrame:{default:!1,description:"Uses requestAnimationFrame as trigger for data reads.\nrequestAnimationFrame normally fires at close to 60Hz\nSetting to true can improve the quality for lower framerate media by capturing data points between frames.\nIf enabled, data annotations may not align with media frame times.",title:"useRequestAnimationFrame",type:"boolean"}},required:["intensityInput","media","name","type"],title:"Continuous1DTaskSpec",type:"object"},ContinuousKeyboardInputSpec:{properties:{bounds:{default:[0,1],description:"Range of the continuous values",items:[{type:"number"},{type:"number"}],maxItems:2,minItems:2,title:"bounds",type:"array"},controls:{$ref:"#/definitions/ContinuousValueControls",title:"controls"},mode:{default:"continuous-keyboard",enum:["continuous-keyboard"],title:"mode",type:"string"}},required:["mode"],title:"ContinuousKeyboardInputSpec",type:"object",additionalProperties:!1},ContinuousKeypointTaskSpec:{additionalProperties:!1,properties:{autoSubmit:{default:!1,description:"Tasks will be submitted automatically when the media or timer ends.",title:"autoSubmit",type:"boolean"},children:{description:"children tasks",items:{oneOf:[{$ref:'#/definitions/Omit<Continuous1DTaskSpec,"media"|"children">'},{$ref:'#/definitions/Omit<ContinuousKeypointTaskSpec,"media"|"children">'},{$ref:'#/definitions/Omit<QuestionnaireTaskSpec,"media"|"children">'},{$ref:'#/definitions/Omit<InstructionsTaskSpec,"media"|"children">'},{$ref:'#/definitions/Omit<VideocallTaskSpec,"media"|"children">'}],discriminator:{propertyName:"type"},required:["type"]},title:"children",type:"array"},controls:{description:"sets the input button controls for the task",properties:{back10s:{description:"go back 10s in video time",title:"back10s",type:"string"},back2s:{description:"go back 2s in video time",title:"back2s",type:"string"},"play-pause":{description:"toggle play/pause",title:"play-pause",type:"string"},"speed-down":{description:"slow down video playback",title:"speed-down",type:"string"},"speed-up":{description:"speed up video playback",title:"speed-up",type:"string"},"toggle-occluded":{description:"toggle the occlusion flag (for occluded objects/parts)",title:"toggle-occluded",type:"string"},"toggle-of":{description:"toggle the optical-flow-based speed adjustment",title:"toggle-of",type:"string"}},required:["speed-up"],title:"controls",type:"object"},id:{description:"ID of the task. Used (if provided) only to name the download (results) files",title:"id",type:"string"},instructions:{description:"Instructions to be displayed before the form",title:"instructions",type:"string"},instructionsType:{default:"'default'",description:"How the instructions will be displayed",enum:["default","popped"],title:"instructionsType",type:"string"},maxSubmissions:{default:0,description:"Maximum number of submissions a user can make for the task.",title:"maxSubmissions",type:"number"},media:{$ref:"#/definitions/OpencvFlowPlayerMedia",description:"Media file to be displayed.",title:"media"},name:{description:'Name of the task. It is displayed in covfee (eg. "Video 3")',title:"name",type:"string"},prerequisite:{default:"False",description:"Task is marked as a prerrequisite\nPrerrequisite tasks must be completed before the rests of the tasks in the HIT are revealed.",title:"prerequisite",type:"boolean"},required:{default:"True",description:"If true, this task must have a valid submission before the HIT can be submitted",title:"required",type:"boolean"},shared:{description:"If true, the task is shared among all instances of the HIT\nUseful for group tasks requiring a single shared submission (symmetric)",title:"shared",type:"boolean"},timer:{description:"Timing config",properties:{maxTime:{default:0,description:"Max time (in seconds) the user may take to complete the task",title:"maxTime",type:"number"}},required:["maxTime"],title:"timer",type:"object"},type:{default:"ContinuousKeypointTask",enum:["ContinuousKeypointTask"],title:"type",type:"string"}},required:["media","name","type"],title:"ContinuousKeypointTaskSpec",type:"object"},ContinuousMousemoveInputSpec:{properties:{bounds:{default:[0,1],description:"Range of the continuous values",items:[{type:"number"},{type:"number"}],maxItems:2,minItems:2,title:"bounds",type:"array"},mode:{default:"continuous-mousemove",enum:["continuous-mousemove"],title:"mode",type:"string"}},required:["mode"],title:"ContinuousMousemoveInputSpec",type:"object",additionalProperties:!1},ContinuousValueControls:{properties:{down:{default:"a",description:"Decrease intensity",title:"down",type:"string"},up:{default:"s",description:"Increase intensity",title:"up",type:"string"}},title:"ContinuousValueControls",type:"object"},ContinuousValueControls_1:{properties:{down:{default:"a",description:"Decrease intensity",title:"down",type:"string"},up:{default:"s",description:"Increase intensity",title:"up",type:"string"}},title:"ContinuousValueControls_1",type:"object"},"FieldSpec<InputSpec>":{properties:{condition:{description:"If given the field will only be available when the condition is true",title:"condition",type:"string"},input:{description:"input props for a single input element",title:"input",oneOf:[{properties:{checkedChildren:{description:"The text to be shown when the state is checked",title:"checkedChildren",type:"string"},defaultChecked:{default:!1,description:"Initial state",title:"defaultChecked",type:"boolean"},inputType:{default:"Switch",enum:["Switch"],title:"inputType",type:"string"},size:{default:"default",description:"The size of the Switch",enum:["default","small"],title:"size",type:"string"},unCheckedChildren:{description:"The text to be shown when the state is unchecked",title:"unCheckedChildren",type:"string"}},required:["inputType"],type:"object",additionalProperties:!1},{properties:{allowClear:{default:!0,description:"Whether to allow clear when click again",title:"allowClear",type:"boolean"},allowHalf:{default:!1,description:"Allow selection of a half-start",title:"allowHalf",type:"boolean"},character:{default:"StarFilled",description:"Custom character to use in place of star",title:"character",type:"string"},count:{default:5,description:"Number of characters (default: 5)",title:"count",type:"number"},defaultValue:{default:0,description:"Default value selected",title:"defaultValue",type:"number"},inputType:{default:"Rate",enum:["Rate"],title:"inputType",type:"string"},tooltips:{description:"Customize tooltip for each character",items:{type:"string"},title:"tooltips",type:"array"}},required:["inputType"],type:"object",additionalProperties:!1},{properties:{allowClear:{default:!1,description:"Show clear button",title:"allowClear",type:"boolean"},autoClearSearchValue:{default:!0,description:"Whether the current search will be cleared on selecting an item. Only applies when mode is set to multiple or tags",title:"autoClearSearchValue",type:"boolean"},bordered:{default:!0,description:"Adds border style",title:"bordered",type:"boolean"},defaultActiveFirstOption:{default:!0,description:"Whether active first option by default",title:"defaultActiveFirstOption",type:"boolean"},defaultOpen:{description:"Initial open state of dropdown",title:"defaultOpen",type:"boolean"},defaultValue:{anyOf:[{items:{type:"string"},type:"array"},{items:{type:"number"},type:"array"},{type:["string","number"]}],description:"Initial selected option",title:"defaultValue"},filterOption:{default:!0,description:"If true, filter options by input",title:"filterOption",type:"boolean"},inputType:{default:"Select",enum:["Select"],title:"inputType",type:"string"},labelInValue:{default:!1,description:"Whether to embed label in value, turn the format of value from string to { value: string, label: ReactNode }",title:"labelInValue",type:"boolean"},listHeight:{default:256,description:"Config popup height",title:"listHeight",type:"number"},maxTagCount:{anyOf:[{enum:["responsive"],type:"string"},{type:"number"}],description:"Max tag count to show. responsive will cost render performance",title:"maxTagCount"},maxTagTextLength:{description:"Max tag text length to show",title:"maxTagTextLength",type:"number"},mode:{description:"Set mode of Select",enum:["multiple","tags"],title:"mode",type:"string"},optionFilterProp:{default:"value",description:"Which prop value of option will be used for filter if filterOption is true. If options is set, it should be set to label",title:"optionFilterProp",type:"string"},optionLabelProp:{default:"children",description:"Which prop value of option will render as content of select",title:"optionLabelProp",type:"string"},options:{description:"Select options.",title:"options"},showArrow:{description:"Whether to show the drop-down arrow",title:"showArrow",type:"boolean"},showSearch:{default:!1,description:"Whether show search input in single mode",title:"showSearch",type:"boolean"},size:{default:"middle",description:"Size of Select input",enum:["large","middle","small"],title:"size",type:"string"},tokenSeparators:{description:"Separator used to tokenize on tag and multiple mode",items:{type:"string"},title:"tokenSeparators",type:"array"},virtual:{default:!0,description:"Disable virtual scroll when set to false",title:"virtual",type:"boolean"}},required:["inputType","options"],type:"object",additionalProperties:!1},{$ref:"#/definitions/CheckboxGroupSpec"},{$ref:"#/definitions/InputFieldSpec"},{$ref:"#/definitions/InputNumberSpec"},{$ref:"#/definitions/TextareaSpec"},{$ref:"#/definitions/RadioSpec"},{$ref:"#/definitions/SliderSpec"}],discriminator:{propertyName:"inputType"},required:["inputType"]},label:{description:"Label for the field.\nUsually displayed next to or on top of the field.",title:"label",type:"string"},name:{description:"Name of the field.\nThe results will refer to the field by this name.",title:"name",type:"string"},required:{description:"If true the field will be required to be filled before submission.",title:"required",type:"boolean"},tooltip:{description:"Text for a tooltip with more information",title:"tooltip",type:"string"}},required:["input","label","name"],title:"FieldSpec<InputSpec>",type:"object"},"FormSpec<InputSpec>":{properties:{fields:{description:"For field specification",items:{$ref:"#/definitions/FieldSpec<InputSpec>"},title:"fields",type:"array"},layout:{description:"Layout of the form",enum:["horizontal","inline","vertical"],title:"layout",type:"string"}},required:["fields"],title:"FormSpec<InputSpec>",type:"object"},GravityKeyboardInputSpec:{properties:{acceleration_constant:{default:.0025,description:"Acceleration constant.",title:"acceleration_constant",type:"number"},bounds:{default:[0,1],description:"Range of the continuous values",items:[{type:"number"},{type:"number"}],maxItems:2,minItems:2,title:"bounds",type:"array"},controls:{properties:{up:{default:"a",description:"Increase intensity",title:"up",type:"string"}},title:"controls",type:"object"},jump_speed:{default:.1,description:"Initial speed when a key is pressed",title:"jump_speed",type:"number"},mode:{default:"gravity-keyboard",enum:["gravity-keyboard"],title:"mode",type:"string"}},required:["mode"],title:"GravityKeyboardInputSpec",type:"object",additionalProperties:!1},GtraceInputSpec:{properties:{bounds:{default:null,description:"Range of the continuous values",items:[{type:"number"},{type:"number"}],maxItems:2,minItems:2,title:"bounds",type:"array"},controls:{$ref:"#/definitions/ContinuousValueControls_1",title:"controls"},mode:{default:"gtrace",enum:["gtrace"],title:"mode",type:"string"}},required:["mode"],title:"GtraceInputSpec",type:"object",additionalProperties:!1},HitSpec:{additionalProperties:!1,properties:{config:{$ref:"#/definitions/completionInfo",description:"HIT configuration and other params",title:"config"},extra:{description:"Extra hit-level information to display",title:"extra",oneOf:[{$ref:"#/definitions/MarkdownContentRawSpec"},{$ref:"#/definitions/MarkdownContentLinkSpec"}],discriminator:{propertyName:"type"},required:["type"]},id:{description:"unique ID of the hit",title:"id",type:"string"},interface:{description:"Interface configuration options",title:"interface",oneOf:[{$ref:"#/definitions/AnnotationInterface"},{$ref:"#/definitions/TimelineInterface"}],discriminator:{propertyName:"type"},required:["type"]},name:{description:"HIT name (for display)",title:"name",type:"string"},repeat:{description:"number of copies or instances of the HIT",title:"repeat",type:"number"},requireLogin:{description:"If true, the user will be required to log in before starting the task",title:"requireLogin",type:"boolean"},tasks:{$ref:"#/definitions/TaskListObject",description:"list of tasks in the HIT",title:"tasks"}},required:["id","name","tasks"],title:"HitSpec",type:"object"},InputFieldSpec:{description:"Props for the antd input field",properties:{allowClear:{title:"allowClear",type:"boolean"},bordered:{title:"bordered",type:"boolean"},defaultValue:{title:"defaultValue",type:"string"},inputType:{default:"Input",enum:["Input"],title:"inputType",type:"string"},maxLength:{title:"maxLength",type:"number"},minLength:{title:"minLength",type:"number"},size:{enum:["large","middle","small"],title:"size",type:"string"},type:{enum:["checkbox","color","date","datetime-local","email","month","number","password","radio","range","string","tel","text","time","url","week"],title:"type",type:"string"}},required:["inputType"],title:"InputFieldSpec",type:"object",additionalProperties:!1},InputNumberSpec:{description:"Props for the antd input number field",properties:{controls:{title:"controls",type:"boolean"},decimalSeparator:{title:"decimalSeparator",type:"string"},defaultValue:{title:"defaultValue",type:"number"},inputType:{default:"InputNumber",enum:["InputNumber"],title:"inputType",type:"string"},max:{title:"max",type:"number"},min:{title:"min",type:"number"},precision:{title:"precision",type:"number"},size:{enum:["large","middle","small"],title:"size",type:"string"},step:{title:"step",type:"number"}},required:["inputType"],title:"InputNumberSpec",type:"object",additionalProperties:!1},InstructionsTaskSpec:{additionalProperties:!1,properties:{autoSubmit:{default:!1,description:"Tasks will be submitted automatically when the media or timer ends.",title:"autoSubmit",type:"boolean"},children:{description:"children tasks",items:{oneOf:[{$ref:'#/definitions/Omit<Continuous1DTaskSpec,"media"|"children">'},{$ref:'#/definitions/Omit<ContinuousKeypointTaskSpec,"media"|"children">'},{$ref:'#/definitions/Omit<QuestionnaireTaskSpec,"media"|"children">'},{$ref:'#/definitions/Omit<InstructionsTaskSpec,"media"|"children">'},{$ref:'#/definitions/Omit<VideocallTaskSpec,"media"|"children">'}],discriminator:{propertyName:"type"},required:["type"]},title:"children",type:"array"},content:{description:"Main static content of the page (eg. consent terms, instructions)",title:"content",oneOf:[{$ref:"#/definitions/MarkdownContentRawSpec"},{$ref:"#/definitions/MarkdownContentLinkSpec"}],discriminator:{propertyName:"type"},required:["type"]},form:{$ref:"#/definitions/FormSpec<InputSpec>",description:"a form to display after the content.",title:"form"},id:{description:"ID of the task. Used (if provided) only to name the download (results) files",title:"id",type:"string"},instructions:{description:"Instructions to be displayed before the form",title:"instructions",type:"string"},instructionsType:{default:"'default'",description:"How the instructions will be displayed",enum:["default","popped"],title:"instructionsType",type:"string"},maxSubmissions:{default:0,description:"Maximum number of submissions a user can make for the task.",title:"maxSubmissions",type:"number"},name:{description:'Name of the task. It is displayed in covfee (eg. "Video 3")',title:"name",type:"string"},prerequisite:{default:"False",description:"Task is marked as a prerrequisite\nPrerrequisite tasks must be completed before the rests of the tasks in the HIT are revealed.",title:"prerequisite",type:"boolean"},required:{default:"True",description:"If true, this task must have a valid submission before the HIT can be submitted",title:"required",type:"boolean"},shared:{description:"If true, the task is shared among all instances of the HIT\nUseful for group tasks requiring a single shared submission (symmetric)",title:"shared",type:"boolean"},timer:{description:"Timing config",properties:{maxTime:{default:0,description:"Max time (in seconds) the user may take to complete the task",title:"maxTime",type:"number"}},required:["maxTime"],title:"timer",type:"object"},type:{default:"InstructionsTask",enum:["InstructionsTask"],title:"type",type:"string"}},required:["content","name","type"],title:"InstructionsTaskSpec",type:"object"},MarkdownContentLinkSpec:{additionalProperties:!1,description:"Supplied is a link to a Markdown/HTML file.",properties:{type:{default:"link",enum:["link"],title:"type",type:"string"},url:{description:"A url pointing to a valid Markdown/HTML file.",title:"url",type:"string"}},required:["type","url"],title:"MarkdownContentLinkSpec",type:"object"},MarkdownContentRawSpec:{additionalProperties:!1,description:"Props for raw Markdown/HTML data",properties:{content:{description:"A valid Markdown/HTML string",title:"content",type:"string"},type:{default:"raw",enum:["raw"],title:"type",type:"string"}},required:["content","type"],title:"MarkdownContentRawSpec",type:"object"},MultiviewVideo:{properties:{canMute:{description:"User is able to mute the video",title:"canMute",type:"boolean"},fps:{description:"Frames per second of the video file.\nSome tasks use it to collect data once per frame.",title:"fps",type:"number"},muted:{description:"Video should be played without audio",title:"muted",type:"boolean"},speed:{description:"Speed of the video in multiples of real time (1x)\n0 will allow the user to change speed (starting at 1x)",title:"speed",type:"number"},type:{default:"video-multiview",enum:["video-multiview"],title:"type",type:"string"},url:{description:"URL to video files",items:{type:"string"},title:"url",type:"array"}},required:["type","url"],title:"MultiviewVideo",type:"object",additionalProperties:!1},'Omit<Continuous1DTaskSpec,"media"|"children">':{properties:{autoSubmit:{default:!1,description:"Tasks will be submitted automatically when the media or timer ends.",title:"autoSubmit",type:"boolean"},controls:{description:"sets the input button controls for the task",properties:{back10s:{title:"back10s",type:"string"},back2s:{title:"back2s",type:"string"},"play-pause":{title:"play-pause",type:"string"}},title:"controls",type:"object"},id:{description:"ID of the task. Used (if provided) only to name the download (results) files",title:"id",type:"string"},instructions:{description:"Instructions to be displayed before the form",title:"instructions",type:"string"},instructionsType:{default:"'default'",description:"How the instructions will be displayed",enum:["default","popped"],title:"instructionsType",type:"string"},intensityInput:{description:"sets the type of intensity input",title:"intensityInput",oneOf:[{$ref:"#/definitions/BinaryInputSpec"},{$ref:"#/definitions/ContinuousMousemoveInputSpec"},{$ref:"#/definitions/GravityKeyboardInputSpec"},{$ref:"#/definitions/ContinuousKeyboardInputSpec"},{$ref:"#/definitions/RankTraceInputSpec"},{$ref:"#/definitions/RankTraceNewInputSpec"},{$ref:"#/definitions/GtraceInputSpec"}],discriminator:{propertyName:"mode"},required:["mode"]},maxSubmissions:{default:0,description:"Maximum number of submissions a user can make for the task.",title:"maxSubmissions",type:"number"},name:{description:'Name of the task. It is displayed in covfee (eg. "Video 3")',title:"name",type:"string"},prerequisite:{default:"False",description:"Task is marked as a prerrequisite\nPrerrequisite tasks must be completed before the rests of the tasks in the HIT are revealed.",title:"prerequisite",type:"boolean"},required:{default:"True",description:"If true, this task must have a valid submission before the HIT can be submitted",title:"required",type:"boolean"},shared:{description:"If true, the task is shared among all instances of the HIT\nUseful for group tasks requiring a single shared submission (symmetric)",title:"shared",type:"boolean"},showCountdown:{description:"Enable player's countdown animation",title:"showCountdown",type:"boolean"},timer:{description:"Timing config",properties:{maxTime:{default:0,description:"Max time (in seconds) the user may take to complete the task",title:"maxTime",type:"number"}},required:["maxTime"],title:"timer",type:"object"},type:{default:"Continuous1DTask",enum:["Continuous1DTask"],title:"type",type:"string"},useRequestAnimationFrame:{default:!1,description:"Uses requestAnimationFrame as trigger for data reads.\nrequestAnimationFrame normally fires at close to 60Hz\nSetting to true can improve the quality for lower framerate media by capturing data points between frames.\nIf enabled, data annotations may not align with media frame times.",title:"useRequestAnimationFrame",type:"boolean"}},required:["intensityInput","name","type"],title:'Omit<Continuous1DTaskSpec,"media"|"children">',type:"object",additionalProperties:!1},'Omit<ContinuousKeypointTaskSpec,"media"|"children">':{properties:{autoSubmit:{default:!1,description:"Tasks will be submitted automatically when the media or timer ends.",title:"autoSubmit",type:"boolean"},controls:{description:"sets the input button controls for the task",properties:{back10s:{description:"go back 10s in video time",title:"back10s",type:"string"},back2s:{description:"go back 2s in video time",title:"back2s",type:"string"},"play-pause":{description:"toggle play/pause",title:"play-pause",type:"string"},"speed-down":{description:"slow down video playback",title:"speed-down",type:"string"},"speed-up":{description:"speed up video playback",title:"speed-up",type:"string"},"toggle-occluded":{description:"toggle the occlusion flag (for occluded objects/parts)",title:"toggle-occluded",type:"string"},"toggle-of":{description:"toggle the optical-flow-based speed adjustment",title:"toggle-of",type:"string"}},required:["speed-up"],title:"controls",type:"object"},id:{description:"ID of the task. Used (if provided) only to name the download (results) files",title:"id",type:"string"},instructions:{description:"Instructions to be displayed before the form",title:"instructions",type:"string"},instructionsType:{default:"'default'",description:"How the instructions will be displayed",enum:["default","popped"],title:"instructionsType",type:"string"},maxSubmissions:{default:0,description:"Maximum number of submissions a user can make for the task.",title:"maxSubmissions",type:"number"},name:{description:'Name of the task. It is displayed in covfee (eg. "Video 3")',title:"name",type:"string"},prerequisite:{default:"False",description:"Task is marked as a prerrequisite\nPrerrequisite tasks must be completed before the rests of the tasks in the HIT are revealed.",title:"prerequisite",type:"boolean"},required:{default:"True",description:"If true, this task must have a valid submission before the HIT can be submitted",title:"required",type:"boolean"},shared:{description:"If true, the task is shared among all instances of the HIT\nUseful for group tasks requiring a single shared submission (symmetric)",title:"shared",type:"boolean"},timer:{description:"Timing config",properties:{maxTime:{default:0,description:"Max time (in seconds) the user may take to complete the task",title:"maxTime",type:"number"}},required:["maxTime"],title:"timer",type:"object"},type:{default:"ContinuousKeypointTask",enum:["ContinuousKeypointTask"],title:"type",type:"string"}},required:["name","type"],title:'Omit<ContinuousKeypointTaskSpec,"media"|"children">',type:"object",additionalProperties:!1},'Omit<InstructionsTaskSpec,"media"|"children">':{properties:{autoSubmit:{default:!1,description:"Tasks will be submitted automatically when the media or timer ends.",title:"autoSubmit",type:"boolean"},content:{description:"Main static content of the page (eg. consent terms, instructions)",title:"content",oneOf:[{$ref:"#/definitions/MarkdownContentRawSpec"},{$ref:"#/definitions/MarkdownContentLinkSpec"}],discriminator:{propertyName:"type"},required:["type"]},form:{$ref:"#/definitions/FormSpec<InputSpec>",description:"a form to display after the content.",title:"form"},id:{description:"ID of the task. Used (if provided) only to name the download (results) files",title:"id",type:"string"},instructions:{description:"Instructions to be displayed before the form",title:"instructions",type:"string"},instructionsType:{default:"'default'",description:"How the instructions will be displayed",enum:["default","popped"],title:"instructionsType",type:"string"},maxSubmissions:{default:0,description:"Maximum number of submissions a user can make for the task.",title:"maxSubmissions",type:"number"},name:{description:'Name of the task. It is displayed in covfee (eg. "Video 3")',title:"name",type:"string"},prerequisite:{default:"False",description:"Task is marked as a prerrequisite\nPrerrequisite tasks must be completed before the rests of the tasks in the HIT are revealed.",title:"prerequisite",type:"boolean"},required:{default:"True",description:"If true, this task must have a valid submission before the HIT can be submitted",title:"required",type:"boolean"},shared:{description:"If true, the task is shared among all instances of the HIT\nUseful for group tasks requiring a single shared submission (symmetric)",title:"shared",type:"boolean"},timer:{description:"Timing config",properties:{maxTime:{default:0,description:"Max time (in seconds) the user may take to complete the task",title:"maxTime",type:"number"}},required:["maxTime"],title:"timer",type:"object"},type:{default:"InstructionsTask",enum:["InstructionsTask"],title:"type",type:"string"}},required:["content","name","type"],title:'Omit<InstructionsTaskSpec,"media"|"children">',type:"object",additionalProperties:!1},'Omit<QuestionnaireTaskSpec,"media"|"children">':{properties:{autoSubmit:{default:!1,description:"Tasks will be submitted automatically when the media or timer ends.",title:"autoSubmit",type:"boolean"},disabledUntilEnd:{description:"If true, the form will only become active after the media playback ends",title:"disabledUntilEnd",type:"boolean"},form:{$ref:"#/definitions/FormSpec<InputSpec>",description:"Specification of the form to be created.",title:"form"},id:{description:"ID of the task. Used (if provided) only to name the download (results) files",title:"id",type:"string"},instructions:{description:"Instructions to be displayed before the form",title:"instructions",type:"string"},instructionsType:{default:"'default'",description:"How the instructions will be displayed",enum:["default","popped"],title:"instructionsType",type:"string"},maxSubmissions:{default:0,description:"Maximum number of submissions a user can make for the task.",title:"maxSubmissions",type:"number"},name:{description:'Name of the task. It is displayed in covfee (eg. "Video 3")',title:"name",type:"string"},prerequisite:{default:"False",description:"Task is marked as a prerrequisite\nPrerrequisite tasks must be completed before the rests of the tasks in the HIT are revealed.",title:"prerequisite",type:"boolean"},required:{default:"True",description:"If true, this task must have a valid submission before the HIT can be submitted",title:"required",type:"boolean"},shared:{description:"If true, the task is shared among all instances of the HIT\nUseful for group tasks requiring a single shared submission (symmetric)",title:"shared",type:"boolean"},timer:{description:"Timing config",properties:{maxTime:{default:0,description:"Max time (in seconds) the user may take to complete the task",title:"maxTime",type:"number"}},required:["maxTime"],title:"timer",type:"object"},type:{default:"QuestionnaireTask",enum:["QuestionnaireTask"],title:"type",type:"string"}},required:["form","name","type"],title:'Omit<QuestionnaireTaskSpec,"media"|"children">',type:"object",additionalProperties:!1},'Omit<VideocallTaskSpec,"media"|"children">':{properties:{autoSubmit:{default:!1,description:"Tasks will be submitted automatically when the media or timer ends.",title:"autoSubmit",type:"boolean"},id:{description:"ID of the task. Used (if provided) only to name the download (results) files",title:"id",type:"string"},instructions:{description:"Instructions to be displayed before the form",title:"instructions",type:"string"},instructionsType:{default:"'default'",description:"How the instructions will be displayed",enum:["default","popped"],title:"instructionsType",type:"string"},maxSubmissions:{default:0,description:"Maximum number of submissions a user can make for the task.",title:"maxSubmissions",type:"number"},minDevices:{description:"Minimum number of devices in the call necessary to start the queries",title:"minDevices",type:"number"},mode:{default:"speaker",description:"Type of view of the call participants",enum:["gallery","speaker"],title:"mode",type:"string"},name:{description:'Name of the task. It is displayed in covfee (eg. "Video 3")',title:"name",type:"string"},prerequisite:{default:"False",description:"Task is marked as a prerrequisite\nPrerrequisite tasks must be completed before the rests of the tasks in the HIT are revealed.",title:"prerequisite",type:"boolean"},queries:{description:"Spec of the forms to be answered",items:{properties:{form:{$ref:"#/definitions/FormSpec<InputSpec>",title:"form"},offset:{description:"Time in seconds since the start of the call",title:"offset",type:"number"}},required:["form","offset"],type:"object"},title:"queries",type:"array"},required:{default:"True",description:"If true, this task must have a valid submission before the HIT can be submitted",title:"required",type:"boolean"},shared:{description:"If true, the task is shared among all instances of the HIT\nUseful for group tasks requiring a single shared submission (symmetric)",title:"shared",type:"boolean"},timer:{description:"Timing config",properties:{maxTime:{default:0,description:"Max time (in seconds) the user may take to complete the task",title:"maxTime",type:"number"}},required:["maxTime"],title:"timer",type:"object"},type:{default:"VideocallTask",enum:["VideocallTask"],title:"type",type:"string"}},required:["minDevices","mode","name","queries","type"],title:'Omit<VideocallTaskSpec,"media"|"children">',type:"object",additionalProperties:!1},OpencvFlowPlayerMedia:{properties:{canMute:{description:"User is able to mute the video",title:"canMute",type:"boolean"},fps:{description:"Video fps. Required to obtain frame number from time (since frame number is not directly accesible in browsers).",title:"fps",type:"number"},hasFlow:{description:"If true, the video file is assumed to include an optical flow video stacked horizontally, such that:\n- the left half of the video contains the video to be displayed\n- the right half of the video contains the optical flow video (hidden)",title:"hasFlow",type:"boolean"},muted:{description:"Video should be played without audio",title:"muted",type:"boolean"},resolution:{description:"Video resolution",items:[{type:"number"},{type:"number"}],maxItems:2,minItems:2,title:"resolution",type:"array"},speed:{description:"Speed of the video in multiples of real time (1x)\n0 will allow the user to change speed (starting at 1x)",title:"speed",type:"number"},type:{default:"video",enum:["video"],title:"type",type:"string"},url:{description:"URL to hosted video file",title:"url",type:"string"}},required:["fps","resolution","type","url"],title:"OpencvFlowPlayerMedia",type:"object"},ProjectSpec:{additionalProperties:!1,properties:{email:{description:"email of the contact person for the project.",title:"email",type:"string"},hits:{description:"List of HIT specifications, one for each Human Intelligence Task in this project.",items:{$ref:"#/definitions/HitSpec"},title:"hits",type:"array"},id:{description:"unique ID of the project",title:"id",type:"string"},name:{description:"name of the project, used to identify it in the covfee interface.",title:"name",type:"string"}},required:["email","hits","id","name"],title:"ProjectSpec",type:"object"},QuestionnaireTaskSpec:{additionalProperties:!1,properties:{autoSubmit:{default:!1,description:"Tasks will be submitted automatically when the media or timer ends.",title:"autoSubmit",type:"boolean"},children:{description:"children tasks",items:{oneOf:[{$ref:'#/definitions/Omit<Continuous1DTaskSpec,"media"|"children">'},{$ref:'#/definitions/Omit<ContinuousKeypointTaskSpec,"media"|"children">'},{$ref:'#/definitions/Omit<QuestionnaireTaskSpec,"media"|"children">'},{$ref:'#/definitions/Omit<InstructionsTaskSpec,"media"|"children">'},{$ref:'#/definitions/Omit<VideocallTaskSpec,"media"|"children">'}],discriminator:{propertyName:"type"},required:["type"]},title:"children",type:"array"},disabledUntilEnd:{description:"If true, the form will only become active after the media playback ends",title:"disabledUntilEnd",type:"boolean"},form:{$ref:"#/definitions/FormSpec<InputSpec>",description:"Specification of the form to be created.",title:"form"},id:{description:"ID of the task. Used (if provided) only to name the download (results) files",title:"id",type:"string"},instructions:{description:"Instructions to be displayed before the form",title:"instructions",type:"string"},instructionsType:{default:"'default'",description:"How the instructions will be displayed",enum:["default","popped"],title:"instructionsType",type:"string"},maxSubmissions:{default:0,description:"Maximum number of submissions a user can make for the task.",title:"maxSubmissions",type:"number"},media:{description:"Media file to be displayed.",title:"media",oneOf:[{$ref:"#/definitions/BasicVideo"},{$ref:"#/definitions/BasicAudio"}],discriminator:{propertyName:"type"},required:["type"]},name:{description:'Name of the task. It is displayed in covfee (eg. "Video 3")',title:"name",type:"string"},prerequisite:{default:"False",description:"Task is marked as a prerrequisite\nPrerrequisite tasks must be completed before the rests of the tasks in the HIT are revealed.",title:"prerequisite",type:"boolean"},required:{default:"True",description:"If true, this task must have a valid submission before the HIT can be submitted",title:"required",type:"boolean"},shared:{description:"If true, the task is shared among all instances of the HIT\nUseful for group tasks requiring a single shared submission (symmetric)",title:"shared",type:"boolean"},timer:{description:"Timing config",properties:{maxTime:{default:0,description:"Max time (in seconds) the user may take to complete the task",title:"maxTime",type:"number"}},required:["maxTime"],title:"timer",type:"object"},type:{default:"QuestionnaireTask",enum:["QuestionnaireTask"],title:"type",type:"string"}},required:["form","name","type"],title:"QuestionnaireTaskSpec",type:"object"},RadioSpec:{description:"Props for the antd radio",properties:{buttonStyle:{enum:["outline","solid"],title:"buttonStyle",type:"string"},defaultValue:{title:"defaultValue",type:"string"},inputType:{default:"Radio.Group",enum:["Radio.Group"],title:"inputType",type:"string"},optionType:{enum:["button","default"],title:"optionType",type:"string"},options:{items:{type:"string"},title:"options",type:"array"},size:{enum:["large","middle","small"],title:"size",type:"string"}},required:["inputType","options"],title:"RadioSpec",type:"object",additionalProperties:!1},RankTraceInputSpec:{properties:{bounds:{default:null,description:"Range of the continuous values",items:[{type:"number"},{type:"number"}],maxItems:2,minItems:2,title:"bounds",type:"array"},controls:{$ref:"#/definitions/ContinuousValueControls_1",title:"controls"},mode:{default:"ranktrace",enum:["ranktrace"],title:"mode",type:"string"}},required:["mode"],title:"RankTraceInputSpec",type:"object",additionalProperties:!1},RankTraceNewInputSpec:{properties:{bounds:{default:null,description:"Range of the continuous values",items:[{type:"number"},{type:"number"}],maxItems:2,minItems:2,title:"bounds",type:"array"},controls:{$ref:"#/definitions/ContinuousValueControls_1",title:"controls"},mode:{default:"ranktrace-new",enum:["ranktrace-new"],title:"mode",type:"string"}},required:["mode"],title:"RankTraceNewInputSpec",type:"object",additionalProperties:!1},Shuffler:{additionalProperties:!1,description:"The Shuffler defines a block of tasks that will be shuffled internally by covfee when a new HIT instance is created.\nThis is a recursive interface, to support recursive shuffling by embedding Shufflers within Shufflers.\nNote that *tasks* should be an array of arrays of tasks (or Shufflers), and not simply an array of tasks.",properties:{tasks:{items:{$ref:"#/definitions/TaskListObject"},title:"tasks",type:"array"},type:{default:"shuffle",enum:["shuffle"],title:"type",type:"string"}},required:["tasks","type"],title:"Shuffler",type:"object"},SliderSpec:{description:"Props for the antd slider",properties:{defaultValue:{description:"Initial slider value",title:"defaultValue",type:"number"},dots:{description:"Whether the thumb can drag over tick only",title:"dots",type:"boolean"},included:{description:"Make effect when marks not null, true means containment and false means coordinative",title:"included",type:"boolean"},inputType:{default:"Slider",enum:["Slider"],title:"inputType",type:"string"},marks:{additionalProperties:!0,default:'{0: "0", 1: "1", 2: "2"}',properties:{},title:"marks",type:"object"},max:{default:7,description:"The maximum value the slider can slide to",title:"max",type:"number"},min:{default:0,description:"The minimum value the slider can slide to",title:"min",type:"number"},range:{description:"Dual thumb mode",title:"range",type:"boolean"},step:{default:1,description:"The granularity the slider can step through values. Must greater than 0, and be divided by (max - min) . When marks no null, step can be null",title:"step",type:"number"},tooltipPlacement:{description:"Position of the tooltip",enum:["bottom","bottomLeft","bottomRight","left","leftBottom","leftTop","right","rightBottom","rightTop","top","topLeft","topRight"],title:"tooltipPlacement",type:"string"},tooltipVisible:{description:"If true, Tooltip will show always, or it will not show anyway, even if dragging or hovering",title:"tooltipVisible",type:"boolean"},vertical:{description:"If true, the slider will be vertical",title:"vertical",type:"boolean"}},required:["inputType"],title:"SliderSpec",type:"object",additionalProperties:!1},TaskListObject:{items:{oneOf:[{$ref:"#/definitions/Continuous1DTaskSpec"},{$ref:"#/definitions/ContinuousKeypointTaskSpec"},{$ref:"#/definitions/QuestionnaireTaskSpec"},{$ref:"#/definitions/InstructionsTaskSpec"},{$ref:"#/definitions/VideocallTaskSpec"},{$ref:"#/definitions/Shuffler"}],discriminator:{propertyName:"type"},required:["type"]},title:"TaskListObject",type:"array"},TextareaSpec:{description:"Props for the antd textarea field",properties:{allowClear:{description:"Allows the content to be cleared via clear icon",title:"allowClear",type:"boolean"},autoSize:{description:"Adjusts height based on content",title:"autoSize",type:"boolean"},bordered:{description:"If true, adds a border style",title:"bordered",type:"boolean"},defaultValue:{description:"Initial content",title:"defaultValue",type:"string"},inputType:{default:"Input.TextArea",enum:["Input.TextArea"],title:"inputType",type:"string"},maxLength:{description:"Max length of content (in chars)",title:"maxLength",type:"number"},showCount:{description:"If true, shows the char count",title:"showCount",type:"boolean"}},required:["inputType"],title:"TextareaSpec",type:"object",additionalProperties:!1},TimelineInterface:{properties:{showProgress:{description:"Display a bar indicating progress as fraction of completed tasks",title:"showProgress",type:"boolean"},showSubmitButton:{description:"Show the button to submit the HIT",title:"showSubmitButton",type:"boolean"},type:{default:"timeline",description:"type of interface.",enum:["timeline"],title:"type",type:"string"}},required:["type"],title:"TimelineInterface",type:"object",additionalProperties:!1},VideocallTaskSpec:{additionalProperties:!1,properties:{autoSubmit:{default:!1,description:"Tasks will be submitted automatically when the media or timer ends.",title:"autoSubmit",type:"boolean"},children:{description:"children tasks",items:{oneOf:[{$ref:'#/definitions/Omit<Continuous1DTaskSpec,"media"|"children">'},{$ref:'#/definitions/Omit<ContinuousKeypointTaskSpec,"media"|"children">'},{$ref:'#/definitions/Omit<QuestionnaireTaskSpec,"media"|"children">'},{$ref:'#/definitions/Omit<InstructionsTaskSpec,"media"|"children">'},{$ref:'#/definitions/Omit<VideocallTaskSpec,"media"|"children">'}],discriminator:{propertyName:"type"},required:["type"]},title:"children",type:"array"},id:{description:"ID of the task. Used (if provided) only to name the download (results) files",title:"id",type:"string"},instructions:{description:"Instructions to be displayed before the form",title:"instructions",type:"string"},instructionsType:{default:"'default'",description:"How the instructions will be displayed",enum:["default","popped"],title:"instructionsType",type:"string"},maxSubmissions:{default:0,description:"Maximum number of submissions a user can make for the task.",title:"maxSubmissions",type:"number"},minDevices:{description:"Minimum number of devices in the call necessary to start the queries",title:"minDevices",type:"number"},mode:{default:"speaker",description:"Type of view of the call participants",enum:["gallery","speaker"],title:"mode",type:"string"},name:{description:'Name of the task. It is displayed in covfee (eg. "Video 3")',title:"name",type:"string"},prerequisite:{default:"False",description:"Task is marked as a prerrequisite\nPrerrequisite tasks must be completed before the rests of the tasks in the HIT are revealed.",title:"prerequisite",type:"boolean"},queries:{description:"Spec of the forms to be answered",items:{properties:{form:{$ref:"#/definitions/FormSpec<InputSpec>",title:"form"},offset:{description:"Time in seconds since the start of the call",title:"offset",type:"number"}},required:["form","offset"],type:"object"},title:"queries",type:"array"},required:{default:"True",description:"If true, this task must have a valid submission before the HIT can be submitted",title:"required",type:"boolean"},shared:{description:"If true, the task is shared among all instances of the HIT\nUseful for group tasks requiring a single shared submission (symmetric)",title:"shared",type:"boolean"},timer:{description:"Timing config",properties:{maxTime:{default:0,description:"Max time (in seconds) the user may take to complete the task",title:"maxTime",type:"number"}},required:["maxTime"],title:"timer",type:"object"},type:{default:"VideocallTask",enum:["VideocallTask"],title:"type",type:"string"}},required:["minDevices","mode","name","queries","type"],title:"VideocallTaskSpec",type:"object"},completionInfo:{properties:{completionCode:{description:"Completion code to give back to participants. Used for crowdsourcing in eg. Prolific",title:"completionCode",type:"string"},redirectName:{description:"Name/label of the website to redirect to",title:"redirectName",type:"string"},redirectUrl:{description:"Redirect URL. URL to redirect participants to after completing the HIT.",title:"redirectUrl",type:"string"}},title:"completionInfo",type:"object"}}},oe=(0,g.Zz)(ae);class pe extends a.Component{constructor(e){super(e),this.state={specs:[],currSpec:null,currSpecString:null,currTask:0,currKey:0,valid:!0,error:null,errorVisible:!1,editor:"ace"},this.taskSpecElem=a.createRef(),this.handleUpdatePreview=e=>{if(e.currentTarget.blur(),this.state.valid){const e=this.state.currSpec;this.setState({currKey:this.state.currKey+1,specs:this.state.specs.map(((t,s)=>s===this.state.currTask?e:t))})}else this.setState({errorVisible:!0})},this.handleEditorChange=e=>{this.setState({valid:!0,error:null,currSpec:e.formData})},this.handleFormChange=e=>{let t;try{t=JSON.parse(e)}catch(s){return this.setState({valid:!1,error:s.toString(),currSpecString:e})}this.setState({currSpec:t,currSpecString:e},(()=>{this.updateValidation()}))},this.updateValidation=()=>{const{valid:e,errors:t}=this.validator.validate_schema(this.props.tasks[this.state.currTask].schema,this.state.currSpec);this.setState({valid:e,error:e?null:`In ${t[0].friendlyPath}:\n ${t[0].friendlyMessage}`})},this.handleSwitchTask=e=>{this.setState({currTask:e,currKey:this.state.currKey+1,currSpec:this.state.specs[e],currSpecString:JSON.stringify(this.state.specs[e],null,2)},(()=>{this.updateValidation()}))},this.toggleEditor=()=>{"rjsf"==this.state.editor?this.setState({currSpecString:JSON.stringify(this.state.currSpec,null,2),editor:"ace"}):this.setState({currSpec:JSON.parse(this.state.currSpecString),editor:"rjsf"})},this.state={...this.state,editor:e.defaultEditor,specs:e.tasks.map((e=>e.spec)),currSpec:e.tasks[0].spec,currSpecString:JSON.stringify(e.tasks[0].spec,null,2)},this.validator=new f.c(re)}componentDidMount(){this.handleFormChange(this.state.currSpecString)}render(){return a.createElement(a.Fragment,null,a.createElement(h,null,(()=>{const e=this.state.specs[this.state.currTask],t={id:"test",name:"Example",tasks:[{name:e.name,type:e.type,spec:e}]};return a.createElement(y,{hit:t,key:this.state.currKey})})()),a.createElement("div",{style:{margin:"1em auto",textAlign:"center"}},this.props.tasks.map(((e,t)=>a.createElement(i.Z,{key:t,onClick:()=>{this.handleSwitchTask(t)},type:"primary",shape:"round",size:"middle",style:{margin:"0 5px"},disabled:t==this.state.currTask},e.label)))),a.createElement("div",null,a.createElement("nav",null,a.createElement(i.Z,{type:"text",size:"middle",icon:a.createElement(r.Z,null),onClick:this.handleReset},"reset"),this.state.valid?a.createElement(i.Z,{type:"text",size:"middle",icon:a.createElement(o.Z,null),onClick:this.handleUpdatePreview},"update preview"):a.createElement(n.Z,{placement:"bottomLeft",content:a.createElement("div",{style:{maxWidth:"400px"}},this.state.error)},a.createElement(i.Z,{type:"primary",size:"middle",onClick:this.handleUpdatePreview,danger:!0},"Errors")),a.createElement(i.Z,{type:"text",size:"middle",icon:"rjsf"===this.state.editor?a.createElement(p.Z,null):a.createElement(l.Z,null),onClick:this.toggleEditor},"rjsf"===this.state.editor?"Text Editor":"Form Editor"),a.createElement(d.CopyToClipboard,{text:this.state.currSpecString},a.createElement(i.Z,{type:"text",size:"middle",icon:a.createElement(m.Z,null)},"copy"))),a.createElement(k.Z,{fallback:a.createElement("div",null,"The fallback content to display on prerendering")},(()=>{const e=s(74981).ZP;if(s(90252),s(24203),"rjsf"===this.state.editor){const e=this.validator.get_deref_schema(this.props.tasks[0].schema);return delete e.properties.children,e.$schema=re.$schema,a.createElement(oe,{schema:e,formData:this.state.currSpec,onChange:this.handleEditorChange,uiSchema:{"ui:order":["type","id","name","required","prerequisite","autoSubmit","maxSubmissions","*"],id:{"ui:widget":"hidden"},media:{"ui:order":["type","*"]}},children:!0})}return a.createElement(e,{width:"100%",maxLines:1/0,wrapEnabled:!0,value:this.state.currSpecString,showPrintMargin:!0,showGutter:!0,highlightActiveLine:!0,mode:"json",theme:"github",fontSize:16,onChange:this.handleFormChange,editorProps:{$blockScrolling:!0},setOptions:{useWorker:!1}})}))))}}pe.defaultProps={formEnabled:!1}},93124:(e,t,s)=>{"use strict";s.r(t),s.d(t,{contentTitle:()=>o,default:()=>c,frontMatter:()=>r,metadata:()=>p,playgroundTasks:()=>m,toc:()=>l});var a=s(87462),i=(s(67294),s(3905)),n=s(60573);const r={title:"Continuous Keypoint"},o=void 0,p={unversionedId:"tasks/continuous_keypoint",id:"tasks/continuous_keypoint",title:"Continuous Keypoint",description:"The continuous keypoint task was created for annotation of keypoints in a video. In the original application these keypoints corresponded to extremities of people in a social interaction. The task makes use of an optical flow video to play the video slower when the mouse cursor is close to moving parts, to aid annotators in the process. Skeletal keypoints were annotated one-by-one continuously, instead of traditional frame-based annotation in which some image frames are annotated to then be interpolated. In general, this task is especially useful when the target keypoint are visible for long periods of time.",source:"@site/docs/tasks/continuous_keypoint.mdx",sourceDirName:"tasks",slug:"/tasks/continuous_keypoint",permalink:"/covfee/docs/tasks/continuous_keypoint",editUrl:"https://github.com/facebook/docusaurus/edit/master/website/docs/tasks/continuous_keypoint.mdx",tags:[],version:"current",frontMatter:{title:"Continuous Keypoint"},sidebar:"docs",previous:{title:"Continuous 1D",permalink:"/covfee/docs/tasks/continuous_1d"},next:{title:"Development install",permalink:"/covfee/docs/development"}},l=[{value:"Automatic speed adjustment",id:"automatic-speed-adjustment",children:[],level:2},{value:"Optical flow pre-computation",id:"optical-flow-pre-computation",children:[],level:2},{value:"Playground",id:"playground",children:[],level:2}],m=[{schema:"ContinuousKeypointTaskSpec",label:"Basic",spec:{name:"Continuous annotation example",type:"ContinuousKeypointTask",media:{type:"video",resolution:[1280,720],url:"https://cdn.jsdelivr.net/gh/josedvq/covfee@master/samples/keypoints/www/cartoon.mp4",hasFlow:!0,fps:59.94}}}],d={toc:l,playgroundTasks:m};function c(e){let{components:t,...s}=e;return(0,i.kt)("wrapper",(0,a.Z)({},d,s,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"The continuous keypoint task was created for annotation of keypoints in a video. In the original application these keypoints corresponded to extremities of people in a social interaction. The task makes use of an optical flow video to play the video slower when the mouse cursor is close to moving parts, to aid annotators in the process. Skeletal keypoints were annotated one-by-one continuously, instead of traditional frame-based annotation in which some image frames are annotated to then be interpolated. In general, this task is especially useful when the target keypoint are visible for long periods of time."),(0,i.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"This task requires the use of desktop Google Chrome as it relies on ",(0,i.kt)("a",{parentName:"p",href:"https://wicg.github.io/video-rvfc/"},"requestVideoFrameCallback()")))),(0,i.kt)("h2",{id:"automatic-speed-adjustment"},"Automatic speed adjustment"),(0,i.kt)("p",null,"Covfee solves the problem of continuously annotating keypoints via a new annotation technique, which consists in the automatic adjustment of the playback rate of the video in real time, according to the magnitude of the optical flow around the mouse cursor. The rate is adjusted such that it is higher when the optical flow is high and lower when optical flow is little around the mouse cursor. This has the effect of slowing down the video when the joint being tracked moves fast and speeding up the video for slow-moving or static joints. It allows the users to annotate slow-moving joints at multiples of real time rate (eg. 4x playback rate), and fast gestures at fractions of it (eg. 0.1x playback rate) on the fly without additional user intervention."),(0,i.kt)("p",null,"Concretely, for a cursor position ",(0,i.kt)("span",{parentName:"p",className:"math math-inline"},(0,i.kt)("span",{parentName:"span",className:"katex"},(0,i.kt)("span",{parentName:"span",className:"katex-mathml"},(0,i.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,i.kt)("semantics",{parentName:"math"},(0,i.kt)("mrow",{parentName:"semantics"},(0,i.kt)("mi",{parentName:"mrow"},"x"),(0,i.kt)("mo",{parentName:"mrow",separator:"true"},","),(0,i.kt)("mi",{parentName:"mrow"},"y")),(0,i.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"x,y")))),(0,i.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,i.kt)("span",{parentName:"span",className:"base"},(0,i.kt)("span",{parentName:"span",className:"strut",style:{height:"0.625em",verticalAlign:"-0.19444em"}}),(0,i.kt)("span",{parentName:"span",className:"mord mathnormal"},"x"),(0,i.kt)("span",{parentName:"span",className:"mpunct"},","),(0,i.kt)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.16666666666666666em"}}),(0,i.kt)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.03588em"}},"y")))))," (in pixels) at frame ",(0,i.kt)("span",{parentName:"p",className:"math math-inline"},(0,i.kt)("span",{parentName:"span",className:"katex"},(0,i.kt)("span",{parentName:"span",className:"katex-mathml"},(0,i.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,i.kt)("semantics",{parentName:"math"},(0,i.kt)("mrow",{parentName:"semantics"},(0,i.kt)("mi",{parentName:"mrow"},"f")),(0,i.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"f")))),(0,i.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,i.kt)("span",{parentName:"span",className:"base"},(0,i.kt)("span",{parentName:"span",className:"strut",style:{height:"0.8888799999999999em",verticalAlign:"-0.19444em"}}),(0,i.kt)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.10764em"}},"f")))))," an ",(0,i.kt)("span",{parentName:"p",className:"math math-inline"},(0,i.kt)("span",{parentName:"span",className:"katex"},(0,i.kt)("span",{parentName:"span",className:"katex-mathml"},(0,i.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,i.kt)("semantics",{parentName:"math"},(0,i.kt)("mrow",{parentName:"semantics"},(0,i.kt)("mi",{parentName:"mrow"},"N"),(0,i.kt)("mi",{parentName:"mrow"},"x"),(0,i.kt)("mi",{parentName:"mrow"},"N")),(0,i.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"N x N")))),(0,i.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,i.kt)("span",{parentName:"span",className:"base"},(0,i.kt)("span",{parentName:"span",className:"strut",style:{height:"0.68333em",verticalAlign:"0em"}}),(0,i.kt)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.10903em"}},"N"),(0,i.kt)("span",{parentName:"span",className:"mord mathnormal"},"x"),(0,i.kt)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.10903em"}},"N")))))," neighborhood in the vicinity of ",(0,i.kt)("span",{parentName:"p",className:"math math-inline"},(0,i.kt)("span",{parentName:"span",className:"katex"},(0,i.kt)("span",{parentName:"span",className:"katex-mathml"},(0,i.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,i.kt)("semantics",{parentName:"math"},(0,i.kt)("mrow",{parentName:"semantics"},(0,i.kt)("mo",{parentName:"mrow",stretchy:"false"},"("),(0,i.kt)("mi",{parentName:"mrow"},"x"),(0,i.kt)("mo",{parentName:"mrow",separator:"true"},","),(0,i.kt)("mi",{parentName:"mrow"},"y"),(0,i.kt)("mo",{parentName:"mrow",stretchy:"false"},")")),(0,i.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"(x,y)")))),(0,i.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,i.kt)("span",{parentName:"span",className:"base"},(0,i.kt)("span",{parentName:"span",className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,i.kt)("span",{parentName:"span",className:"mopen"},"("),(0,i.kt)("span",{parentName:"span",className:"mord mathnormal"},"x"),(0,i.kt)("span",{parentName:"span",className:"mpunct"},","),(0,i.kt)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.16666666666666666em"}}),(0,i.kt)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.03588em"}},"y"),(0,i.kt)("span",{parentName:"span",className:"mclose"},")")))))," is considered, such that the playback rate at frame ",(0,i.kt)("span",{parentName:"p",className:"math math-inline"},(0,i.kt)("span",{parentName:"span",className:"katex"},(0,i.kt)("span",{parentName:"span",className:"katex-mathml"},(0,i.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,i.kt)("semantics",{parentName:"math"},(0,i.kt)("mrow",{parentName:"semantics"},(0,i.kt)("mi",{parentName:"mrow"},"f"),(0,i.kt)("mo",{parentName:"mrow"},"+"),(0,i.kt)("mn",{parentName:"mrow"},"1")),(0,i.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"f+1")))),(0,i.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,i.kt)("span",{parentName:"span",className:"base"},(0,i.kt)("span",{parentName:"span",className:"strut",style:{height:"0.8888799999999999em",verticalAlign:"-0.19444em"}}),(0,i.kt)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.10764em"}},"f"),(0,i.kt)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2222222222222222em"}}),(0,i.kt)("span",{parentName:"span",className:"mbin"},"+"),(0,i.kt)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2222222222222222em"}})),(0,i.kt)("span",{parentName:"span",className:"base"},(0,i.kt)("span",{parentName:"span",className:"strut",style:{height:"0.64444em",verticalAlign:"0em"}}),(0,i.kt)("span",{parentName:"span",className:"mord"},"1")))))," is given by: "),(0,i.kt)("div",{className:"math math-display"},(0,i.kt)("span",{parentName:"div",className:"katex-display"},(0,i.kt)("span",{parentName:"span",className:"katex"},(0,i.kt)("span",{parentName:"span",className:"katex-mathml"},(0,i.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},(0,i.kt)("semantics",{parentName:"math"},(0,i.kt)("mrow",{parentName:"semantics"},(0,i.kt)("msub",{parentName:"mrow"},(0,i.kt)("mi",{parentName:"msub"},"r"),(0,i.kt)("mrow",{parentName:"msub"},(0,i.kt)("mi",{parentName:"mrow"},"f"),(0,i.kt)("mo",{parentName:"mrow"},"+"),(0,i.kt)("mn",{parentName:"mrow"},"1"))),(0,i.kt)("mo",{parentName:"mrow"},"="),(0,i.kt)("mi",{parentName:"mrow"},"C"),(0,i.kt)("mo",{parentName:"mrow"},"\u22c5"),(0,i.kt)("munderover",{parentName:"mrow"},(0,i.kt)("mo",{parentName:"munderover"},"\u2211"),(0,i.kt)("mrow",{parentName:"munderover"},(0,i.kt)("mi",{parentName:"mrow"},"i"),(0,i.kt)("mo",{parentName:"mrow"},"="),(0,i.kt)("mi",{parentName:"mrow"},"x"),(0,i.kt)("mo",{parentName:"mrow"},"\u2212"),(0,i.kt)("mi",{parentName:"mrow"},"N"),(0,i.kt)("mi",{parentName:"mrow",mathvariant:"normal"},"/"),(0,i.kt)("mn",{parentName:"mrow"},"2")),(0,i.kt)("mrow",{parentName:"munderover"},(0,i.kt)("mi",{parentName:"mrow"},"x"),(0,i.kt)("mo",{parentName:"mrow"},"+"),(0,i.kt)("mi",{parentName:"mrow"},"N"),(0,i.kt)("mi",{parentName:"mrow",mathvariant:"normal"},"/"),(0,i.kt)("mn",{parentName:"mrow"},"2"))),(0,i.kt)("munderover",{parentName:"mrow"},(0,i.kt)("mo",{parentName:"munderover"},"\u2211"),(0,i.kt)("mrow",{parentName:"munderover"},(0,i.kt)("mi",{parentName:"mrow"},"i"),(0,i.kt)("mo",{parentName:"mrow"},"="),(0,i.kt)("mi",{parentName:"mrow"},"y"),(0,i.kt)("mo",{parentName:"mrow"},"\u2212"),(0,i.kt)("mi",{parentName:"mrow"},"N"),(0,i.kt)("mi",{parentName:"mrow",mathvariant:"normal"},"/"),(0,i.kt)("mn",{parentName:"mrow"},"2")),(0,i.kt)("mrow",{parentName:"munderover"},(0,i.kt)("mi",{parentName:"mrow"},"y"),(0,i.kt)("mo",{parentName:"mrow"},"+"),(0,i.kt)("mi",{parentName:"mrow"},"N"),(0,i.kt)("mi",{parentName:"mrow",mathvariant:"normal"},"/"),(0,i.kt)("mn",{parentName:"mrow"},"2"))),(0,i.kt)("mi",{parentName:"mrow",mathvariant:"normal"},"\u2223"),(0,i.kt)("msub",{parentName:"mrow"},(0,i.kt)("mi",{parentName:"msub"},"O"),(0,i.kt)("mrow",{parentName:"msub"},(0,i.kt)("mi",{parentName:"mrow"},"f"),(0,i.kt)("mo",{parentName:"mrow",separator:"true"},","),(0,i.kt)("mi",{parentName:"mrow"},"i"),(0,i.kt)("mo",{parentName:"mrow",separator:"true"},","),(0,i.kt)("mi",{parentName:"mrow"},"j"))),(0,i.kt)("mi",{parentName:"mrow",mathvariant:"normal"},"\u2223")),(0,i.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"r_{f+1} = C \\cdot \\sum_{i=x-N/2} ^ {x+N/2} \\sum_{i=y-N/2} ^ {y+N/2} |O_{f,i,j}|")))),(0,i.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,i.kt)("span",{parentName:"span",className:"base"},(0,i.kt)("span",{parentName:"span",className:"strut",style:{height:"0.716668em",verticalAlign:"-0.286108em"}}),(0,i.kt)("span",{parentName:"span",className:"mord"},(0,i.kt)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.02778em"}},"r"),(0,i.kt)("span",{parentName:"span",className:"msupsub"},(0,i.kt)("span",{parentName:"span",className:"vlist-t vlist-t2"},(0,i.kt)("span",{parentName:"span",className:"vlist-r"},(0,i.kt)("span",{parentName:"span",className:"vlist",style:{height:"0.3361079999999999em"}},(0,i.kt)("span",{parentName:"span",style:{top:"-2.5500000000000003em",marginLeft:"-0.02778em",marginRight:"0.05em"}},(0,i.kt)("span",{parentName:"span",className:"pstrut",style:{height:"2.7em"}}),(0,i.kt)("span",{parentName:"span",className:"sizing reset-size6 size3 mtight"},(0,i.kt)("span",{parentName:"span",className:"mord mtight"},(0,i.kt)("span",{parentName:"span",className:"mord mathnormal mtight",style:{marginRight:"0.10764em"}},"f"),(0,i.kt)("span",{parentName:"span",className:"mbin mtight"},"+"),(0,i.kt)("span",{parentName:"span",className:"mord mtight"},"1"))))),(0,i.kt)("span",{parentName:"span",className:"vlist-s"},"\u200b")),(0,i.kt)("span",{parentName:"span",className:"vlist-r"},(0,i.kt)("span",{parentName:"span",className:"vlist",style:{height:"0.286108em"}},(0,i.kt)("span",{parentName:"span"})))))),(0,i.kt)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2777777777777778em"}}),(0,i.kt)("span",{parentName:"span",className:"mrel"},"="),(0,i.kt)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2777777777777778em"}})),(0,i.kt)("span",{parentName:"span",className:"base"},(0,i.kt)("span",{parentName:"span",className:"strut",style:{height:"0.68333em",verticalAlign:"0em"}}),(0,i.kt)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.07153em"}},"C"),(0,i.kt)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2222222222222222em"}}),(0,i.kt)("span",{parentName:"span",className:"mbin"},"\u22c5"),(0,i.kt)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2222222222222222em"}})),(0,i.kt)("span",{parentName:"span",className:"base"},(0,i.kt)("span",{parentName:"span",className:"strut",style:{height:"3.4770100000000004em",verticalAlign:"-1.5160049999999998em"}}),(0,i.kt)("span",{parentName:"span",className:"mop op-limits"},(0,i.kt)("span",{parentName:"span",className:"vlist-t vlist-t2"},(0,i.kt)("span",{parentName:"span",className:"vlist-r"},(0,i.kt)("span",{parentName:"span",className:"vlist",style:{height:"1.9610050000000006em"}},(0,i.kt)("span",{parentName:"span",style:{top:"-1.8089950000000001em",marginLeft:"0em"}},(0,i.kt)("span",{parentName:"span",className:"pstrut",style:{height:"3.05em"}}),(0,i.kt)("span",{parentName:"span",className:"sizing reset-size6 size3 mtight"},(0,i.kt)("span",{parentName:"span",className:"mord mtight"},(0,i.kt)("span",{parentName:"span",className:"mord mathnormal mtight"},"i"),(0,i.kt)("span",{parentName:"span",className:"mrel mtight"},"="),(0,i.kt)("span",{parentName:"span",className:"mord mathnormal mtight"},"x"),(0,i.kt)("span",{parentName:"span",className:"mbin mtight"},"\u2212"),(0,i.kt)("span",{parentName:"span",className:"mord mathnormal mtight",style:{marginRight:"0.10903em"}},"N"),(0,i.kt)("span",{parentName:"span",className:"mord mtight"},"/"),(0,i.kt)("span",{parentName:"span",className:"mord mtight"},"2")))),(0,i.kt)("span",{parentName:"span",style:{top:"-3.050005em"}},(0,i.kt)("span",{parentName:"span",className:"pstrut",style:{height:"3.05em"}}),(0,i.kt)("span",{parentName:"span"},(0,i.kt)("span",{parentName:"span",className:"mop op-symbol large-op"},"\u2211"))),(0,i.kt)("span",{parentName:"span",style:{top:"-4.386005em",marginLeft:"0em"}},(0,i.kt)("span",{parentName:"span",className:"pstrut",style:{height:"3.05em"}}),(0,i.kt)("span",{parentName:"span",className:"sizing reset-size6 size3 mtight"},(0,i.kt)("span",{parentName:"span",className:"mord mtight"},(0,i.kt)("span",{parentName:"span",className:"mord mathnormal mtight"},"x"),(0,i.kt)("span",{parentName:"span",className:"mbin mtight"},"+"),(0,i.kt)("span",{parentName:"span",className:"mord mathnormal mtight",style:{marginRight:"0.10903em"}},"N"),(0,i.kt)("span",{parentName:"span",className:"mord mtight"},"/"),(0,i.kt)("span",{parentName:"span",className:"mord mtight"},"2"))))),(0,i.kt)("span",{parentName:"span",className:"vlist-s"},"\u200b")),(0,i.kt)("span",{parentName:"span",className:"vlist-r"},(0,i.kt)("span",{parentName:"span",className:"vlist",style:{height:"1.5160049999999998em"}},(0,i.kt)("span",{parentName:"span"}))))),(0,i.kt)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.16666666666666666em"}}),(0,i.kt)("span",{parentName:"span",className:"mop op-limits"},(0,i.kt)("span",{parentName:"span",className:"vlist-t vlist-t2"},(0,i.kt)("span",{parentName:"span",className:"vlist-r"},(0,i.kt)("span",{parentName:"span",className:"vlist",style:{height:"1.9610050000000006em"}},(0,i.kt)("span",{parentName:"span",style:{top:"-1.8089950000000001em",marginLeft:"0em"}},(0,i.kt)("span",{parentName:"span",className:"pstrut",style:{height:"3.05em"}}),(0,i.kt)("span",{parentName:"span",className:"sizing reset-size6 size3 mtight"},(0,i.kt)("span",{parentName:"span",className:"mord mtight"},(0,i.kt)("span",{parentName:"span",className:"mord mathnormal mtight"},"i"),(0,i.kt)("span",{parentName:"span",className:"mrel mtight"},"="),(0,i.kt)("span",{parentName:"span",className:"mord mathnormal mtight",style:{marginRight:"0.03588em"}},"y"),(0,i.kt)("span",{parentName:"span",className:"mbin mtight"},"\u2212"),(0,i.kt)("span",{parentName:"span",className:"mord mathnormal mtight",style:{marginRight:"0.10903em"}},"N"),(0,i.kt)("span",{parentName:"span",className:"mord mtight"},"/"),(0,i.kt)("span",{parentName:"span",className:"mord mtight"},"2")))),(0,i.kt)("span",{parentName:"span",style:{top:"-3.050005em"}},(0,i.kt)("span",{parentName:"span",className:"pstrut",style:{height:"3.05em"}}),(0,i.kt)("span",{parentName:"span"},(0,i.kt)("span",{parentName:"span",className:"mop op-symbol large-op"},"\u2211"))),(0,i.kt)("span",{parentName:"span",style:{top:"-4.386005em",marginLeft:"0em"}},(0,i.kt)("span",{parentName:"span",className:"pstrut",style:{height:"3.05em"}}),(0,i.kt)("span",{parentName:"span",className:"sizing reset-size6 size3 mtight"},(0,i.kt)("span",{parentName:"span",className:"mord mtight"},(0,i.kt)("span",{parentName:"span",className:"mord mathnormal mtight",style:{marginRight:"0.03588em"}},"y"),(0,i.kt)("span",{parentName:"span",className:"mbin mtight"},"+"),(0,i.kt)("span",{parentName:"span",className:"mord mathnormal mtight",style:{marginRight:"0.10903em"}},"N"),(0,i.kt)("span",{parentName:"span",className:"mord mtight"},"/"),(0,i.kt)("span",{parentName:"span",className:"mord mtight"},"2"))))),(0,i.kt)("span",{parentName:"span",className:"vlist-s"},"\u200b")),(0,i.kt)("span",{parentName:"span",className:"vlist-r"},(0,i.kt)("span",{parentName:"span",className:"vlist",style:{height:"1.5160049999999998em"}},(0,i.kt)("span",{parentName:"span"}))))),(0,i.kt)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.16666666666666666em"}}),(0,i.kt)("span",{parentName:"span",className:"mord"},"\u2223"),(0,i.kt)("span",{parentName:"span",className:"mord"},(0,i.kt)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.02778em"}},"O"),(0,i.kt)("span",{parentName:"span",className:"msupsub"},(0,i.kt)("span",{parentName:"span",className:"vlist-t vlist-t2"},(0,i.kt)("span",{parentName:"span",className:"vlist-r"},(0,i.kt)("span",{parentName:"span",className:"vlist",style:{height:"0.3361079999999999em"}},(0,i.kt)("span",{parentName:"span",style:{top:"-2.5500000000000003em",marginLeft:"-0.02778em",marginRight:"0.05em"}},(0,i.kt)("span",{parentName:"span",className:"pstrut",style:{height:"2.7em"}}),(0,i.kt)("span",{parentName:"span",className:"sizing reset-size6 size3 mtight"},(0,i.kt)("span",{parentName:"span",className:"mord mtight"},(0,i.kt)("span",{parentName:"span",className:"mord mathnormal mtight",style:{marginRight:"0.10764em"}},"f"),(0,i.kt)("span",{parentName:"span",className:"mpunct mtight"},","),(0,i.kt)("span",{parentName:"span",className:"mord mathnormal mtight"},"i"),(0,i.kt)("span",{parentName:"span",className:"mpunct mtight"},","),(0,i.kt)("span",{parentName:"span",className:"mord mathnormal mtight",style:{marginRight:"0.05724em"}},"j"))))),(0,i.kt)("span",{parentName:"span",className:"vlist-s"},"\u200b")),(0,i.kt)("span",{parentName:"span",className:"vlist-r"},(0,i.kt)("span",{parentName:"span",className:"vlist",style:{height:"0.286108em"}},(0,i.kt)("span",{parentName:"span"})))))),(0,i.kt)("span",{parentName:"span",className:"mord"},"\u2223")))))),(0,i.kt)("p",null,"where ",(0,i.kt)("span",{parentName:"p",className:"math math-inline"},(0,i.kt)("span",{parentName:"span",className:"katex"},(0,i.kt)("span",{parentName:"span",className:"katex-mathml"},(0,i.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,i.kt)("semantics",{parentName:"math"},(0,i.kt)("mrow",{parentName:"semantics"},(0,i.kt)("msub",{parentName:"mrow"},(0,i.kt)("mi",{parentName:"msub"},"O"),(0,i.kt)("mrow",{parentName:"msub"},(0,i.kt)("mi",{parentName:"mrow"},"f"),(0,i.kt)("mo",{parentName:"mrow",separator:"true"},","),(0,i.kt)("mi",{parentName:"mrow"},"x"),(0,i.kt)("mo",{parentName:"mrow",separator:"true"},","),(0,i.kt)("mi",{parentName:"mrow"},"y")))),(0,i.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"O_{f,x,y}")))),(0,i.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,i.kt)("span",{parentName:"span",className:"base"},(0,i.kt)("span",{parentName:"span",className:"strut",style:{height:"0.969438em",verticalAlign:"-0.286108em"}}),(0,i.kt)("span",{parentName:"span",className:"mord"},(0,i.kt)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.02778em"}},"O"),(0,i.kt)("span",{parentName:"span",className:"msupsub"},(0,i.kt)("span",{parentName:"span",className:"vlist-t vlist-t2"},(0,i.kt)("span",{parentName:"span",className:"vlist-r"},(0,i.kt)("span",{parentName:"span",className:"vlist",style:{height:"0.3361079999999999em"}},(0,i.kt)("span",{parentName:"span",style:{top:"-2.5500000000000003em",marginLeft:"-0.02778em",marginRight:"0.05em"}},(0,i.kt)("span",{parentName:"span",className:"pstrut",style:{height:"2.7em"}}),(0,i.kt)("span",{parentName:"span",className:"sizing reset-size6 size3 mtight"},(0,i.kt)("span",{parentName:"span",className:"mord mtight"},(0,i.kt)("span",{parentName:"span",className:"mord mathnormal mtight",style:{marginRight:"0.10764em"}},"f"),(0,i.kt)("span",{parentName:"span",className:"mpunct mtight"},","),(0,i.kt)("span",{parentName:"span",className:"mord mathnormal mtight"},"x"),(0,i.kt)("span",{parentName:"span",className:"mpunct mtight"},","),(0,i.kt)("span",{parentName:"span",className:"mord mathnormal mtight",style:{marginRight:"0.03588em"}},"y"))))),(0,i.kt)("span",{parentName:"span",className:"vlist-s"},"\u200b")),(0,i.kt)("span",{parentName:"span",className:"vlist-r"},(0,i.kt)("span",{parentName:"span",className:"vlist",style:{height:"0.286108em"}},(0,i.kt)("span",{parentName:"span"}))))))))))," is the optical flow vector for frame ",(0,i.kt)("span",{parentName:"p",className:"math math-inline"},(0,i.kt)("span",{parentName:"span",className:"katex"},(0,i.kt)("span",{parentName:"span",className:"katex-mathml"},(0,i.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,i.kt)("semantics",{parentName:"math"},(0,i.kt)("mrow",{parentName:"semantics"},(0,i.kt)("mi",{parentName:"mrow"},"f")),(0,i.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"f")))),(0,i.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,i.kt)("span",{parentName:"span",className:"base"},(0,i.kt)("span",{parentName:"span",className:"strut",style:{height:"0.8888799999999999em",verticalAlign:"-0.19444em"}}),(0,i.kt)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.10764em"}},"f")))))," at image location ",(0,i.kt)("span",{parentName:"p",className:"math math-inline"},(0,i.kt)("span",{parentName:"span",className:"katex"},(0,i.kt)("span",{parentName:"span",className:"katex-mathml"},(0,i.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,i.kt)("semantics",{parentName:"math"},(0,i.kt)("mrow",{parentName:"semantics"},(0,i.kt)("mo",{parentName:"mrow",stretchy:"false"},"("),(0,i.kt)("mi",{parentName:"mrow"},"x"),(0,i.kt)("mo",{parentName:"mrow",separator:"true"},","),(0,i.kt)("mi",{parentName:"mrow"},"y"),(0,i.kt)("mo",{parentName:"mrow",stretchy:"false"},")")),(0,i.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"(x, y)")))),(0,i.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,i.kt)("span",{parentName:"span",className:"base"},(0,i.kt)("span",{parentName:"span",className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,i.kt)("span",{parentName:"span",className:"mopen"},"("),(0,i.kt)("span",{parentName:"span",className:"mord mathnormal"},"x"),(0,i.kt)("span",{parentName:"span",className:"mpunct"},","),(0,i.kt)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.16666666666666666em"}}),(0,i.kt)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.03588em"}},"y"),(0,i.kt)("span",{parentName:"span",className:"mclose"},")")))))," and ",(0,i.kt)("span",{parentName:"p",className:"math math-inline"},(0,i.kt)("span",{parentName:"span",className:"katex"},(0,i.kt)("span",{parentName:"span",className:"katex-mathml"},(0,i.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,i.kt)("semantics",{parentName:"math"},(0,i.kt)("mrow",{parentName:"semantics"},(0,i.kt)("mi",{parentName:"mrow"},"C")),(0,i.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"C")))),(0,i.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,i.kt)("span",{parentName:"span",className:"base"},(0,i.kt)("span",{parentName:"span",className:"strut",style:{height:"0.68333em",verticalAlign:"0em"}}),(0,i.kt)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.07153em"}},"C")))))," is a constant. The best value of ",(0,i.kt)("span",{parentName:"p",className:"math math-inline"},(0,i.kt)("span",{parentName:"span",className:"katex"},(0,i.kt)("span",{parentName:"span",className:"katex-mathml"},(0,i.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,i.kt)("semantics",{parentName:"math"},(0,i.kt)("mrow",{parentName:"semantics"},(0,i.kt)("mi",{parentName:"mrow"},"N")),(0,i.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"N")))),(0,i.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,i.kt)("span",{parentName:"span",className:"base"},(0,i.kt)("span",{parentName:"span",className:"strut",style:{height:"0.68333em",verticalAlign:"0em"}}),(0,i.kt)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.10903em"}},"N")))))," depends on the video being annotated, and is a configurable parameter."),(0,i.kt)("p",null,"This rate is additionally bounded to prevent extremely low or high playback rates and a user-controllable multiplier ",(0,i.kt)("span",{parentName:"p",className:"math math-inline"},(0,i.kt)("span",{parentName:"span",className:"katex"},(0,i.kt)("span",{parentName:"span",className:"katex-mathml"},(0,i.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,i.kt)("semantics",{parentName:"math"},(0,i.kt)("mrow",{parentName:"semantics"},(0,i.kt)("msub",{parentName:"mrow"},(0,i.kt)("mi",{parentName:"msub"},"C"),(0,i.kt)("mi",{parentName:"msub"},"u"))),(0,i.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"C_u")))),(0,i.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,i.kt)("span",{parentName:"span",className:"base"},(0,i.kt)("span",{parentName:"span",className:"strut",style:{height:"0.83333em",verticalAlign:"-0.15em"}}),(0,i.kt)("span",{parentName:"span",className:"mord"},(0,i.kt)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.07153em"}},"C"),(0,i.kt)("span",{parentName:"span",className:"msupsub"},(0,i.kt)("span",{parentName:"span",className:"vlist-t vlist-t2"},(0,i.kt)("span",{parentName:"span",className:"vlist-r"},(0,i.kt)("span",{parentName:"span",className:"vlist",style:{height:"0.151392em"}},(0,i.kt)("span",{parentName:"span",style:{top:"-2.5500000000000003em",marginLeft:"-0.07153em",marginRight:"0.05em"}},(0,i.kt)("span",{parentName:"span",className:"pstrut",style:{height:"2.7em"}}),(0,i.kt)("span",{parentName:"span",className:"sizing reset-size6 size3 mtight"},(0,i.kt)("span",{parentName:"span",className:"mord mathnormal mtight"},"u")))),(0,i.kt)("span",{parentName:"span",className:"vlist-s"},"\u200b")),(0,i.kt)("span",{parentName:"span",className:"vlist-r"},(0,i.kt)("span",{parentName:"span",className:"vlist",style:{height:"0.15em"}},(0,i.kt)("span",{parentName:"span"}))))))))))," is added to allow the user to control the overall playback rate:"),(0,i.kt)("div",{className:"math math-display"},(0,i.kt)("span",{parentName:"div",className:"katex-display"},(0,i.kt)("span",{parentName:"span",className:"katex"},(0,i.kt)("span",{parentName:"span",className:"katex-mathml"},(0,i.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},(0,i.kt)("semantics",{parentName:"math"},(0,i.kt)("mrow",{parentName:"semantics"},(0,i.kt)("mi",{parentName:"mrow"},"r"),(0,i.kt)("mo",{parentName:"mrow"},"="),(0,i.kt)("msub",{parentName:"mrow"},(0,i.kt)("mi",{parentName:"msub"},"C"),(0,i.kt)("mi",{parentName:"msub"},"u")),(0,i.kt)("mo",{parentName:"mrow"},"\u2217"),(0,i.kt)("mi",{parentName:"mrow"},"m"),(0,i.kt)("mi",{parentName:"mrow"},"a"),(0,i.kt)("mi",{parentName:"mrow"},"x"),(0,i.kt)("mo",{parentName:"mrow",stretchy:"false"},"("),(0,i.kt)("msub",{parentName:"mrow"},(0,i.kt)("mi",{parentName:"msub"},"r"),(0,i.kt)("mrow",{parentName:"msub"},(0,i.kt)("mi",{parentName:"mrow"},"m"),(0,i.kt)("mi",{parentName:"mrow"},"i"),(0,i.kt)("mi",{parentName:"mrow"},"n"))),(0,i.kt)("mo",{parentName:"mrow",separator:"true"},","),(0,i.kt)("mi",{parentName:"mrow"},"m"),(0,i.kt)("mi",{parentName:"mrow"},"i"),(0,i.kt)("mi",{parentName:"mrow"},"n"),(0,i.kt)("mo",{parentName:"mrow",stretchy:"false"},"("),(0,i.kt)("msub",{parentName:"mrow"},(0,i.kt)("mi",{parentName:"msub"},"r"),(0,i.kt)("mrow",{parentName:"msub"},(0,i.kt)("mi",{parentName:"mrow"},"m"),(0,i.kt)("mi",{parentName:"mrow"},"a"),(0,i.kt)("mi",{parentName:"mrow"},"x"))),(0,i.kt)("mo",{parentName:"mrow",separator:"true"},","),(0,i.kt)("msub",{parentName:"mrow"},(0,i.kt)("mi",{parentName:"msub"},"r"),(0,i.kt)("mi",{parentName:"msub"},"i")),(0,i.kt)("mo",{parentName:"mrow",stretchy:"false"},")"),(0,i.kt)("mo",{parentName:"mrow",stretchy:"false"},")")),(0,i.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"r = C_u * max(r_{min}, min(r_{max}, r_i))")))),(0,i.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,i.kt)("span",{parentName:"span",className:"base"},(0,i.kt)("span",{parentName:"span",className:"strut",style:{height:"0.43056em",verticalAlign:"0em"}}),(0,i.kt)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.02778em"}},"r"),(0,i.kt)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2777777777777778em"}}),(0,i.kt)("span",{parentName:"span",className:"mrel"},"="),(0,i.kt)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2777777777777778em"}})),(0,i.kt)("span",{parentName:"span",className:"base"},(0,i.kt)("span",{parentName:"span",className:"strut",style:{height:"0.83333em",verticalAlign:"-0.15em"}}),(0,i.kt)("span",{parentName:"span",className:"mord"},(0,i.kt)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.07153em"}},"C"),(0,i.kt)("span",{parentName:"span",className:"msupsub"},(0,i.kt)("span",{parentName:"span",className:"vlist-t vlist-t2"},(0,i.kt)("span",{parentName:"span",className:"vlist-r"},(0,i.kt)("span",{parentName:"span",className:"vlist",style:{height:"0.151392em"}},(0,i.kt)("span",{parentName:"span",style:{top:"-2.5500000000000003em",marginLeft:"-0.07153em",marginRight:"0.05em"}},(0,i.kt)("span",{parentName:"span",className:"pstrut",style:{height:"2.7em"}}),(0,i.kt)("span",{parentName:"span",className:"sizing reset-size6 size3 mtight"},(0,i.kt)("span",{parentName:"span",className:"mord mathnormal mtight"},"u")))),(0,i.kt)("span",{parentName:"span",className:"vlist-s"},"\u200b")),(0,i.kt)("span",{parentName:"span",className:"vlist-r"},(0,i.kt)("span",{parentName:"span",className:"vlist",style:{height:"0.15em"}},(0,i.kt)("span",{parentName:"span"})))))),(0,i.kt)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2222222222222222em"}}),(0,i.kt)("span",{parentName:"span",className:"mbin"},"\u2217"),(0,i.kt)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2222222222222222em"}})),(0,i.kt)("span",{parentName:"span",className:"base"},(0,i.kt)("span",{parentName:"span",className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,i.kt)("span",{parentName:"span",className:"mord mathnormal"},"m"),(0,i.kt)("span",{parentName:"span",className:"mord mathnormal"},"a"),(0,i.kt)("span",{parentName:"span",className:"mord mathnormal"},"x"),(0,i.kt)("span",{parentName:"span",className:"mopen"},"("),(0,i.kt)("span",{parentName:"span",className:"mord"},(0,i.kt)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.02778em"}},"r"),(0,i.kt)("span",{parentName:"span",className:"msupsub"},(0,i.kt)("span",{parentName:"span",className:"vlist-t vlist-t2"},(0,i.kt)("span",{parentName:"span",className:"vlist-r"},(0,i.kt)("span",{parentName:"span",className:"vlist",style:{height:"0.31166399999999994em"}},(0,i.kt)("span",{parentName:"span",style:{top:"-2.5500000000000003em",marginLeft:"-0.02778em",marginRight:"0.05em"}},(0,i.kt)("span",{parentName:"span",className:"pstrut",style:{height:"2.7em"}}),(0,i.kt)("span",{parentName:"span",className:"sizing reset-size6 size3 mtight"},(0,i.kt)("span",{parentName:"span",className:"mord mtight"},(0,i.kt)("span",{parentName:"span",className:"mord mathnormal mtight"},"m"),(0,i.kt)("span",{parentName:"span",className:"mord mathnormal mtight"},"i"),(0,i.kt)("span",{parentName:"span",className:"mord mathnormal mtight"},"n"))))),(0,i.kt)("span",{parentName:"span",className:"vlist-s"},"\u200b")),(0,i.kt)("span",{parentName:"span",className:"vlist-r"},(0,i.kt)("span",{parentName:"span",className:"vlist",style:{height:"0.15em"}},(0,i.kt)("span",{parentName:"span"})))))),(0,i.kt)("span",{parentName:"span",className:"mpunct"},","),(0,i.kt)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.16666666666666666em"}}),(0,i.kt)("span",{parentName:"span",className:"mord mathnormal"},"m"),(0,i.kt)("span",{parentName:"span",className:"mord mathnormal"},"i"),(0,i.kt)("span",{parentName:"span",className:"mord mathnormal"},"n"),(0,i.kt)("span",{parentName:"span",className:"mopen"},"("),(0,i.kt)("span",{parentName:"span",className:"mord"},(0,i.kt)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.02778em"}},"r"),(0,i.kt)("span",{parentName:"span",className:"msupsub"},(0,i.kt)("span",{parentName:"span",className:"vlist-t vlist-t2"},(0,i.kt)("span",{parentName:"span",className:"vlist-r"},(0,i.kt)("span",{parentName:"span",className:"vlist",style:{height:"0.151392em"}},(0,i.kt)("span",{parentName:"span",style:{top:"-2.5500000000000003em",marginLeft:"-0.02778em",marginRight:"0.05em"}},(0,i.kt)("span",{parentName:"span",className:"pstrut",style:{height:"2.7em"}}),(0,i.kt)("span",{parentName:"span",className:"sizing reset-size6 size3 mtight"},(0,i.kt)("span",{parentName:"span",className:"mord mtight"},(0,i.kt)("span",{parentName:"span",className:"mord mathnormal mtight"},"m"),(0,i.kt)("span",{parentName:"span",className:"mord mathnormal mtight"},"a"),(0,i.kt)("span",{parentName:"span",className:"mord mathnormal mtight"},"x"))))),(0,i.kt)("span",{parentName:"span",className:"vlist-s"},"\u200b")),(0,i.kt)("span",{parentName:"span",className:"vlist-r"},(0,i.kt)("span",{parentName:"span",className:"vlist",style:{height:"0.15em"}},(0,i.kt)("span",{parentName:"span"})))))),(0,i.kt)("span",{parentName:"span",className:"mpunct"},","),(0,i.kt)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.16666666666666666em"}}),(0,i.kt)("span",{parentName:"span",className:"mord"},(0,i.kt)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.02778em"}},"r"),(0,i.kt)("span",{parentName:"span",className:"msupsub"},(0,i.kt)("span",{parentName:"span",className:"vlist-t vlist-t2"},(0,i.kt)("span",{parentName:"span",className:"vlist-r"},(0,i.kt)("span",{parentName:"span",className:"vlist",style:{height:"0.31166399999999994em"}},(0,i.kt)("span",{parentName:"span",style:{top:"-2.5500000000000003em",marginLeft:"-0.02778em",marginRight:"0.05em"}},(0,i.kt)("span",{parentName:"span",className:"pstrut",style:{height:"2.7em"}}),(0,i.kt)("span",{parentName:"span",className:"sizing reset-size6 size3 mtight"},(0,i.kt)("span",{parentName:"span",className:"mord mathnormal mtight"},"i")))),(0,i.kt)("span",{parentName:"span",className:"vlist-s"},"\u200b")),(0,i.kt)("span",{parentName:"span",className:"vlist-r"},(0,i.kt)("span",{parentName:"span",className:"vlist",style:{height:"0.15em"}},(0,i.kt)("span",{parentName:"span"})))))),(0,i.kt)("span",{parentName:"span",className:"mclose"},")"),(0,i.kt)("span",{parentName:"span",className:"mclose"},")")))))),(0,i.kt)("p",null,"The rate ",(0,i.kt)("span",{parentName:"p",className:"math math-inline"},(0,i.kt)("span",{parentName:"span",className:"katex"},(0,i.kt)("span",{parentName:"span",className:"katex-mathml"},(0,i.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,i.kt)("semantics",{parentName:"math"},(0,i.kt)("mrow",{parentName:"semantics"},(0,i.kt)("mi",{parentName:"mrow"},"r")),(0,i.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"r")))),(0,i.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,i.kt)("span",{parentName:"span",className:"base"},(0,i.kt)("span",{parentName:"span",className:"strut",style:{height:"0.43056em",verticalAlign:"0em"}}),(0,i.kt)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.02778em"}},"r")))))," (equivalently, the delay until the next frame) is adjusted on every frame. This can only be implemented efficiently online if the flow computation is done offline and only the local averaging is calculated in the user's machine. For this, Covfee makes use of a pre-computed optical flow video."),(0,i.kt)("h2",{id:"optical-flow-pre-computation"},"Optical flow pre-computation"),(0,i.kt)("p",null,"For automatic speed adjustment, this task requies expects input videos to contain the original video and its corresponding optical flow video stacked side by side. An input video to the task looks like the following:"),(0,i.kt)("video",{style:{width:"100%"},src:"https://cdn.jsdelivr.net/gh/josedvq/covfee@master/samples/keypoints/www/sign_combined.mp4"}),(0,i.kt)("p",null,"Covfee uses the right side of the video for optical flow computation and only displays the left side to the user. An easy way to create the stacked video is:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Use ",(0,i.kt)("a",{parentName:"li",href:"https://github.com/josedvq/covfee/blob/master/samples/keypoints/utils/flow.py"},"this script")," to extract the optical flow of your video into a new mp4 file:")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"python flow.py --video /path/to/video.mp4 --flow /path/to/flow.mp4 --width VIDEO_WIDTH\n")),(0,i.kt)("p",null,"Replace ",(0,i.kt)("inlineCode",{parentName:"p"},"VIDEO_WIDTH")," with the pixel width of your input video (",(0,i.kt)("inlineCode",{parentName:"p"},"video.mp4")," in this case)."),(0,i.kt)("ol",{start:2},(0,i.kt)("li",{parentName:"ol"},"Stack the videos horizontally. You can use FFMPEG for this: ")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"ffmpeg -i /path/to/video.mp4 -i /path/to/flow.mp4 -filter_complex hstack video_combined.mp4\n")),(0,i.kt)("p",null,"The output file ",(0,i.kt)("inlineCode",{parentName:"p"},"video_combined.mp4")," can be used as input for a keypoint task."),(0,i.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"Optical flow can be extremely unreliable for videos with high noise (eg. low lighting conditions). Input videos might need to be denoised before optical flow pre-computation. We had good results with ffmpeg's ",(0,i.kt)("a",{parentName:"p",href:"https://ffmpeg.org/ffmpeg-filters.html#hqdn3d-1"},"hqdn3d"),":"),(0,i.kt)("pre",{parentName:"div"},(0,i.kt)("code",{parentName:"pre"},"ffmpeg -i input.mp4 -vf hqdn3d=luma_tmp=20 -vcodec libx264 -tune film output.mp4 -y\n")))),(0,i.kt)("h2",{id:"playground"},"Playground"),(0,i.kt)(n.Z,{tasks:m,mdxType:"TaskPlayground"}))}c.isMDXComponent=!0},40444:()=>{}}]);