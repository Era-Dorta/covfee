(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[57],{38091:function(e,t,n){"use strict";n.d(t,{Z:function(){return Rt}});var r=n(87462),a=n(81880),s=n(97326),i=n(94578),o=n(67294),l=n(95477),u=n(5977),c=n(68764),p=n(96846),d=n(27279),m=n(24716),h=n(66398),f=n(71230),v=n(15746),y=n(32074),k=n(96809),b=n(71577),g=(n(17772),n(50135)),E=n.n(g),T=n(15861),w=n(87757),C=n.n(w),x=n(91356),M=n.n(x),P=n(48086),S="development",Z="";function I(e,t){"production"==S?P.ZP.error(e+" Please try again later or contact the organizer(s)."):t&&(M().error(t),P.ZP.error(t.stack,0))}function L(e){return e.replace(/\$\$www\$\$/g,Z)}function O(e,t){"string"==typeof e&&(e=L(e));var n,r,a=(n="csrf_access_token",(r=document.cookie.match("(^|;)\\s*"+n+"\\s*=\\s*([^;]+)"))?r.pop():null),s=Object.assign({},t);return null!=a&&(s.headers=Object.assign({},s.headers,{"X-CSRF-TOKEN":a})),fetch(e,s)}"development"==S?M().setLevel("debug"):M().setLevel("error");var R=function(){var e=(0,T.Z)(C().mark((function e(t){var n;return C().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.ok){e.next=7;break}return e.next=3,t.json();case 3:if(!(n=e.sent).hasOwnProperty("msg")){e.next=6;break}throw Error(n.msg);case 6:throw Error(t.statusText);case 7:return e.next=9,t.json();case 9:return e.abrupt("return",e.sent);case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();var F=n(76772),_=n(66345),A=n.n(_),N="",D=function(e){function t(){for(var t,n,r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return t=n=e.call.apply(e,[this].concat(a))||this,n.state={markdown:"",error:""},t||(0,s.Z)(n)}(0,i.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){var e=this;if("raw"==this.props.content.type)this.setState({markdown:this.props.content.content});else{var t=new Headers;t.append("pragma","no-cache"),t.append("cache-control","no-cache");var n={method:"GET",headers:t};O(this.props.content.url,n).then((function(e){return e.text()})).then((function(t){e.setState({markdown:t.replace(/\$\$www\$\$/g,N)})})).catch((function(t){e.setState({error:"Error reading file "+e.props.content.url})}))}},n.renderError=function(){return o.createElement(o.Fragment,null,o.createElement(F.Z,{message:"Instructions task",description:"Error fetching file "+this.props.content.url+". Make sure the URL points to a valid file.",type:"error"}))},n.render=function(){return this.state.error?this.renderError():o.createElement(o.Fragment,null,o.createElement(f.Z,{gutter:0},o.createElement(v.Z,{span:24},o.createElement(A(),{children:this.state.markdown,allowDangerousHtml:!0}))))},t}(o.Component),B=function(e){function t(){return e.apply(this,arguments)||this}return(0,i.Z)(t,e),t}(o.Component);B.taskType="component";var j=function(e){function t(){return e.apply(this,arguments)||this}return(0,i.Z)(t,e),t}(B);j.taskType="continuous";var V=n(9676),U=n(55019),q=n(47933),z=n(2864),H=n(41890),K=n(64913),G=n(12028),W=n(41003),$={Checkbox:V.Z,"Checkbox.Group":V.Z.Group,Input:U.Z,"Input.TextArea":U.Z.TextArea,"Radio.Group":q.ZP.Group,Rate:z.Z,Select:H.Z,Slider:K.Z,Switch:G.Z},J=function(e){function t(t){var n;return n=e.call(this,t)||this,ae.call((0,s.Z)(n)),n.props.values?n.initialValues=n.props.values:t.fields&&t.fields.forEach((function(e,t){var r=void 0!==e.input.defaultValue?e.input.defaultValue:void 0!==e.input.defaultChecked?e.input.defaultChecked:null;n.initialValues[e.name]=r})),n.props.setValues(n.initialValues),n}(0,i.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){},n.render=function(){var e=this;return o.createElement(W.Z,{ref:this.formRef,layout:this.props.layout,style:{margin:"1em"},initialValues:this.initialValues,onValuesChange:function(t,n){e.props.setValues(t)},onFinish:this.handleFinish},this.props.fields&&this.props.fields.map((function(t,n){return e.evalCondition(t.condition)?o.createElement(W.Z.Item,{key:n,name:t.name,label:t.label,required:t.required,rules:t.required&&[{required:!0,message:"This field is required."}],valuePropName:["Switch","Checkbox"].includes(t.input.inputType)?"checked":"value"},function(){if(!(t.input.inputType in $))return o.createElement("p",null,"Unimplemented input element!");var n=e.patchProps(Object.assign({},t.input));return delete n.inputType,delete n.defaultValue,delete n.defaultChecked,e.renderInputElement(t.input.inputType,n,e.props.disabled)}()):null})),this.props.renderSubmitButton&&o.createElement(W.Z.Item,null,this.props.renderSubmitButton({disabled:this.props.disabled})))},t}(o.Component);J.defaultProps={layout:"vertical",disabled:!1,withSubmitButton:!1};var X,Y,Q,ee,te,ne,re,ae=function(){var e=this;this.formRef=o.createRef(),this.initialValues={},this.handleFinish=function(t){e.props.onSubmit(t)},this.renderInputElement=function(e,t,n){var r=$[e],a={};return"Slider"==e&&(a.marginLeft="25",a.marginRight="25"),o.createElement(r,Object.assign({},t,{disabled:n,style:a}),null)},this.evalCondition=function(t){return!e.props.values||!t||(t in e.props.values?e.props.values[t]:(M().warn("Unable to resolve condition "+t),!0))},this.patchProps=function(e){var t={};if("Slider"==e.inputType&&e.marks)for(var n=0,r=Object.entries(e.marks);n<r.length;n++){var a=r[n],s=a[0],i=a[1];t[s]=o.createElement("div",{style:{display:"table-caption",wordSpacing:"unset",fontSize:"0.8em"}},i)}return Object.assign({},e,{marks:t})}},se=function(e){function t(t){var n;return(n=e.call(this,t)||this).state={form:{values:null}},n.handleSubmit=function(e){n.props.onSubmit(n.state.form.values,null,!0)},n.handleFormChange=function(e){n.setState({form:Object.assign({},n.state.form,{values:Object.assign({},n.state.form.values,e)})})},t.response&&t.response.data&&(n.state.form.values=t.response.data),n}return(0,i.Z)(t,e),t.prototype.render=function(){return o.createElement(f.Z,{style:{margin:"2em 0"}},o.createElement(v.Z,{sm:{span:22,offset:1},md:{span:20,offset:2},lg:{span:16,offset:4},xl:{span:14,offset:5}},o.createElement(D,{content:this.props.spec.content}),o.createElement(J,(0,r.Z)({},this.props.spec.form,{disabled:this.props.disabled,values:this.state.form.values,setValues:this.handleFormChange,withSubmitButton:!0,renderSubmitButton:this.props.renderSubmitButton,onSubmit:this.handleSubmit}))))},t}(B),ie=n(11382),oe=["title","titleId"];function le(){return le=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},le.apply(this,arguments)}function ue(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},s=Object.keys(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var ce,pe,de,me=function(e){var t=e.title,n=e.titleId,r=ue(e,oe);return o.createElement("svg",le({id:"logo_svg__Layer_1","data-name":"Layer 1",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 293 333","aria-labelledby":n},r),t?o.createElement("title",{id:n},t):null,X||(X=o.createElement("defs",null,o.createElement("style",null,".logo_svg__cls-4{stroke:#000;stroke-miterlimit:10;stroke-width:2px}.logo_svg__cls-4,.logo_svg__cls-7{fill:#b3b3b3}.logo_svg__cls-8{fill:#0071bc}"))),Y||(Y=o.createElement("path",{fill:"#29abe2",d:"M114 332.98V64.59h179v161.5"})),Q||(Q=o.createElement("path",{fill:"#333",d:"M114.16 332.98l35.45-268.39H78.7l35.46 268.39z"})),ee||(ee=o.createElement("path",{fill:"#005994",d:"M149.61 64.59l-35.45 268.39L228.05 64.59h-78.44z"})),te||(te=o.createElement("path",{fill:"#005791",d:"M78.73 64.61L114.19 333 .29 64.61"})),ne||(ne=o.createElement("path",{className:"logo_svg__cls-8",d:"M228 221.25L114.19 333 228.05 64.59 228 221.25zM0 211.53l114.23 121.09L.36 64.2 0 211.53z"})),re||(re=o.createElement("path",{fill:"#999",d:"M0 0h228v64.59H0z"})))},he=(o.Component,function(e){function t(){return e.apply(this,arguments)||this}return(0,i.Z)(t,e),t.prototype.render=function(){return o.createElement("div",{style:{display:"flex",alignItems:"center",height:"46px"}},o.createElement(me,{width:"30",height:"30"}))},t}(o.Component)),fe=n(20354),ve=n(91034),ye=n(22199),ke=n(9715),be=n.n(ke),ge=H.Z.Option,Ee=m.Z.Text,Te=function(e){function t(){for(var t,n,r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return t=n=e.call.apply(e,[this].concat(a))||this,n.state={task:void 0,loading:!1,pressedDelete:!1,formKey:0},n.resetForm=function(){n.setState({task:n.props.new?void 0:n.props.task,loading:!1,pressedDelete:!1,formKey:n.state.formKey+1})},n.handleSubmit=function(){n.props.onSubmit(n.state.task).then((function(){n.props.onClose()}))},n.handleChange=function(e){n.setState({task:Object.assign({},n.state.task,e)})},n.handleDelete=function(){n.props.onDelete().then((function(){n.props.onClose()}))},n.handleDeleteClick=function(e){n.setState({pressedDelete:!0})},t||(0,s.Z)(n)}(0,i.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){this.resetForm()},n.componentDidUpdate=function(e){this.props.visible!=e.visible&&this.props.visible&&this.resetForm()},n.render=function(){var e=this,t=o.createElement(o.Fragment,null);return this.props.new||(t=this.state.pressedDelete?o.createElement(o.Fragment,null,o.createElement(Ee,{type:"danger"},"All annotations submitted for this task may be lost. Are you sure you want to delete?"),o.createElement("br",null),o.createElement(b.Z,{danger:!0,type:"primary",onClick:this.handleDelete},"Delete"),o.createElement(b.Z,{type:"default",onClick:function(){e.setState({pressedDelete:!1})}},"Cancel")):o.createElement(b.Z,{danger:!0,type:"primary",onClick:this.handleDeleteClick},"Delete")),o.createElement(k.Z,{visible:this.props.visible,title:"Create new task",onOk:this.handleSubmit,onCancel:this.props.onClose,footer:[o.createElement(b.Z,{key:"back",onClick:this.props.onClose},"Cancel"),o.createElement(b.Z,{key:"submit",type:"primary",loading:this.state.loading,onClick:this.handleSubmit},"Submit")]},o.createElement(we,{key:this.state.formKey,presets:this.props.presets,task:this.state.task,onChange:this.handleChange}),t)},t}(o.Component),we=function(e){function t(t){var n;return(n=e.call(this,t)||this).state={error:null,preset:""},n.handlePresetChange=function(e){n.setState({preset:e}),n.props.onChange(n.props.presets[e])},n.handleNameChange=function(e){n.props.onChange({name:e.target.value})},void 0!==t.task||t.presets||(n.state.error="Task or presets must be given."),void 0===t.task&&(t.onChange(Object.values(n.props.presets)[0]),n.state.preset=Object.keys(n.props.presets)[0]),n}(0,i.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){},n.render=function(){return void 0===this.props.task?null:this.state.error?o.createElement(F.Z,{message:this.state.error,type:"error"}):o.createElement(o.Fragment,null,this.props.presets&&o.createElement(W.Z.Item,{label:"Preset"},o.createElement(H.Z,{value:this.state.preset,style:{width:120},onChange:this.handlePresetChange},Object.entries(this.props.presets).map((function(e){var t=e[0];e[1];return o.createElement(ge,{key:t,value:t},t)})))),o.createElement(W.Z.Item,{label:"Type"},o.createElement(H.Z,{value:this.props.task.type,style:{width:120},disabled:!0},o.createElement(ge,{key:0,value:this.props.task.type},this.props.task.type))),o.createElement(W.Z.Item,{label:"Name"},o.createElement(U.Z,{value:this.props.task.name,onChange:this.handleNameChange})))},t}(o.Component),Ce=function(e){function t(t){var n;return(n=e.call(this,t)||this).state={editTaskModal:{taskId:[0,0],visible:!1,new:!1}},n.taskElementRefs=[],n.handleClickEdit=function(e){n.props.editMode.enabled&&n.setState({editTaskModal:Object.assign({},n.state.editTaskModal,{taskId:e,visible:!0,new:!1})})},n.handleClickAdd=function(e){n.props.editMode.enabled&&n.setState({editTaskModal:Object.assign({},n.state.editTaskModal,{taskId:[e,null],visible:!0,new:!0})})},n.handleEditTaskCancel=function(){n.setState({editTaskModal:Object.assign({},n.state.editTaskModal,{visible:!1})})},n}(0,i.Z)(t,e);var n=t.prototype;return n.componentDidUpdate=function(e){var t=this.props.currTask;e.currTask!=t&&this.taskElementRefs[t[0]]&&this.taskElementRefs[t[0]].scrollIntoView()},n.render=function(){var e=this;return this.taskElementRefs=[],o.createElement(Pe,null,this.props.editMode.enabled&&function(){var t;if(e.state.editTaskModal.new)t=null;else{var n=e.state.editTaskModal.taskId;t=n[1]?e.props.tasks[n[0]].children[n[1]].spec:e.props.tasks[n[0]].spec}return o.createElement(Te,{visible:e.state.editTaskModal.visible,new:e.state.editTaskModal.new,presets:e.props.editMode.presets,task:t,onSubmit:function(t){return e.state.editTaskModal.new?e.props.editMode.onTaskCreate(e.state.editTaskModal.taskId[0],t):e.props.editMode.onTaskEdit(t.id,t)},onClose:e.handleEditTaskCancel,onDelete:function(){return e.props.editMode.onTaskDelete(e.state.editTaskModal.taskIndex)}})}(),o.createElement(Se,null,this.props.children),this.props.editMode.enabled&&this.props.editMode.allowNew&&o.createElement(b.Z,{type:"primary",className:"sidebar-new",block:!0,onClick:function(){e.handleClickAdd(null)},icon:o.createElement(fe.Z,null)},"New Task"),o.createElement(Ze,null,o.createElement("ol",{className:"task-group"},this.props.tasks.map((function(t,n){return o.createElement(xe,{key:t.id,ref:function(t){e.taskElementRefs[n]=t},name:t.spec.name,children:t.children?t.children.map((function(t,r){return{name:t.spec.name,status:n===e.props.currTask[0]&&r===e.props.currTask[1]?"active":0==t.num_submissions?"default":t.valid?"valid":"invalid",editable:!0}})):[],status:n==e.props.currTask[0]&&null==e.props.currTask[1]?"active":0==t.num_submissions?"default":t.valid?"valid":"invalid",editable:t.editable,onClickActivate:function(t){e.props.onChangeActiveTask([n,t])},onClickEdit:function(t){e.handleClickEdit([n,t])}})})))))},t}(o.Component),xe=function(e){function t(){for(var t,n,r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return t=n=e.call.apply(e,[this].concat(a))||this,n.liRef=o.createRef(),n.toggleExpand=function(){},n.scrollIntoView=function(){n.liRef.current&&n.liRef.current.scrollIntoView({behavior:"smooth",block:"center"})},t||(0,s.Z)(n)}return(0,i.Z)(t,e),t.prototype.render=function(){var e=this;return o.createElement("li",{className:be()("task-li"),ref:this.liRef},o.createElement(Me,{name:this.props.name,className:{"btn-parent":!0},status:this.props.status,active:this.props.active,editable:!1,expandable:!!this.props.children,onClickActivate:function(){e.props.onClickActivate(null)},onClickExpand:this.toggleExpand}),this.props.editable&&o.createElement("div",{className:be()(["sidebar-group-editbtn","background"]),onClick:function(){e.props.onClickEdit(null)}},o.createElement("span",null,"edit task")),o.createElement("ol",{className:"sidebar-children"},this.props.children.map((function(t,n){return o.createElement("li",{key:n},o.createElement(Me,{name:t.name,className:{"btn-child":!0},status:e.props.status,active:t.active,editable:!1,expandable:!1,onClickActivate:function(){e.props.onClickActivate(n)},onClickExpand:e.toggleExpand}))}))))},t}(o.Component),Me=function(e){function t(){return e.apply(this,arguments)||this}return(0,i.Z)(t,e),t.prototype.render=function(){return o.createElement("div",{className:be()("btn","btn-"+this.props.status,Object.assign({},this.props.className)),onClick:this.props.onClickActivate},o.createElement("div",{className:"btn-icon"},this.props.editable&&o.createElement(ve.Z,null),this.props.expandable&&o.createElement(ye.Z,null)),o.createElement("div",{className:"btn-name"},this.props.name))},t}(o.Component);Me.defaultProps={expandable:!1};var Pe=l.ZP.nav(ce||(ce=(0,a.Z)(['\n    display: flex;\n    flex-flow: column;\n    width: 100%;\n    height: inherit;\n    background-color: #a6a6a6;\n\n  \n    &-new {\n      margin: 2px;\n    }\n  \n    &-group {\n      &-editbtn {\n        font-size: 0.8em;\n        line-height: 14px;\n        color: #5c5252;\n        text-align: right;\n        text-transform: uppercase;\n  \n        &:hover {\n          cursor: pointer;\n        }\n      }\n  \n      &-editbtn.background {\n        position: relative;\n        z-index: 1;\n  \n        &:before {\n          border-top: 2px solid #dfdfdf;\n          content: "";\n          margin: 0 auto;\n          /* this centers the line to the full width specified */\n          position: absolute;\n          /* positioning must be absolute here, and relative positioning must be applied to the parent */\n          top: 50%;\n          left: 0;\n          right: 0;\n          bottom: 0;\n          width: 95%;\n          z-index: -1;\n        }\n  \n        span {\n          /* to hide the lines from behind the text, you have to set the background color the same as the container */\n          background: #f0f2f5;\n          padding: 0 5px;\n        }\n      }\n  \n    }\n  \n    &.bottom {\n      margin-top: auto;\n    }\n  \n    &.children {\n      list-style-type: none;\n      margin: 0;\n      padding-left: 25px;\n    }    \n  }']))),Se=l.ZP.nav(pe||(pe=(0,a.Z)(["\n    background-color: #464646;\n    padding: 5;\n\n    > button {\n        border-radius: 0;\n    }\n  "]))),Ze=l.ZP.div(de||(de=(0,a.Z)(["\n    flex: 2;\n    padding: 2 0 2 2;\n    overflow-y: scroll;\n    scrollbar-width: 12px;\n    scrollbar-color: rgb(244, 63, 94) rgb(99, 102, 241);\n    \n    &::-webkit-scrollbar {\n        width: 12px;\n    }\n    &::-webkit-scrollbar-track {\n        background: #a6a6a6;\n        border-radius: 6px;\n    }\n    &::-webkit-scrollbar-thumb {\n        background-color: #d5d5d5;\n        border-radius: 6px;\n        border: 2px solid #a6a6a6;\n    }\n\n    > .task-group {\n        height: inherit;\n        list-style-type: none;\n        margin: 0;\n        padding: 0;\n  \n        > li > .btn {\n          border: 1px solid #d9d9d9;\n          border-radius: 2px;\n          margin: 2px;\n          color: #363636;\n          clear: both;\n      \n          > .btn-name {\n            width: calc(100% - 36px);\n            overflow-x: hidden;\n            display: block;\n            padding: 5px;\n      \n            &:hover {\n              cursor: pointer;\n            }\n          }\n      \n          > .btn-icon {\n            display: block;\n            float: right;\n            width: 20px;\n            height: 20px;\n            margin: 8px;\n            color:#d5d5d5;\n          }\n      \n          &.btn-default {\n            background-color: #fafafa;\n          }\n      \n          &.btn-active {\n            color: #fafafa;\n            background-color: #2c70de;\n          }\n  \n          &.btn-valid {\n            background-color: #b2cf23;\n          }\n  \n          &.btn-invalid {\n            background-color: #cf6565;\n          }\n        }\n      }\n  "]))),Ie=n(1866),Le=o.createContext({}),Oe=(m.Z.Title,m.Z.Text),Re=function(e){function t(t){var n;return(n=e.call(this,t)||this).listeners={},n.keysToListeners={},n.listenerStatus={},n.keydown=function(e){var t=e.target.tagName.toLowerCase();if(!["input","textarea","select","button"].includes(t)&&e.key in n.keysToListeners){var r=n.keysToListeners[e.key];r in n.listeners||I("Registed key has no event"),n.listenerStatus[r]=!0,e.preventDefault(),"keydown"in n.listeners[r].events&&n.listeners[r].events.keydown.forEach((function(t){t(e)}))}},n.keyup=function(e){var t=e.target.tagName.toLowerCase();if(!["input","textarea","select","button"].includes(t)&&e.key in n.keysToListeners){var r=n.keysToListeners[e.key];r in n.listeners||I("Registed key has no event"),n.listenerStatus[r]=!1,"keyup"in n.listeners[r].events&&n.listeners[r].events.keyup.forEach((function(t){t(e)}))}},n.addListener=function(e,t,r){n.listeners[e]={defaultKey:t,description:r,events:{}},n.keysToListeners[t]=e;var a=(0,s.Z)(n);return{addEvent:function(t,n){return t in a.listeners[e].events||(a.listeners[e].events[t]=[]),a.listeners[e].events[t].push(n),this}}},n.removeListener=function(e){if(M().info("removing listener "+e),!(e in n.listeners))return M().warn("listener "+e+" not found.");var t=n.listeners[e].defaultKey;delete n.keysToListeners[t],delete n.listeners[e]},n.applyMap=function(e){for(var t=0,r=Object.entries(e);t<r.length;t++){var a=r[t],s=a[0],i=a[1];i in n.keysToListeners&&(n.keysToListeners[i]=s)}},n.getStatus=function(e){return n.listenerStatus[e]},n.getContext=function(){return{addListener:n.addListener,removeListener:n.removeListener,applyMap:n.applyMap,getStatus:n.getStatus,renderInfo:n.renderInfo}},n.getDummyContext=function(){return{addListener:function(){(0,s.Z)(n);return{addEvent:function(){return this}}},removeListener:function(){},applyMap:function(){},getStatus:function(){},renderInfo:function(){return null}}},n.renderInfo=function(){return o.createElement(Ie.ZP,null,Object.entries(n.listeners).map((function(e,t){e[0];var n=e[1];return o.createElement(Ie.ZP.Item,{key:t},o.createElement(Oe,{keyboard:!0},o.createElement("span",{style:{color:"black"}},"[",n.defaultKey,"]")),n.description)})))},addEventListener("keydown",n.keydown,!1),addEventListener("keyup",n.keyup,!1),n}(0,i.Z)(t,e);var n=t.prototype;return n.componentWillUnmount=function(){removeEventListener("keydown",this.keydown),removeEventListener("keyup",this.keyup)},n.render=function(){return o.createElement(Le.Provider,{value:{getContext:this.getContext,getDummyContext:this.getDummyContext,renderInfo:this.renderInfo}},this.props.children)},t}(o.Component),Fe=n(73935),_e=n(19181),Ae=function(e){function t(){for(var t,n,r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return t=n=e.call.apply(e,[this].concat(a))||this,n.container=o.createRef(),n.videoBorder=o.createRef(),n.handleMouseMove=function(e){var t=[e.offsetX/n.resolution[0],e.offsetY/n.resolution[1]];n.props.onData(t,e)},n.handleMouseOver=function(e){n.props.onMouseActiveChange(!0)},n.handleMouseOut=function(e){n.props.onMouseActiveChange(!1)},t||(0,s.Z)(n)}(0,i.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){var e=this;this.props.disable||(this.container.current.addEventListener("mouseover",this.handleMouseOver),this.container.current.addEventListener("mouseout",this.handleMouseOut),new ResizeObserver((function(t){e.resolution=[t[0].contentRect.width,t[0].contentRect.height]})).observe(this.container.current),this.props.paused||this.start())},n.componentDidUpdate=function(e){this.props.paused!==e.paused&&(this.props.paused?this.stop():this.start())},n.componentWillUnmount=function(){this.props.paused&&this.stop(),this.container.current.removeEventListener("mouseover",this.handleMouseOver),this.container.current.removeEventListener("mouseout",this.handleMouseOut)},n.start=function(){this.props.disable||this.container.current.addEventListener("mousemove",this.handleMouseMove)},n.stop=function(){this.container.current.removeEventListener("mousemove",this.handleMouseMove)},n.getContainer=function(){return this.container.current},n.render=function(){return o.createElement("div",{className:be()({"mouse-tracker":!0,"mouse-tracker-active":this.props.mouseActive&&!this.props.paused,"mouse-tracker-occluded":this.props.mouseActive&&!this.props.paused&&this.props.occluded}),ref:this.videoBorder},o.createElement("div",{className:"video-container",ref:this.container},this.props.children))},t}(o.Component),Ne=Ae,De=function(e){function t(){for(var t,n,r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return t=n=e.call.apply(e,[this].concat(a))||this,n.container=null,n.rect=null,n.pointerRef=null,n.posPx=[0,0],n.setData=function(e){n.pointerRef&&(n.posPx=[Math.round(e[0]*n.rect.width),Math.round(e[1]*n.rect.height)],n.pointerRef.style.top=n.posPx[1]+"px",n.pointerRef.style.left=n.posPx[0]+"px")},t||(0,s.Z)(n)}(0,i.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){var e=this;new ResizeObserver((function(t){e.rect=t[0].contentRect})).observe(this.container)},n.render=function(){var e=this;return o.createElement("div",{className:"mouse-visualizer",ref:function(t){e.container=t}},this.props.children,!this.props.disable&&o.createElement("div",{className:"mouse-visualizer-pointer",ref:function(t){e.pointerRef=t},style:{top:this.posPx[1]+"px",left:this.posPx[0]+"px"}}))},t}(o.Component);De.defaultProps={disable:!1};var Be=De,je=(m.Z.Title,m.Z.Text,function(e){function t(t){var n;(n=e.call(this,t)||this).state={occluded:!1,mouse_valid:!1,opticalFlowEnabled:!0,playbackRateIdx:7},n.tracker=o.createRef(),n.mouse_normalized=[0,0],n.playbackRates=[.1,1/8,1/6,.2,1/4,1/3,.5,1,2,3,4],n.speedup=function(){n.setState({playbackRateIdx:Math.min(n.state.playbackRateIdx+1,n.playbackRates.length-1)})},n.speeddown=function(){n.setState({playbackRateIdx:Math.max(n.state.playbackRateIdx-1,0)})},n.back2s=function(){var e=Math.max(0,n.props.player.currentTime()-2);n.props.player.currentTime(e)},n.back10s=function(){var e=Math.max(0,n.props.player.currentTime()-10);n.props.player.currentTime(e)},n.toggleOcclusion=function(){n.setState({occluded:!n.state.occluded})},n.handleMouseData=function(e){n.mouse_normalized=e},n.getMousePosition=function(){return n.mouse_normalized},n.handleMouseActiveChange=function(e){n.setState({mouse_valid:e})},n.setOpticalFlowEnabled=function(e){n.setState({opticalFlowEnabled:e},(function(){localStorage.setItem("opticalFlowEnabled",e?"1":"0")}))},n.toggleOpticalFlow=function(){n.setOpticalFlowEnabled(!n.state.opticalFlowEnabled)},n.handleFrame=function(e){n.props.response?n.replayUntil(e):n.props.buffer.data(e,[].concat(n.mouse_normalized,[n.state.mouse_valid?1:0,n.state.occluded?1:0]))},n.handleVideoEnded=function(){n.props.onEnd(null)},n.replayUntil=function(e){var t,r=n.props.buffer.read(e);t=r[0],r[1],t&&n.updateMouseVisualization([t[1],t[2]])},n.replayAction=function(e){if("number"==typeof e[3])return n.mouse_normalized=[e[3],e[4]],void n.setState({mouse_valid:!!e[5],occluded:!!e[6]});switch(e[1]){case"speedup":n.speedup();break;case"speeddown":n.speeddown();break;case"back2s":n.back2s();break;case"back10s":n.back10s()}},n.wrapPlayerElement=function(e){return o.createElement(Ne,{disable:null!==n.props.response,paused:!1,occluded:n.state.occluded,mouseActive:n.state.mouse_valid,onData:n.handleMouseData,onMouseActiveChange:n.handleMouseActiveChange},o.createElement(Be,{disable:null===n.props.response,ref:function(e){e&&(n.updateMouseVisualization=e.setData)}},e))},n.instructions=function(){return n.props.buttons.renderInfo()};var r=localStorage.getItem("opticalFlowEnabled");return null!==r&&(n.state.opticalFlowEnabled="1"==r),null!==t.response&&(n.state.opticalFlowEnabled=!1),M().info("constructing task "+n.props.myKey),n}(0,i.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){var e=this;M().info("mounting task "+this.props.myKey),this.props.buttons.addListener("speedup","ArrowRight","Increase playback speed.").addEvent("keydown",(function(t){e.speedup()})),this.props.buttons.addListener("speeddown","ArrowLeft","Decrease playback speed.").addEvent("keydown",(function(t){e.speeddown()})),this.props.buttons.addListener("play"," ","Toggle play/pause the video.").addEvent("keydown",(function(t){e.props.player.togglePlayPause()})),this.props.buttons.addListener("back2s","x","Go back 2s.").addEvent("keydown",(function(t){e.back2s()})),this.props.buttons.addListener("back10s","c","Go back 10s.").addEvent("keydown",(function(t){e.back10s()})),this.props.buttons.addListener("occlusion","z","Toggle occlusion flag.").addEvent("keydown",(function(t){e.toggleOcclusion()})),this.props.buttons.addListener("opticalflow","v","Toggle optical flow-based speed adjustment.").addEvent("keydown",(function(t){e.toggleOpticalFlow()})),this.props.player.addListener("frame",this.handleFrame),this.props.player.addListener("end",this.handleVideoEnded)},n.componentWillUnmount=function(){M().info("unmounting task "+this.props.myKey),this.props.buttons.removeListener("speedup"),this.props.buttons.removeListener("speeddown"),this.props.buttons.removeListener("play"),this.props.buttons.removeListener("back2s"),this.props.buttons.removeListener("back10s"),this.props.buttons.removeListener("occlusion"),this.props.buttons.removeListener("opticalflow"),this.props.player.removeListeners("frame"),this.props.player.removeListeners("end")},n.render=function(){return o.createElement(o.Fragment,null,this.props.renderPlayer({type:"OpencvFlowPlayer",media:this.props.spec.media,opticalFlowEnabled:this.state.opticalFlowEnabled,setOpticalFlowEnabled:this.setOpticalFlowEnabled,playbackRateMultiplier:this.playbackRates[this.state.playbackRateIdx],getMousePosition:this.getMousePosition,wrapPlayerElement:this.wrapPlayerElement}))},t}(j));je.taskInfo={bufferDataLen:2};var Ve=function(e){function t(t){var n;return(n=e.call(this,t)||this).intensity=0,n.speed=0,n.observer=null,n.containerHeight=0,n.mousemove=function(e){var t=(n.container.getBoundingClientRect().bottom-e.clientY)/n.containerHeight;n.intensity=Math.max(0,Math.min(1,t))},n.addBinaryKeyboardEvents=function(){var e=n.inputProps.controls;n.props.buttons.addListener("up","q","Activate"),e&&n.props.buttons.applyMap(e)},n.addContinuousKeyboardEvents=function(){n.props.buttons.addListener("up","ArrowUp","Increase").addEvent("keydown",(function(){n.intensity=Math.min(1,n.intensity+.05)})),n.props.buttons.addListener("down","ArrowDown","Decrease").addEvent("keydown",(function(){n.intensity=Math.max(0,n.intensity-.05)}));var e=n.inputProps.controls;e&&n.props.buttons.applyMap(e)},n.addGravityKeyboardEvents=function(){n.props.buttons.addListener("up","a","Increase").addEvent("keydown",(function(){n.intensity=1,n.speed=0}));var e=n.inputProps.controls;e&&n.props.buttons.applyMap(e)},n.startInput=function(){"binary"==n.inputProps.mode?n.addBinaryKeyboardEvents():"continuous-mousemove"==n.inputProps.mode?document.addEventListener("mousemove",n.mousemove,!1):"continuous-keyboard"==n.inputProps.mode?n.addContinuousKeyboardEvents():"gravity-keyboard"==n.inputProps.mode?n.addGravityKeyboardEvents():I("Unrecognized input mode.")},n.read=function(){return n.intensity},n.updateIndicators=function(e){if(null!==n.container&&null!==n.indicator)if(["binary"].includes(n.inputProps.mode))n.container.style.backgroundColor=e?"green":"black";else{var t=Math.round(e*n.containerHeight);n.indicator.style.bottom=t.toString()+"px"}},n.animate=function(e){if(n.props.visualizationModeOn)n.intensity=n.props.getIntensity();else{if("binary"==n.inputProps.mode&&(n.intensity=n.props.buttons.getStatus("up")?1:0),n.inputProps.mode,n.inputProps.mode,"gravity-keyboard"==n.inputProps.mode){n.intensity=Math.max(0,Math.min(1,n.intensity+1*n.speed)),n.speed=n.speed-1*n.inputProps.acceleration_constant}n.props.setIntensity(n.intensity)}n.updateIndicators(n.intensity),n.animationId=requestAnimationFrame(n.animate)},n.inputProps=n.applyInputPropDefaults(),n}(0,i.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){var e=this;this.observer=new ResizeObserver((function(t){e.containerHeight=t[0].contentRect.height-20})),this.observer.observe(this.container),this.props.visualizationModeOn||this.startInput(),this.animationId=requestAnimationFrame(this.animate)},n.componentWillUnmount=function(){document.removeEventListener("mousemove",this.mousemove,!1),this.observer.disconnect(),cancelAnimationFrame(this.animationId)},n.componentDidUpdate=function(e){var t=this;cancelAnimationFrame(this.animationId),this.inputProps=this.applyInputPropDefaults(),this.setState(this.state,(function(){t.animationId=requestAnimationFrame(t.animate)}))},n.applyInputPropDefaults=function(){return"binary"==this.props.input.mode?Object.assign({},this.props.input,{controls:Object.assign({up:"a"},this.props.input.controls?this.props.input.controls:{})}):"gravity-keyboard"==this.props.input.mode?Object.assign({jump_speed:.1,acceleration_constant:.0025},this.props.input,{controls:Object.assign({up:"a"},this.props.input.controls?this.props.input.controls:{})}):"continuous-keyboard"==this.props.input.mode?Object.assign({},this.props.input,{controls:Object.assign({up:"s",down:"a"},this.props.input.controls?this.props.input.controls:{})}):this.props.input},n.render=function(){var e=this;return o.createElement("div",{ref:function(t){e.container=t},className:"gui-vertical"},!["binary"].includes(this.inputProps.mode)&&o.createElement("div",{ref:function(t){e.indicator=t},className:"gui-indicator",style:{bottom:0}}))},t}(o.Component);Ve.defaultProps={};m.Z.Title;var Ue=function(e){function t(t){var n;return(n=e.call(this,t)||this).state={},n.reverseCountTimerId=null,n.frameUpdateTimerId=null,n.handleFrame=function(e){n.props.response?n.replayUntil(e):n.props.buffer.data(e,[n.intensity])},n.handleVideoSwitch=function(e,t){n.props.response||n.props.buffer.log(n.props.player.currentTime(),["vidswitch",e,t])},n.back2s=function(){var e=Math.max(0,n.props.player.currentTime()-2);n.props.player.currentTime(e)},n.back10s=function(){var e=Math.max(0,n.props.player.currentTime()-10);n.props.player.currentTime(e)},n.replayUntil=function(e){var t,r,a=n.props.buffer.read(e);t=a[0],r=a[1],t&&n.setIntensity(t[1]),r&&r.forEach((function(e){n.replayAction(e[2])}))},n.replayAction=function(e){e[0]},n.handleVideoEnded=function(){n.props.onEnd(null)},n.setIntensity=function(e){n.intensity=e},n.wrapPlayer=function(e){return e},n.instructions=function(){return n.props.buttons.renderInfo()},n}(0,i.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){var e=this;this.props.buttons.addListener("play-pause"," ","Play/pause the video and data capture.").addEvent("keydown",(function(t){e.props.player.paused?e.props.buffer.log(e.props.player.currentTime(),["play"]):e.props.buffer.log(e.props.player.currentTime(),["pause"]),e.props.player.togglePlayPause()})),this.props.spec.controls&&this.props.buttons.applyMap(this.props.spec.controls),this.props.player.addListener("frame",this.handleFrame),this.props.player.addListener("end",this.handleVideoEnded),this.props.player.addListener("vidswitch",this.handleVideoSwitch)},n.componentWillUnmount=function(){this.props.buttons.removeListener("play-pause"),this.props.buttons.removeListener("back2s"),this.props.buttons.removeListener("back10s"),this.frameUpdateTimerId&&clearInterval(this.frameUpdateTimerId)},n.render=function(){var e=this;return o.createElement(o.Fragment,null,o.createElement(f.Z,null,o.createElement(v.Z,{span:20},this.props.renderPlayer({type:"HTML5Player",media:this.props.spec.media,countdown:this.props.spec.showCountdown})),o.createElement(v.Z,{span:4},o.createElement(Ve,{buttons:this.props.buttons,setIntensity:this.setIntensity,getIntensity:function(){return e.intensity},input:this.props.spec.intensityInput,visualizationModeOn:!!this.props.response}))))},t}(j);Ue.taskInfo={bufferDataLen:1};var qe=n(97544),ze=function(e){function t(){for(var t,n,r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return t=n=e.call.apply(e,[this].concat(a))||this,n.videoNode=o.createRef(),t||(0,s.Z)(n)}(0,i.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){var e=this,t={autoplay:this.props.autoplay,controls:this.props.controls,fluid:this.props.fluid,aspectRatio:this.props.aspectRatio,sources:[{src:L(this.props.url),type:"video/mp4"}]};this.player=(0,qe.Z)(this.videoNode.current,t),this.props.onPlay&&this.player.on("play",(function(t){e.props.onPlay(t)})),this.props.onPause&&this.player.on("pause",(function(t){e.props.onPause(t)})),this.props.onEnded&&this.player.on("ended",(function(t){e.props.onEnded(t)}))},n.play=function(){this.player.play()},n.playbackRate=function(e){this.player.playbackRate(e)},n.toggle_play_pause=function(){this.player.paused()?this.player.play():this.player.pause()},n.currentTime=function(e){return this.player.currentTime(e)},n.componentWillUnmount=function(){this.player&&this.player.dispose()},n.render=function(){return o.createElement("div",{"data-vjs-player":!0},o.createElement("video",{ref:this.videoNode,className:"video-js"}))},t}(o.PureComponent);ze.defaultProps={paused:!0,autoplay:!1,controls:!0,fluid:!0,aspectRatio:"16:9"};var He=ze,Ke=n(62615),Ge=n.n(Ke),We=function(e){function t(){return e.apply(this,arguments)||this}return(0,i.Z)(t,e),t}(o.Component),$e=function(e){function t(){for(var t,n,r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return t=n=e.call.apply(e,[this].concat(a))||this,n.state={},n.container=o.createRef(),n.play=function(){n.props.setPaused(!1)},n.pause=function(){n.player.pause()},n.playPause=function(){n.props.setPaused(!n.props.paused)},n.currentTime=function(e){if(!e)return n.player.getCurrentTime();n.player.setCurrentTime(e)},t||(0,s.Z)(n)}(0,i.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){var e=this;this.player=Ge().create(Object.assign({container:this.container.current,waveColor:"violet",progressColor:"purple",interact:!1},this.props.waveSurferOptions)),this.player.load(this.props.media.url),this.player.on("ended",(function(){e.props.onEnd}))},n.componentDidUpdate=function(e){this.props.paused!==e.paused&&(this.props.paused?this.player.pause():this.player.play())},n.render=function(){var e=o.createElement(b.Z,{onClick:this.playPause,type:"primary"},this.props.paused?"Play":"Pause");return o.createElement("div",{style:{margin:"2em"}},o.createElement("div",{ref:this.container}),e)},t}(We);$e.defaultProps={playPauseButton:!0};var Je=$e,Xe={ContinuousKeypointTask:je,Continuous1DTask:Ue,QuestionnaireTask:function(e){function t(t){var n;return(n=e.call(this,t)||this).state={media:{paused:!0},form:{values:null,disabled:n.props.disabled}},n.handleChange=function(e){n.setState({form:Object.assign({},n.state.form,{values:Object.assign({},n.state.form.values,e)})})},n.handleMediaEnded=function(){n.setState({form:Object.assign({},n.state.form,{disabled:!1})})},n.handleSubmit=function(){n.props.onSubmit(n.state.form.values,null,!0)},t.response&&t.response.data&&(n.state.form.values=t.response.data),null!=t.spec.disabledUntilEnd&&(n.state.form.disabled=t.spec.disabledUntilEnd),n}return(0,i.Z)(t,e),t.prototype.render=function(){var e=this;return o.createElement(o.Fragment,null,o.createElement(f.Z,{gutter:16},this.props.spec.media&&o.createElement(v.Z,{span:16},function(){switch(e.props.spec.media.type){case"video":return o.createElement(He,(0,r.Z)({},e.props.spec.media,{onEnded:e.handleMediaEnded}));case"audio":return o.createElement(Je,(0,r.Z)({},e.props.spec.media,{onEnded:e.handleMediaEnded}));default:return o.createElement("p",null,"Unrecognized media type.")}}()),o.createElement(v.Z,{span:this.props.spec.media?8:24},o.createElement(J,(0,r.Z)({},this.props.spec.form,{disabled:this.props.disabled,values:this.state.form.values,setValues:this.handleChange,withSubmitButton:!0,renderSubmitButton:this.props.renderSubmitButton,onSubmit:this.handleSubmit})))))},t}(B),InstructionsTask:se},Ye=n(40831),Qe=n(48603),et=function(e){function t(){for(var t,n,r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return t=n=e.call.apply(e,[this].concat(a))||this,n.state={currentTime:null},t||(0,s.Z)(n)}(0,i.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){var e=this;this.setState({currentTime:this.props.currentTime()}),this.timeoutId=setInterval((function(){e.setState({currentTime:e.props.currentTime()})}),1e3)},n.componentWillUnmount=function(){clearInterval(this.timeoutId)},n.render=function(){return o.createElement("div",{className:"annot-bar"},o.createElement("div",{className:"annot-bar-section"},o.createElement(Ye.Z,null)," ",this.state.currentTime&&this.state.currentTime.toFixed(0)," / ",this.props.duration&&this.props.duration.toFixed(0)),this.props.setSpeed&&o.createElement("div",{className:"annot-bar-section"},o.createElement(Qe.Z,null)," ",this.props.speed.toPrecision(2),o.createElement(K.Z,{style:{display:"inline-block",margin:"0 0 0 8px",width:"200px"},min:.1,max:4,step:.1,defaultValue:30,value:this.props.speed,onChange:this.props.setSpeed})),this.props.children)},t}(o.Component);et.defaultProps={speedEnabled:!0};var tt=function(e){function t(){return e.apply(this,arguments)||this}return(0,i.Z)(t,e),t.prototype.render=function(){return o.createElement("div",{className:"demo"},o.createElement("div",{className:"demo__colored-blocks"},o.createElement("div",{className:"demo__colored-blocks-rotater"},o.createElement("div",{className:"demo__colored-block"}),o.createElement("div",{className:"demo__colored-block"}),o.createElement("div",{className:"demo__colored-block"})),o.createElement("div",{className:"demo__colored-blocks-inner"}),o.createElement("div",{className:"demo__text"},"Ready")),o.createElement("div",{className:"demo__inner"},o.createElement("svg",{className:"demo__numbers",viewBox:"0 0 100 100"},o.createElement("defs",null,o.createElement("path",{className:"demo__num-path-1",d:"M40,28 55,22 55,78"}),o.createElement("path",{className:"demo__num-join-1-2",d:"M55,78 55,83 a17,17 0 1,0 34,0 a20,10 0 0,0 -20,-10"}),o.createElement("path",{className:"demo__num-path-2",d:"M69,73 l-35,0 l30,-30 a16,16 0 0,0 -22.6,-22.6 l-7,7"}),o.createElement("path",{className:"demo__num-join-2-3",d:"M28,69 Q25,44 34.4,27.4"}),o.createElement("path",{className:"demo__num-path-3",d:"M30,20 60,20 40,50 a18,15 0 1,1 -12,19"})),o.createElement("path",{className:"demo__numbers-path",d:"M-10,20 60,20 40,50 a18,15 0 1,1 -12,19  Q25,44 34.4,27.4 l7,-7 a16,16 0 0,1 22.6,22.6 l-30,30 l35,0 L69,73  a20,10 0 0,1 20,10 a17,17 0 0,1 -34,0 L55,83  l0,-61 L40,28"}))))},t}(o.Component),nt=function(e){function t(t){var n;if((n=e.call(this,t)||this).state={duration:null,countdownActive:!1},n.canvasTag=o.createRef(),n.videoTags=Array(),n.active_idx=0,n.time=0,n.videoFrameCallbackId=null,n.countdownTimeoutId=null,n.handleEnd=function(){n.props.onEnd(),n.pause()},n.setActiveVideo=function(e,t){n.videoTags[n.active_idx].current.removeEventListener("ended",n.handleEnd),n.videoTags[e].current.addEventListener("ended",n.handleEnd),n.isMultiview&&(n.videoTags[e].current.currentTime=n.videoTags[n.active_idx].current.currentTime,t||n.props.onEvent("vidswitch",n.active_idx,e),n.active_idx=e,n.copyVideoToCanvas())},n.copyVideoToCanvas=function(){var e=n.canvasTag.current.width,t=n.canvasTag.current.height;n.canvasCtx.drawImage(n.videoTags[n.active_idx].current,0,0,e,t)},n.onFrame=function(e){e!==n.time&&(n.time=e,n.props.onFrame(n.time)),"video-multiview"==n.props.media.type&&n.copyVideoToCanvas()},n.onVideoFrameCallback=function(e,t){var r=t.mediaTime;n.onFrame(r),n.videoFrameCallbackId=n.videoTags[n.active_idx].current.requestVideoFrameCallback(n.onVideoFrameCallback)},n.onRequestAnimationFrame=function(){var e=n.videoTags[n.active_idx].current.currentTime;n.onFrame(e),n.videoFrameCallbackId=requestAnimationFrame(n.onRequestAnimationFrame)},n.startPlayCountdown=function(){n.setState({countdownActive:!0}),n.countdownTimeoutId=setTimeout((function(){n.setState({countdownActive:!1},(function(){n.play()}))}),1500)},n.currentTime=function(e,t){if(!n.videoTags[n.active_idx].current)return null;if(void 0===e)return n.videoTags[n.active_idx].current.currentTime;n.videoTags[n.active_idx].current.currentTime=e,n.props.setPaused(!0);n.videoTags[n.active_idx].current.addEventListener("timeupdate",(function e(){n.copyVideoToCanvas(),n.videoTags[n.active_idx].current.removeEventListener("timeupdate",e)})),t&&t()},n.renderBar=function(){return o.createElement(et,{duration:n.state.duration,currentTime:function(){return n.currentTime()},paused:n.props.paused,setPaused:n.props.setPaused,speed:n.props.speed,setSpeed:n.props.setSpeed,muted:n.props.muted,setMuted:n.props.setMuted})},n.renderMultiview=function(){if("video-multiview"===n.props.media.type)return o.createElement("div",{className:"html5player"},n.renderBar(),o.createElement("canvas",{ref:n.canvasTag,className:"video-canvas",width:800,height:450}),o.createElement("div",{className:"video-multiview-selector"},n.props.media.url.map((function(e,t){var r=t===n.active_idx;return o.createElement("video",{key:t,style:{width:100/n.props.media.url.length+"%"},onClick:function(){n.props.paused&&n.setActiveVideo(t)},ref:n.videoTags[t],src:L(e),crossOrigin:"Anonymous",preload:"auto",muted:n.props.media.muted||!r})}))))},n.renderSingleview=function(){if("video"===n.props.media.type)return o.createElement("div",{className:"html5player",style:{position:"relative",backgroundColor:"black"}},n.renderBar(),o.createElement("video",{style:{width:"100%",maxHeight:"calc(80vh)"},ref:n.videoTags[0],src:L(n.props.media.url),crossOrigin:"Anonymous",preload:"auto",muted:n.props.media.muted}),n.state.countdownActive&&o.createElement(tt,null))},n.isMultiview="video-multiview"==n.props.media.type,n.isMultiview){n.videoTags=[];for(var r=0;r<n.props.media.url.length;r++)n.videoTags.push(o.createRef())}else n.videoTags=[o.createRef()];return n}(0,i.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){var e=this;this.isMultiview&&(this.canvasCtx=this.canvasTag.current.getContext("2d"));var t=this.videoTags[this.active_idx].current;t.addEventListener("loadeddata",(function(n){e.setState({duration:t.duration}),e.props.onLoad(t.duration),e.setActiveVideo(0)})),this.props.media.speed&&(t.playbackRate=this.props.media.speed)},n.componentDidUpdate=function(e){(this.props.paused!==e.paused&&(this.props.paused?this.pause():this.props.countdown?this.startPlayCountdown():this.play()),this.props.speed!==e.speed)&&(this.videoTags[this.active_idx].current.playbackRate=this.props.speed);this.props.activeMedia!==e.activeMedia&&this.setActiveVideo(this.props.activeMedia)},n.componentWillUnmount=function(){this.videoFrameCallbackId&&(this.props.useRequestAnimationFrame?cancelAnimationFrame(this.videoFrameCallbackId):this.videoTags[this.active_idx].current.cancelVideoFrameCallback(this.videoFrameCallbackId))},n.play=function(){this.props.useRequestAnimationFrame?this.videoFrameCallbackId=requestAnimationFrame(this.onRequestAnimationFrame):this.videoFrameCallbackId=this.videoTags[this.active_idx].current.requestVideoFrameCallback(this.onVideoFrameCallback),this.videoTags.forEach((function(e){e.current.play()}))},n.pause=function(){this.state.countdownActive&&(this.setState({countdownActive:!1}),clearTimeout(this.countdownTimeoutId)),this.props.useRequestAnimationFrame?cancelAnimationFrame(this.videoFrameCallbackId):this.videoTags[this.active_idx].current.cancelVideoFrameCallback(this.videoFrameCallbackId),this.videoFrameCallbackId=null,this.videoTags.forEach((function(e){e.current.pause()}))},n.render=function(){return"video-multiview"==this.props.media.type?this.renderMultiview():this.renderSingleview()},t}(We);nt.defaultProps={countdown:!1};var rt=n(80791),at=n(20074),st=function(e){function t(t){var n;return(n=e.call(this,t)||this).req_id=!1,n.ratio=.5,n.ratesIndex=0,n.state={countdownActive:!1,duration:0,opticalFlowEnabled:!1},n.countdownTimeoutId=null,n.opencv_init=function(){var e=function(){n.frame_flow=new cv.Mat(n.props.media.resolution[1],2*n.props.media.resolution[0],cv.CV_8UC4),n.myMean=new cv.Mat(1,4,cv.CV_64F),n.myStddev=new cv.Mat(1,4,cv.CV_64F),n.cap=new cv.VideoCapture(n.videoTag),n.props.paused||n.play()};null==cv.Mat?cv.onRuntimeInitialized=e:e()},n.copyVideoToCanvas=function(){var e=n.canvasTag.width,t=n.canvasTag.height;n.canvasCtx.drawImage(n.videoTag,0,0,n.props.media.resolution[0],n.props.media.resolution[1],0,0,e,t)},n.getRatesMovingAverage=function(){return n.rates.reduce((function(e,t){return e+t}),0)/n.rates.length||0},n.frameCallback=function(){var e;if(n.state.opticalFlowEnabled){var t=n.props.getMousePosition(),r=[t[0]*n.props.media.resolution[0],t[1]*n.props.media.resolution[1]];n.cap.read(n.frame_flow);var a=Math.max(0,r[0]-n.props.L),s=Math.min(r[0]+n.props.L,n.props.media.resolution[0]),i=Math.max(0,r[1]-n.props.L),o=Math.min(r[1]+n.props.L,n.props.media.resolution[1]),l=new cv.Rect(n.props.media.resolution[0]+a,i,s-a,o-i),u=n.frame_flow.roi(l);if(cv.meanStdDev(u,n.myMean,n.myStddev),e=1/Math.max(1,n.myMean.doubleAt(0,0))*n.props.playbackRateMultiplier,e=Math.min(4,Math.max(.1,e)),0!=n.props.T){var c=n.getRatesMovingAverage();e>c&&(e=Math.min(e,1.2*c))}}else e=1*n.props.playbackRateMultiplier;n.videoTag.playbackRate=e,n.rates[n.ratesIndex++%n.props.T]=e,n.props.onFrame(n.videoTag.currentTime),n.req_id=n.videoTag.requestVideoFrameCallback(n.frameCallback),n.copyVideoToCanvas()},n.startPlayCountdown=function(){n.setState({countdownActive:!0}),n.countdownTimeoutId=setTimeout((function(){n.setState({countdownActive:!1},(function(){n.play()}))}),1500)},n.currentTime=function(e,t){return n.videoTag?void 0===e?n.videoTag.currentTime:(n.videoTag.currentTime=e,n.props.setPaused(!0),n.copyVideoToCanvas(),t?t():void 0):null},n.handleToggleOpticalFlow=function(){n.props.setOpticalFlowEnabled(!n.props.opticalFlowEnabled)},n.renderBar=function(){var e="";return e=Number.isInteger(n.props.playbackRateMultiplier)?n.props.playbackRateMultiplier.toString():n.props.playbackRateMultiplier.toPrecision(2),o.createElement(et,{duration:n.state.duration,currentTime:n.currentTime,paused:n.props.paused,setPaused:n.props.setPaused,speed:n.props.speed,setSpeed:n.props.setSpeed,muted:n.props.muted,setMuted:n.props.setMuted},o.createElement("div",{className:"annot-bar-right"},o.createElement(Qe.Z,null),o.createElement(b.Z,{size:"small",type:"primary",danger:!0},e)," ",o.createElement(rt.Z,null),o.createElement(b.Z,{size:"small",danger:n.props.opticalFlowEnabled,type:n.props.opticalFlowEnabled?"primary":"default"},o.createElement(at.Z,null)," ",o.createElement(V.Z,{checked:n.props.opticalFlowEnabled,onChange:n.handleToggleOpticalFlow}))))},n.state.opticalFlowEnabled=!!t.media.hasFlow&&t.opticalFlowEnabled,n.rates=Array(t.T).fill(1),n}(0,i.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){var e=this,t=this;this.videoTag.addEventListener("loadedmetadata",(function(e){t.state.opticalFlowEnabled&&t.opencv_init()}),!1),this.canvasCtx=this.canvasTag.getContext("2d"),fetch(L(this.props.media.url)).then((function(e){return e.blob()})).then((function(t){e.videoTag.src=window.URL.createObjectURL(t)})).catch((function(t){e.props.onError("There has been an error while loading the videos.",t)})),this.videoTag.addEventListener("loadeddata",(function(t){e.copyVideoToCanvas(),e.setState({duration:e.videoTag.duration}),e.props.onLoad(e.videoTag.duration,e.props.media.fps)})),this.videoTag.addEventListener("ended",(function(t){e.props.onEnd(),e.pause()}))},n.componentDidUpdate=function(e){var t=this;this.props.paused!==e.paused&&(this.props.paused?this.pause():this.props.countdown?this.startPlayCountdown():this.play()),this.props.opticalFlowEnabled!==e.opticalFlowEnabled&&this.setState({opticalFlowEnabled:!!this.props.media.hasFlow&&this.props.opticalFlowEnabled},(function(){t.state.opticalFlowEnabled&&t.opencv_init()}))},n.play=function(){this.videoTag.play(),this.req_id=this.videoTag.requestVideoFrameCallback(this.frameCallback)},n.pause=function(){this.videoTag.pause(),this.req_id=!1},n.restart=function(){this.currentTime(0)},n.render=function(){var e=this;return o.createElement(o.Fragment,null,this.renderBar(),this.props.wrapPlayerElement(o.createElement("div",{style:{position:"relative"}},o.createElement("canvas",{ref:function(t){e.canvasTag=t},style:{width:"100%"},width:800,height:450}),this.state.countdownActive&&o.createElement(tt,null))),o.createElement("video",{ref:function(t){e.videoTag=t},width:1920,height:540,crossOrigin:"Anonymous",style:{display:"none"},preload:"auto",disablePictureInPicture:!0,muted:!0}))},t}(We);st.defaultProps={L:10,T:0,countdown:!0,opticalFlowEnabled:!0,playbackRateMultiplier:1};var it,ot={HTML5Player:nt,OpencvFlowPlayer:st,WaveSurferBasicPlayer:$e},lt=m.Z.Title,ut=m.Z.Text,ct=function(e){function t(){return e.apply(this,arguments)||this}return(0,i.Z)(t,e),t.prototype.render=function(){return this.props.visible?o.createElement(pt,null,o.createElement("nav",null,this.props.title&&o.createElement(lt,{style:{color:"white"}},this.props.title),this.props.subtext&&o.createElement(ut,{style:{color:"white"}},"this.props.subtext"),o.createElement("div",{className:"task-overlay-primary"},this.props.mainOptions.map((function(e,t){if(e)return o.createElement("span",{key:t,className:"main-option"},e)}))),o.createElement("div",{className:"task-overlay-secondary"},this.props.secondaryOptions&&this.props.secondaryOptions.map((function(e,t){if(e)return o.createElement("span",{key:t,className:"secondary-option"},e)}))))):null},t}(o.Component),pt=l.ZP.div(it||(it=(0,a.Z)(["\n    position: absolute;\n    padding: 1em 0;\n    width: 50%;\n    top: calc(35vh);\n    left: 50%;\n    transform: translate(-50%, -50%);\n    background-color: rgba(0, 0, 0, .7);\n    border-width: 3px;\n    border-style: solid;\n    border-color: #363636;\n    z-index: 2;\n  \n    span.main-option {\n      display: inline-block;\n      margin: 0 5px;\n    }\n  \n    > nav {\n      width: 100%;\n      text-align: center;\n    }\n  }\n  "]))),dt=n(48415);function mt(e,t){return ht.apply(this,arguments)}function ht(){return(ht=(0,T.Z)(C().mark((function e(t,n){return C().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.resolve());case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ft,vt=n(22528).Buffer,yt=n(37095)._,kt=function(){function e(){}var t=e.prototype;return t.pack=function(e,t,n,r){var a=(new TextEncoder).encode(JSON.stringify(t)),s=vt.from(e),i=vt.from(a),o=new Uint32Array(4);o[0]=s.byteLength,o[1]=i.byteLength,o[2]=n,o[3]=r;var l=vt.from(o.buffer),u=vt.concat([l,s,i]);return u.buffer.slice(u.byteOffset,u.byteOffset+u.byteLength)},t.unpackChunkList=function(e){var t=(new yt).endianess("little").uint32("dataLength").uint32("logsLength").uint32("chunkLength").uint32("recordLength").buffer("data",{length:"dataLength",clone:!0}).string("logs",{length:"logsLength",clone:!0}),n=(new yt).endianess("little").uint32("numChunks").array("chunks",{type:t,length:"numChunks"}),r=vt.from(e),a=n.parse(r);return a.chunks.forEach((function(e){e.logs=JSON.parse(e.logs)})),a},e}(),bt=function(e,t,n,r,a,s,i,o,l){void 0===e&&(e=!1),void 0===t&&(t=1),void 0===n&&(n=200),void 0===r&&(r=60),void 0===a&&(a=""),void 0===s&&(s=function(){}),void 0===i&&(i=!0),void 0===o&&(o=5),void 0===l&&(l=!0),gt.call(this),this.chunkLength=n,this.fps=r,this.sampleLength=t,this.recordLength=t+1+(l?1:0),this.outBufferErrorLength=o,this.chunkByteLength=this.chunkLength*(4+8*this.recordLength),this.url=a,this.disabled=e,this.eager=i,this.writeTimestamp=l,e&&(this.fetch_fn=mt),this.onError=s},gt=function(){var e,t=this;this.dataBuffer=Array(),this.outBuffer=Array(),this.outBufferErrorLength=10,this.tailptr=0,this.logptr=0,this.receivedData=!1,this.cntr=1,this.chunkIndex=0,this.isDataReady=!1,this.isDataPromisePending=!1,this.awaitClearPending=!1,this.awaitClearPromise=null,this.fetch_fn=(e=3e3,function(){var t=(0,T.Z)(C().mark((function t(n,r){var a,s,i;return C().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=new AbortController,s=setTimeout((function(){return a.abort()}),e),t.next=4,fetch(n,Object.assign({},r,{signal:a.signal}));case 4:return i=t.sent,clearTimeout(s),t.abrupt("return",i);case 7:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()),this.reset=function(){t.tailptr=0,t.logptr=0,t.receivedData=!1,t.chunkIndex=0},this._createChunkFromArrayBuffer=function(e,n){void 0===n&&(n=null);var r={chunk_index:t.chunkIndex++,idxs:new Uint32Array(e,0,t.chunkLength),data:new Float64Array(e,4*t.chunkLength,t.chunkLength*t.recordLength),logs:n||Array(),buff:e};t.dataBuffer.push(r)},this._createChunk=function(){var e=new ArrayBuffer(t.chunkByteLength);t._createChunkFromArrayBuffer(e)},this.loadChunks=function(e){if(0===e.byteLength)throw new Error("Provided ArrayBuffer is empty");t.reset();for(var n=(new kt).unpackChunkList(e).chunks,r=0;r<n.length;r++)t._createChunkFromArrayBuffer(n[r].data.buffer,n[r].logs)},this._load=(0,T.Z)(C().mark((function e(){var n,r,a;return C().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.url+"/chunks",!t.loadDataPromise||!t.isDataPromisePending){e.next=3;break}return e.abrupt("return",t.loadDataPromise);case 3:return(r=new Headers).append("pragma","no-cache"),r.append("cache-control","no-cache"),a={method:"GET",headers:r},t.isDataPromisePending=!0,t.loadDataPromise=O(n,a).then(function(){var e=(0,T.Z)(C().mark((function e(n){var r;return C().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.isDataReady=!0,e.next=3,n.arrayBuffer();case 3:r=e.sent,t.loadChunks(r);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){})).finally((function(){t.isDataPromisePending=!1})),e.abrupt("return",t.loadDataPromise);case 10:case"end":return e.stop()}}),e)}))),this.createChunksUntil=function(e){for(;t.dataBuffer.length<=e;)t._createChunk()},this.mediatimeToChunkSample=function(e){var n=Math.round(e*t.fps);return[Math.floor(n/t.chunkLength),n%t.chunkLength]},this.isOutBufferFull=function(){return t.outBuffer.length>t.outBufferErrorLength},this.data=function(e,n){if(!t.disabled){var r;t.receivedData=!0,r=t.writeTimestamp?[e,Date.now()].concat(n):[e].concat(n);var a=t.mediatimeToChunkSample(e),s=a[0],i=a[1];t.createChunksUntil(s);for(var o=i*t.recordLength,l=0;l<t.recordLength;l++)t.dataBuffer[s].data[o+l]=r[l];t.dataBuffer[s].idxs[i]=t.cntr++,s-t.tailptr>(t.eager?1:5)&&t.advanceTail()}},this.read=function(e){var n=t.mediatimeToChunkSample(e),r=n[0],a=n[1];if(void 0===t.dataBuffer[r]||void 0===t.dataBuffer[r].idxs[a])return[null,null];var s,i=[];if(0===t.dataBuffer[r].idxs[a])s=null;else{s=[];for(var o=a*t.recordLength+(t.writeTimestamp?1:0),l=0;l<t.recordLength;l++)s.push(t.dataBuffer[r].data[o+l])}for(;t.logptr<t.dataBuffer[r].logs.length&&t.dataBuffer[r].logs[t.logptr][1]<e;)i.push(t.dataBuffer[r].logs[t.logptr]),t.logptr+=1;return[s,i]},this.log=function(e,n){t.receivedData=!0;var r=t.mediatimeToChunkSample(e),a=r[0];r[1];t.createChunksUntil(a);var s=[t.cntr++,e,n];t.dataBuffer[a].logs.push(s)},this.advanceTail=function(){t.outBuffer.push(t.dataBuffer[t.tailptr]),t.tailptr++,t.awaitClear(),t.isOutBufferFull()&&t.onError("Output buffer full. Data may be lost.")},this.submitChunk=(0,T.Z)(C().mark((function e(){var n,r,a,s;return C().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.outBuffer[0],r=(new kt).pack(n.buff,n.logs,t.chunkLength,t.recordLength),a={method:"POST",body:r},s=t.url+"/chunk?"+new URLSearchParams({index:n.chunk_index.toString(),length:t.chunkLength.toString()}),e.abrupt("return",t.fetch_fn(s,a).then(function(){var e=(0,T.Z)(C().mark((function e(n){var r,a;return C().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.json();case 2:if(r=e.sent,n.ok){e.next=6;break}return a=r&&r.message||n.status,e.abrupt("return",Promise.reject(a));case 6:t.outBuffer.shift();case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 5:case"end":return e.stop()}}),e)}))),this.flush=function(){var e=(0,T.Z)(C().mark((function e(n){return C().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===n&&(n=8e3),t.receivedData){e.next=3;break}return e.abrupt("return",Promise.resolve());case 3:for(;t.tailptr!==t.dataBuffer.length;)t.advanceTail();return e.abrupt("return",t.awaitClear(n));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.awaitClear=function(){var e=(0,T.Z)(C().mark((function e(n){return C().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===n&&(n=4e3),!t.awaitClearPending){e.next=3;break}return e.abrupt("return",t.awaitClearPromise);case 3:return t.awaitClearPending=!0,t.awaitClearPromise=Promise.race([(0,T.Z)(C().mark((function e(){return C().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.outBuffer.length>0)){e.next=5;break}return e.next=3,t.submitChunk();case 3:e.next=0;break;case 5:case"end":return e.stop()}}),e)})))(),new Promise((function(e,t){setTimeout((function(){t(new Error("The server is taking too long to respond."))}),n)}))]),t.awaitClearPromise.finally((function(){t.awaitClearPending=!1})),e.abrupt("return",t.awaitClearPromise);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},Et=Object.freeze({parent:null,disabled:!1,previewMode:!1,interfaceMode:"annotation",renderTaskSubmitButton:null,renderTaskNextButton:null,fetchTaskResponse:function(){return Promise.resolve(null)},submitTaskResponse:function(){return Promise.resolve(null)},onSubmit:function(){},onClickNext:function(){}}),Tt=function(e){function t(t){var n;n=e.call(this,t)||this,wt.call((0,s.Z)(n));var r=function(e){if(e in Xe){var t=Xe[e];return"object"==typeof t&&"taskConstructor"in t&&"taskReducer"in t?t:{taskConstructor:t,taskReducer:null}}return null}(n.props.task.spec.type),a=r.taskConstructor,i=r.taskReducer;return n.taskConstructor=a,n.taskReducer=i,n.state.renderAs=n.getTaskRenderAs(),n.state.instructions.visible="popped"==n.props.task.spec.instructionsType,n}(0,i.Z)(t,e);var n=t.prototype;return n.componentWillUnmount=function(){this.mountPromise.promise.catch((function(){})),this.mountPromise.cancel()},n.render=function(){var e=this;return o.createElement(o.Fragment,null,this.renderErrorModal(),o.createElement("div",{ref:function(t){e.taskInstructionsElem=t}}),o.createElement("div",{style:{width:"100%",position:"relative"}},this.renderOverlay(),function(){if("loading"==e.state.status)return null;var t,n={spec:e.props.task.spec,response:"continuous-task"!=e.state.renderAs.type||e.state.replayMode?e.response:null,buffer:e.buffer,buttons:e.context.getContext(),getSharedState:e.getSharedState};("taskSpecific"in e.props.task&&(n=Object.assign({},n,e.props.task.taskSpecific)),"default"==e.state.renderAs.type)?t=Object.assign({},n,{disabled:e.props.disabled,onSubmit:function(t){return e.handleTaskSubmit(t,"task")},renderSubmitButton:e.props.renderTaskSubmitButton}):t=Object.assign({},n,{player:e.getPlayerContext(),renderPlayer:e.renderPlayer,onEnd:e.handleTaskEnd});return o.createElement(e.taskConstructor,Object.assign({key:e.state.taskKey,myKey:e.state.taskKey,ref:function(t){e.createTaskRef(t)}},t),null)}()))},t}(o.Component);Tt.defaultProps=Et;var wt=function(){var e=this;this.endTaskResult=null,this.listeners={},this.state={status:"loading",renderAs:null,replayMode:!1,taskKey:0,player:{loaded:!1,paused:!0,muted:!1},errorModal:{visible:!1},overlay:{visible:!1},instructions:{visible:!1}},this.getTaskRenderAs=function(){var t="default";return"continuous"==e.taskConstructor.taskType&&(t="continuous-task"),{type:t,timed:!1}},this.isContinuousTask=function(){return"continuous-task"==e.state.renderAs.type},this.isMaxSubmissionsReached=function(){return e.props.task.maxSubmissions&&e.props.task.num_submissions>=e.props.task.maxSubmissions},this.componentDidMount=function(){var t,n;e.mountPromise=(t=Promise.all([e.props.fetchTaskResponse(e.props.task).then((function(t){e.response=t})),e.props.parent&&e.props.fetchTaskResponse(e.props.parent).then((function(t){e.parentResponse=t}))]),n=!1,{promise:new Promise((function(e,r){t.then((function(t){return n?r({isCanceled:!0}):e(t)}),(function(e){return r(n?{isCanceled:!0}:e)}))})),cancel:function(){n=!0}}),e.mountPromise.promise.then((function(t){e.response&&e.response.submitted?e.setState({status:"loaded"}):e.loadTask(!0)}))},this.loadTask=function(t){void 0===t&&(t=!0),e.setState({replayMode:!t}),e.isContinuousTask()?(M().info("creating buffers"),e.createBuffers(),t?e.setState({status:"ready",taskKey:e.state.taskKey+1}):e.loadBuffers().finally((function(){e.setState({status:"ready",taskKey:e.state.taskKey+1})}))):e.setState({status:"ready",taskKey:e.state.taskKey+1})},this.createBuffers=function(){e.buffer=new bt(e.props.previewMode||null===e.response,e.taskConstructor.taskInfo.bufferDataLen,200,e.props.task.spec.media.fps||60,e.response?e.response.url:null,e.handleBufferError)},this.loadBuffers=function(){return Promise.all([e.buffer?e.buffer._load():Promise.resolve(),e.parentBuffer?e.parentBuffer._load():Promise.resolve()])},this.loadTaskForReplay=function(){e.loadTask(!1)},this.clearAndReloadTask=function(){return O(e.props.task.url+"/make_response?"+new URLSearchParams({}),{method:"POST"}).then(R).then((function(t){e.response=t,e.loadTask(!0)})).catch((function(e){I("Error making task response.",e)}))},this.handleTaskSubmit=function(t,n){(e.buffer?e.buffer.flush():Promise.resolve()).then((function(){return e.props.submitTaskResponse(e.response,t)})).then((function(t){e.response=t.response,e.setState({status:"submitted"}),e.props.onSubmit(n)})).catch((function(t){I("Error submitting the task.",t),e.setState({status:"ended"})}))},this.handleTaskEnd=function(t,n){if(void 0===n&&(n=!1),e.props.task.autoSubmit&&!e.state.replayMode)return e.handleTaskSubmit(t,"modal");e.endTaskResult=t,e.setState({status:"ended"})},this.handleBufferError=function(t){e.setState({errorModal:Object.assign({},e.state.errorModal,{visible:!0,message:t})})},this.handleErrorOk=function(){e.setState({errorModal:{visible:!0,message:"Attempting to submit. The window will be closed if successful.",loading:!0}})},this.handleErrorCancel=function(){e.setState({errorModal:Object.assign({},e.state.errorModal,{visible:!1})})},this.renderErrorModal=function(){return o.createElement(k.Z,{title:"Error",visible:e.state.errorModal.visible,confirmLoading:e.state.errorModal.loading,onOk:e.handleErrorOk,onCancel:e.handleErrorCancel,cancelButtonProps:{disabled:!0},okButtonProps:{}},o.createElement("p",null,e.state.errorModal.message))},this.getOverlayInitTimedTask=function(){return{title:"This is a timed task!",subtext:'Make sure to set up and be ready before you hit "Start". Once you do you will not be able to stop the countdown.',mainOptions:[o.createElement(b.Z,{type:"primary",onClick:function(){}},"Start")]}},this.getOverlayAfterReplayOrStop=function(){return{title:"Replay finished",mainOptions:[o.createElement(b.Z,{danger:!0,type:"primary",onClick:e.clearAndReloadTask,disabled:e.isMaxSubmissionsReached()},"Restart Task"),o.createElement(b.Z,{type:"primary",onClick:e.loadTaskForReplay,loading:e.state.overlay.submitting},"Watch again"),e.props.renderTaskNextButton()]}},this.getOverlayNonSubmittedTask=function(){return{title:"Done!",mainOptions:[o.createElement(b.Z,{danger:!0,type:"primary",onClick:e.clearAndReloadTask,disabled:e.isMaxSubmissionsReached()},"Discard & Restart"),o.createElement(b.Z,{type:"primary",onClick:function(){e.handleTaskSubmit(e.endTaskResult,"modal")},loading:e.state.overlay.submitting},"Submit")],secondaryOptions:[e.props.task.num_submissions>0&&o.createElement(b.Z,{danger:!0,type:"text",onClick:e.loadTaskForReplay},"Discard and replay last submission")]}},this.getOverlaySubmittedTask=function(){return{title:"Your task is submitted!",mainOptions:[o.createElement(b.Z,{danger:!0,type:"primary",onClick:e.clearAndReloadTask,disabled:e.isMaxSubmissionsReached()},"Submit again"),o.createElement(b.Z,{type:"default",onClick:e.loadTaskForReplay,loading:e.state.overlay.submitting},"Replay submission"),e.props.renderTaskNextButton()]}},this.createTaskRef=function(t){e.taskInstructionsElem&&(e.taskElement=t,t&&t.instructions?Fe.render(e.renderTaskInfo(t.instructions()),e.taskInstructionsElem):e.props.task.spec.instructions&&Fe.render(e.renderTaskInfo(null),e.taskInstructionsElem))},this.createPlayerRef=function(t){e.player=t},this.hideInstructions=function(){e.setState({instructions:Object.assign({},e.state.instructions,{visible:!1})})},this.handleInstructionsVisibleChange=function(t){e.setState({instructions:Object.assign({},e.state.instructions,{visible:t})})},this.renderTaskInfo=function(t){return void 0===t&&(t=null),o.createElement(_e.Z,{title:"Instructions",placement:"bottom",visible:e.state.instructions.visible,onVisibleChange:e.handleInstructionsVisibleChange,content:o.createElement(Mt,null,e.props.task.spec.instructions,t,o.createElement("div",{style:{textAlign:"right"}},o.createElement(b.Z,{type:"primary",onClick:e.hideInstructions},"OK"))),trigger:"click"},o.createElement("div",{className:"task-instructions-button"},o.createElement(dt.Z,null)," Instructions"))},this.renderOverlay=function(){switch(e.state.status){case"loaded":if(e.props.task.num_submissions>0&&"continuous-task"==e.state.renderAs.type)return o.createElement(ct,(0,r.Z)({visible:!0},e.getOverlaySubmittedTask()));if(e.props.task.timer)return o.createElement(ct,(0,r.Z)({visible:!0},e.getOverlayInitTimedTask()));break;case"ended":return e.state.replayMode?o.createElement(ct,(0,r.Z)({visible:!0},e.getOverlayAfterReplayOrStop())):o.createElement(ct,(0,r.Z)({visible:!0},e.getOverlayNonSubmittedTask()));case"submitted":if("continuous-task"==e.state.renderAs.type)return o.createElement(ct,(0,r.Z)({visible:!0},e.getOverlaySubmittedTask()));break;default:return null}},this.setPaused=function(t){e.setState({player:Object.assign({},e.state.player,{paused:t})})},this.setMuted=function(t){e.setState({player:Object.assign({},e.state.player,{muted:t})})},this.addListener=function(t,n){t in e.listeners||(e.listeners[t]=[]),e.listeners[t].push(n)},this.removeListeners=function(t){t in e.listeners&&delete e.listeners[t]},this.dispatchPlayerEvent=function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];t in e.listeners&&e.listeners[t].forEach((function(e){e.apply(void 0,r)}))},this.handlePlayerLoad=function(t,n){e.dispatchPlayerEvent("load",t,n)},this.handlePlayerFrame=function(t){e.dispatchPlayerEvent("frame",t)},this.handlePlayerEnd=function(){e.dispatchPlayerEvent("end")},this.getPlayerContext=function(){return{paused:e.state.player.paused,muted:e.state.player.muted,togglePlayPause:function(){e.setPaused(!e.state.player.paused)},play:function(){e.setPaused(!0)},pause:function(){e.setPaused(!1)},mute:function(){e.setMuted(!0)},unmute:function(){e.setMuted(!1)},currentTime:function(t){return e.player.currentTime(t)},addListener:e.addListener,removeListeners:e.removeListeners}},this.renderPlayer=function(t){void 0===t&&(t={});var n,r=(n=t.type)in ot?ot[n]:null,a=Object.assign({},t,{ref:e.createPlayerRef,paused:e.state.player.paused,setPaused:e.setPaused,muted:e.state.player.muted,setMuted:e.setMuted,onLoad:e.handlePlayerLoad,onFrame:e.handlePlayerFrame,onEnd:e.handlePlayerEnd,onEvent:e.dispatchPlayerEvent});return o.createElement(r,a,null)}};Tt.contextType=Le;var Ct,xt,Mt=l.ZP.div(ft||(ft=(0,a.Z)(["\n    width: calc(30vw);\n    max-height: calc(50vh);\n"]))),Pt=(d.Z.Panel,m.Z.Text),St="http://127.0.0.1:5000/api",Zt=function(e){function t(t){var n;n=e.call(this,t)||this,It.call((0,s.Z)(n)),n.url=St+"/instances/"+n.props.id;var r=n.makeTaskIds(),a=0;return t.match&&void 0!==t.match.params.taskId&&(a=Math.min(r.length-1,parseInt(t.match.params.taskId))),n.state=Object.assign({},n.state,{currTask:[a,null],taskIds:r,prerequisitesCompleted:n.prerequisitesCompleted()}),n.updateUrl(a),n}(0,i.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){},n.componentDidUpdate=function(e){this.props.tasks!=e.tasks&&this.setState({taskIds:this.makeTaskIds()})},n.render=function(){var e,t,n=this,r=this.getTask(this.state.currTask),a=null!=this.state.currTask[1]?this.getTask([this.state.currTask[0],null]):null,s=this.getHitExtra();return o.createElement(Re,null,o.createElement(h.Z,{onClick:this.handleMenuClick,mode:"horizontal",theme:"dark",style:{position:"sticky",top:0,width:"100%",zIndex:1e4}},o.createElement(h.Z.Item,{key:"logo",disabled:!0},o.createElement(he,null)),o.createElement(h.Z.Item,{key:"task",disabled:!0},o.createElement(Pt,{strong:!0,style:{color:"white"}},r.spec.name)),s&&o.createElement(h.Z.Item,{key:"extra",icon:o.createElement(c.Z,null)},"Extra")),o.createElement(Lt,{height:this.props.height},this.renderMenu()),o.createElement(Ot,{height:this.props.height},s&&o.createElement(E(),{open:this.state.extraOpen},o.createElement(f.Z,null,o.createElement(v.Z,{span:24},s))),o.createElement(f.Z,null,this.props.interface.showProgress&&o.createElement("div",{style:{margin:"5px 15px"}},(e=Object.values(n.props.tasks).filter((function(e){return e.valid})).length,t=Object.values(n.props.tasks).length,o.createElement(y.Z,{percent:100*e/t,format:function(n){return e+"/"+t},trailColor:"#c0c0c0"}))),o.createElement(Tt,{key:this.state.currKey,task:r,parent:a,interfaceMode:this.props.interface.type,disabled:!!r.maxSubmissions&&r.num_submissions>=r.maxSubmissions||r.prerequisite&&r.valid,previewMode:this.props.previewMode,renderTaskSubmitButton:this.renderTaskSubmitButton,renderTaskNextButton:this.renderTaskNextButton,fetchTaskResponse:this.props.fetchTaskResponse,submitTaskResponse:this.props.submitTaskResponse,onClickNext:this.gotoNextTask,onSubmit:this.handleTaskSubmitted}))))},t}(o.Component);Zt.defaultProps={interface:{type:"annotation",userTasks:{},showProgress:!1}};var It=function(){var e=this;this.state={taskIds:[],currTask:[null,null],currKey:0,loadingTask:!0,extraOpen:!1,prerequisitesCompleted:!1},this.instructionsFn=null,this.replayIndex=0,this.makeTaskIds=function(){return e.props.tasks.map((function(e,t){return[t,e.children.map((function(e,t){return t}))]}))},this.getTask=function(t){var n=e.state.taskIds[t[0]][0];if(null==t[1])return e.props.tasks[n];var r=e.state.taskIds[t[0]][1][t[1]];return e.props.tasks[n].children[r]},this.getPrevTask=function(t){var n,r,a=t[0],s=null==t[1]?0:t[1]+1;if(0===s){if(0===a)return[null,null];n=a-1,r=e.state.taskIds[n][1].length}else n=a,r=s-1;return[n,r=r?r-1:null]},this.getNextTask=function(t){var n,r,a=e.getTask(t),s=t[0];return r=((null==t[1]?0:t[1]+1)+1)%(a.children.length+1),n=s+Number(0===r),r=r?r-1:null,n===e.state.taskIds.length&&(n=null),[n,r]},this.handleChangeActiveTask=function(t){e.replayIndex=0,e.instructionsFn=null,e.setState({currTask:t,currKey:e.state.currKey+1}),e.updateUrl(t[0])},this.gotoNextTask=function(){e.state.currTask[0]!==e.state.taskIds.length-1||null!==e.state.currTask[1]&&e.state.currTask[1]!==e.state.taskIds[e.state.currTask[0]][1].length-1?e.handleChangeActiveTask(e.getNextTask(e.state.currTask)):e.handleHitSubmit()},this.prerequisitesCompleted=function(){var t=!0;return e.props.tasks.forEach((function(e){e.prerequisite&&!e.valid&&(t=!1),e.children.forEach((function(n){e.prerequisite&&!e.valid&&(t=!1)}))})),t},this.handleTaskSubmitted=function(t){var n="timeline"==e.props.interface.type&&"task"==t,r=e.prerequisitesCompleted();if(!e.state.prerequisitesCompleted&&r)return e.props.reloadHit((function(){n&&e.gotoNextTask()}));n&&e.gotoNextTask()},this.updateUrl=function(t){e.props.routingEnabled&&window.history.pushState(null,null,"#"+(0,u.Gn)(e.props.match.path,{hitId:e.props.match.params.hitId,taskId:t}))},this.handleMenuClick=function(t){"extra"==t.key&&e.setState({extraOpen:!e.state.extraOpen})},this.showCompletionInfo=function(){var t=e.props.completionInfo;return k.Z.success({title:"HIT submitted!",content:o.createElement(o.Fragment,null,o.createElement("p",null,"Thank you! Your work has been submitted."),t.redirectUrl?o.createElement(o.Fragment,null,o.createElement("p",null,"If you came from ",t.redirectName?t.redirectName:"another site"," you may click here to be redirected:"),o.createElement(b.Z,{type:"primary",icon:o.createElement(p.Z,null),href:t.redirectUrl},"Back to ",t.redirectName?t.redirectName:"site")):o.createElement(o.Fragment,null,o.createElement("p",null,"Your completion code is:"),o.createElement("pre",null,t.completionCode)))})},this.handleHitSubmit=function(){e.props.onSubmit().then((function(){e.showCompletionInfo()})).catch((function(e){I("Error submitting HIT. Please try again or contact the organizers.",e)}))},this.canSubmitHit=function(){var t=!0;return e.props.tasks.forEach((function(e){e.required&&!e.valid&&(t=!1)})),t},this.renderMenu=function(){var t=e.state.taskIds.map((function(t){var n=e.props.tasks[t[0]];return n.children=t[1].map((function(e){return n.children[e]})),n}));return o.createElement(o.Fragment,null,o.createElement(Ce,{tasks:t,currTask:e.state.currTask,onChangeActiveTask:e.handleChangeActiveTask,editMode:{enabled:!0,allowNew:"userTasks"in e.props.interface&&Object.entries(e.props.interface.userTasks).length>0,presets:e.props.interface.userTasks,onTaskEdit:e.props.editTask,onTaskCreate:e.props.createTask,onTaskDelete:e.props.deleteTask}},!e.props.submitted&&e.props.interface.showSubmitButton&&o.createElement(b.Z,{type:"primary",style:{width:"100%",backgroundColor:"#5b8c00",borderColor:"#5b8c00"},onClick:e.handleHitSubmit,disabled:!e.canSubmitHit()},"Submit HIT"),e.props.submitted&&o.createElement(b.Z,{type:"primary",style:{width:"100%",backgroundColor:"#5b8c00",borderColor:"#5b8c00"},onClick:e.showCompletionInfo},"Show completion code")))},this.getHitExtra=function(){return!!e.props.extra&&o.createElement(D,{content:e.props.extra})},this.renderTaskSubmitButton=function(t){return o.createElement(b.Z,(0,r.Z)({type:"primary",htmlType:"submit"},t),"annotation"==e.props.interface.type?"Submit":"Next")},this.renderTaskNextButton=function(t){return o.createElement(b.Z,(0,r.Z)({type:"primary",onClick:e.gotoNextTask},t),"Next")}},Lt=l.ZP.div(Ct||(Ct=(0,a.Z)(["\n    position: sticky;\n    display: inline-block;\n    vertical-align: top;\n    top:46px;\n    height: ","\n\twidth: 25%;\n\toverflow: auto;\n"])),(function(e){return Math.floor(e.height)-46+"px;"})),Ot=l.ZP.div(xt||(xt=(0,a.Z)(["\n    display: inline-block;\n    vertical-align: top;\n    height: ","\n    width: calc(100% - 25%);\n    overflow: auto;\n"])),(function(e){return Math.floor(e.height)-46+"px;"})),Rt=(0,u.EN)(Zt)},82959:function(e,t,n){"use strict";n.d(t,{c:function(){return o}});var r=n(87462),a=n(94578),s=n(67294),i=n(91262),o=function(e){function t(t){var n;return(n=e.call(this,t)||this).state={},n}(0,a.Z)(t,e);var o=t.prototype;return o.componentDidMount=function(){},o.render=function(){var e=this,t=JSON.parse(JSON.stringify(this.props.hit));return t.tasks=t.tasks.map((function(e,t){return e.id=t,e.children||(e.children=[]),e})),s.createElement(i.Z,{fallback:s.createElement("div",null,"The fallback content to display on prerendering")},(function(){var a=n(73727).UT,i=n(38091).Z;return s.createElement(a,null,s.createElement("div",{style:{position:"relative",width:"100%",height:e.props.height+"px",border:"1px solid #969696"}},s.createElement(i,(0,r.Z)({},t,{height:e.props.height,routingEnabled:!1,url:null,previewMode:!0,fetchTaskResponse:function(){return Promise.resolve({})},onSubmit:function(){}}))))}))},t}(s.Component);o.defaultProps={height:500}},6699:function(e,t,n){"use strict";n.d(t,{dn:function(){return o},Cy:function(){return l}});var r=n(94578),a=n(67294),s=n(94184),i=n.n(s),o=function(e){function t(){return e.apply(this,arguments)||this}return(0,r.Z)(t,e),t.prototype.render=function(){return a.createElement(a.Fragment,null,a.createElement("div",null,a.createElement("pre",{className:i()("docs-code-block")},JSON.stringify(this.props.code,null,2))))},t}(a.Component),l=function(e){function t(){return e.apply(this,arguments)||this}return(0,r.Z)(t,e),t.prototype.render=function(){return a.createElement(a.Fragment,null,a.createElement("div",{style:{border:"1px solid #c8c8c8",overflow:"hidden"}},a.createElement("div",{style:{backgroundColor:"#d8d8d8",padding:"3px 5px",textAlign:"center",color:"#555555"}},"LIVE PREVIEW: data is not being collected"),this.props.children))},t}(a.Component)},32264:function(e,t,n){"use strict";n.r(t),n.d(t,{frontMatter:function(){return u},contentTitle:function(){return c},metadata:function(){return p},toc:function(){return d},hitSpec:function(){return m},default:function(){return k}});var r=n(87462),a=n(63366),s=(n(67294),n(3905)),i=n(6699),o=n(82959),l=["components"],u={title:"Timeline HITs"},c=void 0,p={unversionedId:"timeline",id:"timeline",isDocsHomePage:!1,title:"Timeline HITs",description:"HITs with a type of timeline are rendered as a series of tasks that must be completed in order. An array of tasks, of possibly different types must be specified in order. Users cannot add tasks to timeline HITs (the interface.userTasks property of annotation HITs is ignored).",source:"@site/docs/timeline.mdx",sourceDirName:".",slug:"/timeline",permalink:"/docs/timeline",editUrl:"https://github.com/facebook/docusaurus/edit/master/website/docs/timeline.mdx",version:"current",frontMatter:{title:"Timeline HITs"}},d=[],m={type:"timeline",tasks:[{type:"InstructionsTask",html:"Please watch each video and answer the questions next to it."},{type:"QuestionnaireTask",form:{fields:[{prompt:"Does the person in the video laugh?",input:{type:"Radio.Group",options:["yes","no"]}}]},media:{type:"video",url:"https://cdn.jsdelivr.net/gh/josedvq/covfee@master/samples/intensity_annotation/media/person_reading.mp4"}},{type:"Continuous1DTask",media:{type:"video",url:"https://cdn.jsdelivr.net/gh/josedvq/covfee@master/samples/intensity_annotation/media/person_reading.mp4"}}]},h=function(e){return function(t){return console.warn("Component "+e+" was not imported, exported, or provided by MDXProvider as global scope"),(0,s.kt)("div",t)}},f=h("Meta"),v=h("Alert"),y={toc:d,hitSpec:m};function k(e){var t=e.components,n=(0,a.Z)(e,l);return(0,s.kt)("wrapper",(0,r.Z)({},y,n,{components:t,mdxType:"MDXLayout"}),(0,s.kt)(f,{title:"Timeline HITs",mdxType:"Meta"}),(0,s.kt)("h1",{id:"timeline-hits"},"Timeline HITs"),(0,s.kt)("p",null,"HITs with a ",(0,s.kt)("inlineCode",{parentName:"p"},"type")," of ",(0,s.kt)("inlineCode",{parentName:"p"},"timeline")," are rendered as a series of tasks that must be completed in order. An array of tasks, of possibly different types must be specified in order. Users cannot add tasks to timeline HITs (the ",(0,s.kt)("inlineCode",{parentName:"p"},"interface.userTasks")," property of annotation HITs is ignored)."),(0,s.kt)(i.dn,{code:m,mdxType:"CodeBlock"}),(0,s.kt)(v,{message:"Note: this preview is not fully interactive. To be able to edit the tasks and submit data recreate the HIT in a local covfee install.",mdxType:"Alert"}),(0,s.kt)(o.c,{hit:m,mdxType:"HITVisualizer"}))}k.isMDXComponent=!0},91432:function(){}}]);